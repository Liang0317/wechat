(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/auth"],{2702:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){return t.stopPropagation(),e.$refs.show_info_item.close()})},o=[]},3498:function(e,t,r){"use strict";r.r(t);var n=r("2702"),o=r("9d5a");for(var i in o)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return o[e]}))}(i);r("bd97");var a=r("828b"),u=Object(a["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=u.exports},3558:function(e,t,r){},"9d5a":function(e,t,r){"use strict";r.r(t);var n=r("e172"),o=r.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=o.a},bd97:function(e,t,r){"use strict";var n=r("3558"),o=r.n(n);o.a},e172:function(e,t,r){"use strict";(function(e){var n=r("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(r("7eb4")),i=n(r("34cf")),a=n(r("ee10")),u=n(r("7ca3")),s=r("8f59");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={components:{},name:"auth",props:{needAuth:{type:Boolean,default:function(){return!1}},must:{type:Boolean,default:function(){return!1}},userMust:{type:Boolean,default:function(){return!0}},showAuth:{type:Boolean,default:function(){return!1}},type:{type:String,default:function(){return"phone"}},btn_text:{type:String,default:function(){return""}},haveGo:{type:Boolean,default:function(){return!0}}},computed:(0,s.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},userInfo:function(e){return e.user.userInfo},userPrivacySetting:function(e){return e.user.userPrivacySetting}}),created:function(){this.init()},data:function(){return{contentList:{userInfo:["尊贵的用户，获取授权是为了能更好的为你服务","立即授权"],phone:["尊贵的用户，登录后我们才能更好的为你服务","立即登录"],setting:["为了功能正常使用，你需要打开设置并开启获取相应权限","打开设置"]},pType:"",pMust:"",authTime:0,timer:null,subForm:{phone:"",short_code:""},subRule:[{name:"phone",checkType:"isMobile",errorMsg:"请输入手机号",regText:"手机号"},{name:"short_code",checkType:"isNotNull",errorMsg:"请输入短信验证码"}],infoForm:{nickName:"",avatarUrl:""},infoRule:[{name:"nickName",checkType:"isNotNull",errorMsg:"请输入用户昵称",regType:2},{name:"avatarUrl",checkType:"isNotNull",errorMsg:"请上传用户头像"}],lockTap:!1}},methods:f(f(f({},(0,s.mapActions)(["getUserInfo","getMineInfo","getAuthUserProfile","getAuthPhone"])),(0,s.mapMutations)(["updateConfigItem","updateUserItem"])),{},{init:function(){var e=this.type,t=this.must,r=this.showAuth;if(this.$set(this,"pType",e),this.$set(this,"pMust",t),r){var n="userInfo"===e?"show_info_item":"show_auth_item";this.$refs[n].open()}},toShowAuth:function(){var e=this.userInfo,t=e.id,r=void 0===t?0:t,n=e.phone,o=void 0===n?"":n,i=this.configInfo,a=i.short_code_status,u=void 0===a?0:a,s=i.bind_phone_type,c=void 0===s?0:s;if(!r||u&&c&&!o){var f=getCurrentPages(),l=f[f.length-1],h=l.route,p=l.options,d=void 0===p?{}:p,m=this.$util.getUrlToStr("/".concat(h),d);return this.updateUserItem({key:"loginPage",val:m}),void this.$util.goUrl({url:r?"/user/pages/phone":"/pages/login"})}var v=this.$util.pick(this.userInfo,["nickName","avatarUrl"]);v.avatarUrl||(v.avatarUrl="https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0"),this.infoForm=v;var b=o?"userInfo":"phone",g=this.userPrivacySetting.needAuthorization;if("userInfo"===b&&g)this.$emit("userPrivacy");else{this.$set(this,"pType",b);var w="show_info_item";o||(w="show_auth_item"),this.$refs[w].open()}},authPhone:function(e){var t=this;return(0,a.default)(o.default.mark((function r(){var n,i,a,u;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.pMust,r.next=3,t.getAuthPhone({e:e});case 3:if(i=r.sent,i){r.next=9;break}return t.go(n?2:1),r.abrupt("return",!1);case 9:if(t.$refs.show_auth_item.close(),a=t.userInfo.nickName,u=void 0===a?"":a,!u){r.next=14;break}return t.go(1),r.abrupt("return");case 14:if(t.$set(t,"pType","userInfo"),t.$set(t,"pMust",t.userMust),t.pMust){r.next=18;break}return r.abrupt("return");case 18:t.$refs.show_info_item.open();case 19:case"end":return r.stop()}}),r)})))()},go:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.lockTap=!1,this.$emit(1==e?"go":"hide");var t=3==e?"show_phone_item":4==e?"show_info_item":"show_auth_item",r=this.userInfo.id,n=void 0===r?0:r;n&&this.needAuth&&this.$refs[t].close(),3==e&&this.toResetItem("sub")},toResetItem:function(e){if("sub"==e)return this.timer&&clearInterval(this.timer),this.authTime=0,void(this.subForm={phone:"",short_code:""});this.infoForm=this.$util.pick(this.userInfo,["nickName","avatarUrl"])},validate:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new this.$util.Validate;this["".concat(t,"Rule")].map((function(o){var i=o.name;"sub"==t&&"short_code"==i&&r||n.add(e[i],o)}));var o=n.start();return o},toSend:function(){var e=this;return(0,a.default)(o.default.mark((function t(){var r,n,i,a,u;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.authTime,!r){t.next=3;break}return t.abrupt("return");case 3:if(n=e.subForm.phone,i=void 0===n?"":n,a=e.validate({phone:i},"sub",!0),!a){t.next=8;break}return e.$util.showToast({title:a}),t.abrupt("return");case 8:if(!e.lockTap){t.next=10;break}return t.abrupt("return");case 10:return e.lockTap=!0,e.$util.showLoading(),t.prev=12,t.next=15,e.$api.user.sendShortMsg({phone:i});case 15:e.$util.hideAll(),e.lockTap=!1,e.subForm.short_code="",u=60,e.timer=setInterval((function(){0!==u?(u--,e.authTime=u):clearInterval(e.timer)}),1e3),t.next=25;break;case 22:t.prev=22,t.t0=t["catch"](12),setTimeout((function(){e.lockTap=!1,e.$util.hideAll()}),2e3);case 25:case"end":return t.stop()}}),t,null,[[12,22]])})))()},onChooseAvatar:function(e){var t=e.detail.avatarUrl;this.infoForm.avatarUrl=t},toChooseImg:function(){var t=this;return(0,a.default)(o.default.mark((function r(){var n,a,u,s,c,f,l,h,p,d;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n={count:1,sizeType:["compressed"],sourceType:["album"]},r.next=3,e.chooseImage(n);case 3:if(a=r.sent,u=(0,i.default)(a,2),s=u[0],c=u[1],!s){r.next=9;break}return r.abrupt("return");case 9:return f=c.size,void 0===f?0:f,l=c.tempFiles,h=c.tempFilePath,void 0===h?"":h,t.$util.showLoading({title:"上传中"}),r.next=13,t.$api.base.uploadFile({filePath:l[0].path,formData:{type:"picture"}});case 13:p=r.sent,d=p.attachment_path,t.infoForm.avatarUrl=d,t.$util.hideAll();case 17:case"end":return r.stop()}}),r)})))()},submit:function(e){var t=this;return(0,a.default)(o.default.mark((function r(){var n,i,a,u,s,c;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t.$util.deepCopy(t["".concat(e,"Form")]),i=t.validate(n,e),!i){r.next=5;break}return t.$util.showToast({title:i}),r.abrupt("return");case 5:if("sub"!=e||6==n.short_code.length){r.next=8;break}return t.$util.showToast({title:"请输入6位数短信验证码"}),r.abrupt("return");case 8:if("info"!=e||!n.avatarUrl.includes("wxfile://")&&!n.avatarUrl.includes("//tmp/")){r.next=14;break}return r.next=11,t.$api.base.uploadFile({filePath:n.avatarUrl,formData:{type:"picture"}});case 11:a=r.sent,u=a.attachment_path,n.avatarUrl=u;case 14:if(!t.lockTap){r.next=16;break}return r.abrupt("return");case 16:return t.lockTap=!0,t.$util.showLoading(),s="sub"==e?"bindUserPhone":"userUpdate",c="sub"==e?"show_phone_item":"show_info_item",r.prev=20,r.next=23,t.$api.user[s](n);case 23:return t.$util.hideAll(),t.$refs[c].close(),t.lockTap=!1,r.next=28,t.getUserInfo();case 28:t.toResetItem(e),setTimeout((function(){t.$emit("go")}),500),r.next=35;break;case 32:r.prev=32,r.t0=r["catch"](20),setTimeout((function(){t.lockTap=!1,t.$util.hideAll()}),2e3);case 35:case"end":return r.stop()}}),r,null,[[20,32]])})))()}})};t.default=l}).call(this,r("df3c")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/auth-create-component',
    {
        'components/auth-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('df3c')['createComponent'](__webpack_require__("3498"))
        })
    },
    [['components/auth-create-component']]
]);
