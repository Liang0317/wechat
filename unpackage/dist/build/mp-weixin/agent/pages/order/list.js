(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["agent/pages/order/list"],{"3d61":function(t,e,n){"use strict";(function(t,e){var a=n("47a9");n("65e9");a(n("3240"));var i=a(n("eb35"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"8c8e":function(t,e,n){"use strict";n.r(e);var a=n("a3c4"),i=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(r);e["default"]=i.a},a3c4:function(t,e,n){"use strict";(function(t){var a=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("7eb4")),r=a(n("34cf")),o=a(n("ee10")),c=a(n("7ca3")),s=n("8f59");function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){(0,c.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var l={components:{},data:function(){return{isLoad:!1,options:{},activeIndex:0,tabList:[],tabOrderList:[{title:"全部",id:0},{title:"已取消",id:-1},{title:"待接单",id:2,number:0},{title:"已接单",id:3,number:0},{title:"已出发",id:4,number:0},{title:"已到达",id:5,number:0},{title:"服务中",id:6,number:0},{title:"已完成",id:7,number:0}],tabBellList:[{title:"全部",id:0},{title:"已取消",id:-1},{title:"待接单",id:2,number:0},{title:"已接单",id:3,number:0},{title:"服务中",id:6,number:0},{title:"已完成",id:7,number:0}],statusType:{"-1":"已取消",1:"待支付",2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成",8:"待转单"},technicianStatusOperType:{"-1":"agreeRefund",2:"orderTaking",3:"setOut",4:"arrive",5:"startService",6:"serviceCompletion",8:"transferOrder"},param:{page:1,pay_type:0,order_code:""},list:{data:[]},loading:!0,index:-1,lockTap:!1,popupInfo:{title:"",index:"",type:"",param:{},imgs:[],location:{lat:0,lng:0,address:""}}}},computed:(0,s.mapState)({primaryColor:function(t){return t.config.configInfo.primaryColor},subColor:function(t){return t.config.configInfo.subColor},configInfo:function(t){return t.config.configInfo},userInfo:function(t){return t.user.userInfo}}),onLoad:function(e){var n=e.agent,a=void 0===n?0:n,i=e.bell,r=void 0===i?0:i,o=e.tab,c=void 0===o?0:o;e.agent=1*a,e.bell=1*r,this.options=e,t.setNavigationBarTitle({title:8==c?"拒单管理":1==r?"加钟管理":"订单管理"}),this.tabList=8==c?[]:1==r?this.tabBellList:this.tabOrderList,this.activeIndex=c,this.initIndex()},onPullDownRefresh:function(){t.showNavigationBarLoading(),this.initRefresh(),t.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},methods:d(d(d({},(0,s.mapActions)(["getConfigInfo"])),(0,s.mapMutations)(["updateTechnicianItem"])),{},{initIndex:function(){var t=arguments,e=this;return(0,o.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.length>0&&void 0!==t[0]&&t[0],e.configInfo.id&&!a){n.next=4;break}return n.next=4,e.getConfigInfo();case 4:return n.next=6,e.getList();case 6:e.isLoad=!0,e.$util.setNavigationBarColor({bg:e.primaryColor});case 8:case"end":return n.stop()}}),n)})))()},initRefresh:function(){this.param.page=1,this.initIndex(!0)},toSearch:function(t){this.param.page=1,this.param.order_code=t,this.getList()},getList:function(){var t=arguments,e=this;return(0,o.default)(i.default.mark((function n(){var a,r,o,c,s,u,d,l,p,f,g,h,m,_;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.length>0&&void 0!==t[0]&&t[0],r=e.list,o=e.param,c=e.tabList,s=e.activeIndex,u=e.options,d=u.tab,l=void 0===d?0:d,p=u.bell,f=void 0===p?0:p,g=u.agent,h=void 0===g?0:g,m=h?"agent":"admin",o.pay_type=8==l?8:c[s].id,8!=l&&(o.is_add=f),n.next=8,e.$api[m].orderList(o);case 8:_=n.sent,a||(1==e.param.page||(_.data=r.data.concat(_.data)),e.list=_),e.loading=!1,e.$util.hideAll();case 12:case"end":return n.stop()}}),n)})))()},handerTabChange:function(t){this.activeIndex=t,this.$util.showLoading(),this.param.page=1,this.getList()},toConfirm:function(t){var e=this;return(0,o.default)(i.default.mark((function n(){var a,r,o,c,s,u,d,l,p,f,g;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e.lockTap){n.next=2;break}return n.abrupt("return");case 2:a=e.list.data[t],r=a.id,o=a.pay_type,c=a.can_refund_price,s=a.is_add,u=void 0===s?0:s,d=a.store_id,l=void 0===d?0:d,p=a.add_flow_path,f=void 0===p?1:p,g=u&&2==o&&2==f||3===o&&(u||l)?5:8==o?-1:o,e.popupInfo={index:t,order_id:r,type:g,text_type:u&&2==o?2:g,can_refund_price:c},e.$refs.change_item.open();case 6:case"end":return n.stop()}}),n)})))()},confirmChangeOrder:function(){var e=this;return(0,o.default)(i.default.mark((function n(){var a,o,c,s,u,d,l,p,f,g,h,m,_,v,b,y,x,O,w;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.$util.deepCopy(e.popupInfo),o=a.index,c=a.type,s=a.text_type,a.type=-1==c?c:c+1,u=e.list.data[o].is_add,d="",l=0,7!=a.type||u){n.next=17;break}return p=e.options.agent,f=p?"agent":"admin",n.next=11,e.$api[f].orderInfo({id:a.order_id});case 11:g=n.sent,g.pay_type,h=g.add_service,m=void 0===h?[]:h,l=m.length,m&&m.length>0&&m.map((function(t){d+="【".concat(t,"】")}));case 17:if(!(d&&d.length>0)){n.next=27;break}return n.next=20,t.showModal({content:"该订单还有".concat(d).concat(l,"项加钟服务，完成主订单会将加钟订单一并结束，确认是否结束？"),confirmText:"确认"});case 20:if(_=n.sent,v=(0,r.default)(_,2),v[0],b=v[1].confirm,b){n.next=27;break}return e.$refs.change_item.close(),n.abrupt("return");case 27:if(delete a.index,delete a.can_refund_price,delete a.text_type,y=e.activeIndex,e.technicianStatusOperType,x=-1==s?"退款成功":"操作成功",!e.lockTap){n.next=34;break}return n.abrupt("return");case 34:return e.lockTap=!0,e.$util.showLoading(),O=e.options.agent,w=O?"agent":"admin",n.prev=38,e.$refs.change_item.close(),n.next=42,e.$api[w].adminUpdateOrder(a);case 42:if(e.$util.showToast({title:x}),0==y?e.list.data[o].pay_type=a.type:e.list.data.splice(o,1),e.$util.hideAll(),e.updateTechnicianItem({key:"haveOperItem",val:!0}),!y){n.next=49;break}return n.next=49,e.getList(!0);case 49:setTimeout((function(){e.lockTap=!1}),500),n.next=56;break;case 52:n.prev=52,n.t0=n["catch"](38),e.updateTechnicianItem({key:"haveOperItem",val:!0}),setTimeout((function(){e.param.page=1,e.getList(),e.lockTap=!1,e.$util.hideAll()}),2e3);case 56:case"end":return n.stop()}}),n,null,[[38,52]])})))()},goDetail:function(t){var e=this.list.data[t].id,n=this.options.agent,a="/agent/pages/order/detail?id=".concat(e,"&agent=").concat(n);this.$util.goUrl({url:a})}})};e.default=l}).call(this,n("df3c")["default"])},ae2f:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,n=(t._self._c,t.isLoad?t.__map(t.list.data,(function(e,n){var a=t.__get_orig(e),i=2!=e.pay_type?[3,4,5].includes(e.pay_type):null,r=t.$t("action.attendantName"),o=[2,3,4,5,6,8].includes(e.pay_type)&&!e.is_add||([2,3,6].includes(e.pay_type)&&1===e.add_flow_path||2==e.pay_type&&2==e.add_flow_path)&&e.is_add,c=o?t.$t("action."+t.technicianStatusOperType[3===e.pay_type&&(e.store_id||e.is_add)?5:8==e.pay_type?-1:e.pay_type]):null;return{$orig:a,g0:i,m0:r,g1:o,m1:c}})):null),a=t.isLoad&&t.loading?t.list.current_page>=t.list.last_page&&t.list.data.length>0:null,i=t.isLoad?!t.loading&&t.list.data.length<=0&&1==t.list.current_page:null,r=t.isLoad?t.$t("action."+t.technicianStatusOperType[t.popupInfo.text_type]):null;t._isMounted||(t.e0=function(e,n){var a=arguments[arguments.length-1].currentTarget.dataset,i=a.eventParams||a["event-params"];n=i.item;return e.stopPropagation(),t.$util.goUrl({url:"/agent/pages/order/change?id="+n.id+"&agent="+t.options.agent})},t.e1=function(e){return e.stopPropagation(),t.$refs.change_item.close()}),t.$mp.data=Object.assign({},{$root:{l0:n,g2:a,g3:i,m2:r}})},i=[]},eb35:function(t,e,n){"use strict";n.r(e);var a=n("ae2f"),i=n("8c8e");for(var r in i)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r);var o=n("828b"),c=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);e["default"]=c.exports}},[["3d61","common/runtime","common/vendor"]]]);