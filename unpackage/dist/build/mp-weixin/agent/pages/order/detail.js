(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["agent/pages/order/detail"],{"47bd":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,i=(e._self._c,e.detail.id&&(-1==e.detail.pay_type||8==e.detail.pay_type)&&e.detail.coach_refund_time?e.$t("action.attendantName"):null),n=e.detail.id?e.__map(e.detail.order_goods,(function(t,i){var n=e.__get_orig(t),a=e.detail.order_goods.length;return{$orig:n,g0:a}})):null,a=e.detail.id&&e.detail.pay_order_times?e._f("handlePayOrder")(e.detail.pay_order_times):null,r=e.detail.id&&!e.detail.phone_encryption?e.detail.address_info.mobile.substring(0,3):null,o=e.detail.id&&!e.detail.phone_encryption?e.detail.address_info.mobile.substring(7,11):null,c=e.detail.id&&!e.detail.is_add&&!e.detail.store_id&&1==e.detail.car_type&&e.detail.free_fare&&1!=e.detail.free_fare?e.$t("action.attendantName"):null,d=e.detail.id?[2,3,4,5,6,8].includes(e.detail.pay_type)&&!e.detail.is_add||([2,3,6].includes(e.detail.pay_type)&&1===e.detail.add_flow_path||2==e.detail.pay_type&&2==e.detail.add_flow_path)&&e.detail.is_add:null,u=e.detail.id&&d?[2,3,4,5,6,8].includes(e.detail.pay_type)&&!e.detail.is_add||([2,3,6].includes(e.detail.pay_type)&&1===e.detail.add_flow_path||2==e.detail.pay_type&&2==e.detail.add_flow_path)&&e.detail.is_add:null,l=e.detail.id&&d&&u&&!e.detail.is_add?e.$t("action.transferOrder"):null,s=e.detail.id&&d&&u?e.$t("action."+e.technicianStatusOperType[3===e.detail.pay_type&&(e.detail.store_id||e.detail.is_add)?5:8==e.detail.pay_type?-1:e.detail.pay_type]):null,p=e.detail.id?e.$t("action."+e.technicianStatusOperType[e.popupInfo.text_type]):null;e._isMounted||(e.e0=function(t){return t.stopPropagation(),e.$refs.refuse_item.open()},e.e1=function(t){return t.stopPropagation(),e.$util.goUrl({url:"/agent/pages/order/abnormal?id="+e.detail.abn_order_id+"&agent="+e.options.agent})},e.e2=function(t){return t.stopPropagation(),e.$util.goUrl({url:e.detail.store_info.phone,openType:"call"})},e.e3=function(t){return t.stopPropagation(),e.$util.goUrl({url:e.detail.coach_info.mobile,openType:"call"})},e.e4=function(t){return t.stopPropagation(),e.$util.goUrl({url:"/agent/pages/order/change?id="+e.options.id+"&agent="+e.options.agent})},e.e5=function(t){return t.stopPropagation(),e.$refs.refuse_item.close()},e.e6=function(t){return t.stopPropagation(),e.$refs.change_item.close()}),e.$mp.data=Object.assign({},{$root:{m0:i,l0:n,f0:a,g1:r,g2:o,m1:c,g3:d,g4:u,m2:l,m3:s,m4:p}})},a=[]},8136:function(e,t,i){},"864d":function(e,t,i){"use strict";(function(e,t){var n=i("47a9");i("65e9");n(i("3240"));var a=n(i("a039"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(a.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"95c3":function(e,t,i){"use strict";var n=i("8136"),a=i.n(n);a.a},a039:function(e,t,i){"use strict";i.r(t);var n=i("47bd"),a=i("e5b0");for(var r in a)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(r);i("95c3");var o=i("828b"),c=Object(o["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=c.exports},b914:function(e,t,i){"use strict";(function(e){var n=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(i("7eb4")),r=n(i("34cf")),o=n(i("ee10")),c=n(i("7ca3")),d=i("8f59");function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){(0,c.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var s={components:{timeline:function(){i.e("components/timeline").then(function(){return resolve(i("bcf9"))}.bind(null,i)).catch(i.oe)}},data:function(){return{options:{},statusType:{"-1":"已取消",1:"待支付",2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成",8:"待转单"},technicianStatusOperType:{"-1":"agreeRefund",2:"orderTaking",3:"setOut",4:"arrive",5:"startService",6:"serviceCompletion"},carType:{0:"公交/地铁",1:"出租车"},payType:{1:"微信支付",2:"余额支付",3:"支付宝支付"},lineList:[],base_service:[{pay_type:3,title:this.$t("action.attendantName")+"接单",time:"receiving_time",icon:"iconjishijiedan"},{pay_type:4,title:this.$t("action.attendantName")+"出发",time:"serout_time",addr:"serout_address",icon:"iconjishichufa"},{pay_type:5,title:this.$t("action.attendantName")+"到达",time:"arrive_time",img:"arrive_img",addr:"arr_address",icon:"iconjishidaoda"},{pay_type:6,title:"开始服务",time:"start_service_time",icon:"iconjishifuwu"},{pay_type:7,title:"服务完成",time:"order_end_time",img:"end_img",addr:"end_address",icon:"iconjishiwancheng"},{pay_type:7,title:"签字确认",time:"sign_time",img:"sign_img",icon:""}],base_bell:[{pay_type:3,title:this.$t("action.attendantName")+"接单",time:"receiving_time",icon:"iconjishijiedan"},{pay_type:6,title:"开始服务",time:"start_service_time",icon:"iconjishifuwu"},{pay_type:7,title:"服务完成",time:"order_end_time",img:"end_img",addr:"end_address",icon:"iconjishiwancheng"}],detail:{pay_type:0},check_label:[],coach_refund_text:"",lockTap:!1,popupInfo:{title:"",type:"",param:{},imgs:[],location:{lat:0,lng:0,address:""}}}},computed:(0,d.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},userInfo:function(e){return e.user.userInfo},haveOperItem:function(e){return e.technician.haveOperItem},over_time_text:function(){return(new Date).getTime()+1e3*this.detail.end_time}}),onLoad:function(e){var t=e.agent,i=void 0===t?0:t;e.agent=1*i,this.options=e,this.initIndex()},onShow:function(){this.haveOperItem&&(this.$util.back(),this.updateTechnicianItem({key:"haveOperItem",val:!1}))},methods:l(l(l({},(0,d.mapActions)(["getConfigInfo","getCoachInfo"])),(0,d.mapMutations)(["updateTechnicianItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,o.default)(a.default.mark((function i(){var n,r,o,c,d,u,l,s,p,f,_,m,g,h,y,v,b,$,w;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.length>0&&void 0!==e[0]&&e[0],t.configInfo.id&&!n){i.next=4;break}return i.next=4,t.getConfigInfo();case 4:return r=t.options,o=r.id,c=r.agent,d=c?"agent":"admin",i.next=8,t.$api[d].orderInfo({id:o});case 8:u=i.sent,t.$util.setNavigationBarColor({bg:t.primaryColor}),u.is_balance=1*u.balance>0?1:0,l=u.pay_type,s=u.true_time_long,p=u.receiving_time,f=void 0===p?"":p,_=u.start_service_time,m=void 0===_?"":_,g=u.is_add,h=void 0===g?0:g,y=u.store_id,v=void 0===y?0:y,h&&(!f&&l>3&&(u.receiving_time=m),!m&&l>5&&(u.start_service_time=f)),6==l&&(b=t.$util.DateToUnix(m)+60*s,u.start_service_time_unix=b),$=t.$util.deepCopy(h||v?t.base_bell:t.base_service),w=$.findIndex((function(e){return"签字确认"==e.title})),v&&-1==w&&$.push({pay_type:7,title:"签字确认",time:"sign_time",icon:""}),t.lineList=$,t.detail=u;case 19:case"end":return i.stop()}}),i)})))()},initRefresh:function(){this.initIndex(!0)},countEnd:function(){var e=this;this.$util.log("倒计时完了"),setTimeout((function(){e.initRefresh(),e.$util.back()}),1e3)},toConfirm:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var i,n,r,o,c,d,u,l,s,p,f;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.lockTap){t.next=2;break}return t.abrupt("return");case 2:i=e.detail,n=i.id,r=i.pay_type,o=i.is_add,c=void 0===o?0:o,d=i.store_id,u=void 0===d?0:d,l=i.can_refund_price,s=i.add_flow_path,p=void 0===s?1:s,f=c&&2===r&&2==p||3===r&&(c||u)?5:8==r?-1:r,e.popupInfo={order_id:n,type:f,text_type:c&&2==r?2:f,can_refund_price:l},e.$refs.change_item.open();case 6:case"end":return t.stop()}}),t)})))()},confirmChangeOrder:function(){var t=this;return(0,o.default)(a.default.mark((function i(){var n,o,c,d,u,l,s,p,f,_,m,g,h,y;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=t.$util.deepCopy(t.popupInfo),o=n.type,c=n.text_type,n.type=-1==o?o:o+1,d=t.detail,u=d.is_add,l=d.add_service,s=void 0===l?[]:l,7!=n.type||u||!(s.length>0)){i.next=16;break}return p="",s.map((function(e){p+="【".concat(e,"】")})),i.next=9,e.showModal({content:"该订单还有".concat(p).concat(s.length,"项加钟服务，完成主订单会将加钟订单一并结束，确认是否结束？"),confirmText:"确认"});case 9:if(f=i.sent,_=(0,r.default)(f,2),_[0],m=_[1].confirm,m){i.next=16;break}return t.$refs.change_item.close(),i.abrupt("return");case 16:if(delete n.index,delete n.can_refund_price,delete n.text_type,t.technicianStatusOperType,g=-1==c?"退款成功":"操作成功",!t.lockTap){i.next=23;break}return i.abrupt("return");case 23:return t.lockTap=!0,t.$util.showLoading(),h=t.options.agent,y=h?"agent":"admin",i.prev=27,t.$refs.change_item.close(),i.next=31,t.$api[y].adminUpdateOrder(n);case 31:t.$util.showToast({title:g}),t.updateTechnicianItem({key:"haveOperItem",val:!0}),t.initRefresh(),t.$util.back(),setTimeout((function(){t.lockTap=!1}),1e3),-1==o&&setTimeout((function(){t.$util.goUrl({url:1,openType:"navigateBack"})}),1e3),i.next=43;break;case 39:i.prev=39,i.t0=i["catch"](27),t.updateTechnicianItem({key:"haveOperItem",val:!0}),setTimeout((function(){t.initRefresh(),t.$util.back(),t.lockTap=!1,t.$util.hideAll()}),2e3);case 43:case"end":return i.stop()}}),i,null,[[27,39]])})))()},toTel:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var i,n,r,o,c,d,u;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=e.detail,n=i.id,r=i.pay_type,o=e.options.agent,c=o?"agent":"admin",![2,3,4,5,6,8].includes(r)){t.next=13;break}return t.next=6,e.$api[c].getVirtualPhone({order_id:n});case 6:if(d=t.sent,d){t.next=10;break}return e.$util.showToast({title:"稍后会有电话打入，请注意接听哦"}),t.abrupt("return");case 10:e.$util.goUrl({url:d,openType:"call"}),t.next=15;break;case 13:u=7==r?"服务结束":"服务取消",e.$util.showToast({title:"".concat(u,"不能联系客户哦")});case 15:case"end":return t.stop()}}),t)})))()},toMap:function(t){var i=this;return(0,o.default)(a.default.mark((function n(){var r,o,c,d,u,l,s;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=i.$refs.user_privacy.check(),!r){n.next=4;break}return i.$refs.user_privacy.open(),n.abrupt("return");case 4:return o=i.detail[t],c=o.address,d=o.address_info,u=void 0===d?"":d,l=o.lat,s=o.lng,n.next=7,i.$util.checkAuth({type:"userLocation"});case 7:return n.next=9,e.getLocation({type:"gcj02"});case 9:return n.next=11,e.openLocation({latitude:1*l,longitude:1*s,name:u?"".concat(c," ").concat(u):c,scale:28});case 11:case"end":return n.stop()}}),n)})))()},toCopy:function(e){var t=this.$refs.user_privacy.check();t?this.$refs.user_privacy.open():this.$util.goUrl({url:e,openType:"copy"})}}),filters:{handlePayOrder:function(e){return 1===e?"（首次下单）":"（第".concat(e,"次下单）")}}};t.default=s}).call(this,i("df3c")["default"])},e5b0:function(e,t,i){"use strict";i.r(t);var n=i("b914"),a=i.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r);t["default"]=a.a}},[["864d","common/runtime","common/vendor"]]]);