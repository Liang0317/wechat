(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["agent/pages/refund/refund"],{"1bfe":function(e,r,t){"use strict";t.r(r);var n=t("6d10"),o=t("3a7c");for(var i in o)["default"].indexOf(i)<0&&function(e){t.d(r,e,(function(){return o[e]}))}(i);t("a930");var a=t("828b"),c=Object(a["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);r["default"]=c.exports},"3a7c":function(e,r,t){"use strict";t.r(r);var n=t("6a01"),o=t.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){t.d(r,e,(function(){return n[e]}))}(i);r["default"]=o.a},"5c1f":function(e,r,t){},"6a01":function(e,r,t){"use strict";var n=t("47a9");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(t("7eb4")),i=n(t("ee10")),a=n(t("7ca3")),c=t("8f59");function u(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function f(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?u(Object(t),!0).forEach((function(r){(0,a.default)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var d={components:{},data:function(){return{isLoad:!1,options:{},statusType:{"-1":"已取消",1:"待支付",2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成",8:"待转单"},refundForm:{},lockTap:!1}},computed:(0,c.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},userInfo:function(e){return e.user.userInfo}}),onLoad:function(e){var r=e.agent,t=void 0===r?0:r,n=e.detail,o=void 0===n?0:n;e.agent=1*t,e.detail=1*o,this.options=e,this.initIndex()},methods:f(f(f({},(0,c.mapActions)(["getConfigInfo","getCoachInfo"])),(0,c.mapMutations)(["updateTechnicianItem"])),{},{initIndex:function(){var e=arguments,r=this;return(0,i.default)(o.default.mark((function t(){var n,i,a,c,u,f,d,s;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.length>0&&void 0!==e[0]&&e[0],r.configInfo.id&&!n){t.next=4;break}return t.next=4,r.getConfigInfo();case 4:return r.$util.setNavigationBarColor({bg:r.primaryColor}),i=r.options,a=i.id,c=i.agent,u=c?"agent":"admin",t.next=9,r.$api[u].refundOrderInfo({id:a});case 9:f=t.sent,d=r.$util.pick(f,["id","car_price","material_price","order_goods","pay_type"]),d.refund_car_price=d.car_price,s=0,d.order_goods.map((function(e){var r=e.num,t=e.goods_price,n=e.material_price;e.refund_price=t,e.refund_material_price=n,e.total_refund_price=(t*r+n*r).toFixed(2),s+=1*e.total_refund_price})),d.total_refund_price=s+1*d.car_price,r.refundForm=d,r.isLoad=!0;case 17:case"end":return t.stop()}}),t)})))()},initRefresh:function(){this.initIndex(!0)},checkInput:function(e,r,t){var n=this,o=this.$util.formatMoney(e.detail.value);this.$nextTick((function(){-1==r?n.refundForm[t]=o:n.refundForm.order_goods[r][t]=o}))},handleCheckOrderItem:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.refundForm,o=(n.is_check,n.car_price),i=n.refund_car_price;if(3==r){var a=/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/;a.test(i)||(i=0),1*i>o&&(i=o),this.$nextTick((function(){e.refundForm.refund_car_price=i}))}if(0==r){var c=this.refundForm.order_goods[t],u=c.num,f=c.refund_price,d=c.refund_material_price,s=c.goods_price,p=c.material_price,l=/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/;l.test(f)&&1*f!=0||(f=.01),1*f>s&&(f=s),l.test(d)||(d=0),1*d>p&&(d=p);var _=(f*u+d*u).toFixed(2);this.$nextTick((function(){e.refundForm.order_goods[t].refund_price=f,e.refundForm.order_goods[t].refund_material_price=d,e.refundForm.order_goods[t].total_refund_price=_}))}setTimeout((function(){var r=0;e.refundForm.order_goods.map((function(e){r+=1*e.total_refund_price})),r+=1*i,e.refundForm.total_refund_price=r.toFixed(2)}),100)},toConfirmRefund:function(){var e=this;return(0,i.default)(o.default.mark((function r(){var t,n,i,a,c,u,f,d,s,p;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t=JSON.parse(JSON.stringify(e.refundForm)),n=t.id,i=t.refund_car_price,a=t.total_refund_price,c=t.order_goods,u={order_id:n,car_price:i,price:a,list:[],text:""},c.map((function(e){var r=e.id,t=e.refund_price,n=e.refund_material_price;u.list.push({id:r,goods_price:t,material_price:n})})),f=e.options,d=f.agent,s=f.detail,p=d?"agent":"admin",!e.lockTap){r.next=8;break}return r.abrupt("return");case 8:return e.lockTap=!0,r.prev=9,r.next=12,e.$api[p].passRefundV2(u);case 12:e.$util.showToast({title:"操作成功"}),setTimeout((function(){e.$util.back(),e.updateTechnicianItem({key:"haveOperItem",val:!0}),s&&e.$util.getPage(-2).initRefresh(),e.$util.goUrl({url:1,openType:"navigateBack"})}),1e3),r.next=19;break;case 16:r.prev=16,r.t0=r["catch"](9),e.lockTap=!1;case 19:case"end":return r.stop()}}),r,null,[[9,16]])})))()}})};r.default=d},"6d10":function(e,r,t){"use strict";t.d(r,"b",(function(){return n})),t.d(r,"c",(function(){return o})),t.d(r,"a",(function(){}));var n=function(){var e=this,r=e.$createElement,t=(e._self._c,e.isLoad?e.__map(e.refundForm.order_goods,(function(r,t){var n=e.__get_orig(r),o=e.refundForm.order_goods.length,i=2!=e.refundForm.pay_type?[3,4,5].includes(e.refundForm.pay_type):null;return{$orig:n,g0:o,g1:i}})):null);e._isMounted||(e.e0=function(r){return r.stopPropagation(),e.$util.goUrl({url:1,openType:"navigateBack"})}),e.$mp.data=Object.assign({},{$root:{l0:t}})},o=[]},a930:function(e,r,t){"use strict";var n=t("5c1f"),o=t.n(n);o.a},d2e0:function(e,r,t){"use strict";(function(e,r){var n=t("47a9");t("65e9");n(t("3240"));var o=n(t("1bfe"));e.__webpack_require_UNI_MP_PLUGIN__=t,r(o.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])}},[["d2e0","common/runtime","common/vendor"]]]);