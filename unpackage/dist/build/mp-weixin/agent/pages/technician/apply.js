(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["agent/pages/technician/apply"],{"19c1":function(e,t,n){"use strict";n.r(t);var a=n("51a9"),i=n("8e4f");for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n("2a98");var o=n("828b"),c=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=c.exports},"2a98":function(e,t,n){"use strict";var a=n("8cb5"),i=n.n(a);i.a},"4c6c":function(e,t,n){"use strict";(function(e,t){var a=n("47a9");n("65e9");a(n("3240"));var i=a(n("19c1"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"51a9":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a}));var a={wPicker:function(){return n.e("components/w-picker/w-picker").then(n.bind(null,"ab68"))}},i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.isLoad?e.configInfo.plugAuth.store&&e.storeList.length>0:null),a=e.isLoad?e.$t("action.attendantName"):null,i=e.isLoad?e.form.text.length:null,r=!e.isLoad||i>300?null:e.form.text.length,o=e.isLoad&&1===e.form.is_work?e._f("handleStartEndTime")(e.form,e.toDay):null,c=e.isLoad?e.fdd_agreement&&e.fdd_agreement.hasOwnProperty("viewpdf_url")&&e.edit_base_info:null;e.$mp.data=Object.assign({},{$root:{g0:n,m0:a,g1:i,g2:r,f0:o,g3:c}})},r=[]},"8cb5":function(e,t,n){},"8e4f":function(e,t,n){"use strict";n.r(t);var a=n("ea64"),i=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=i.a},ea64:function(e,t,n){"use strict";(function(e){var a=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n("7eb4")),r=a(n("34cf")),o=a(n("ee10")),c=a(n("7ca3")),u=a(n("7942")),s=n("8f59");function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={components:{wPicker:function(){n.e("components/w-picker/w-picker").then(function(){return resolve(n("ab68"))}.bind(null,n)).catch(n.oe)}},data:function(){var e;return{isLoad:!1,options:{},edit_base_info:1,cityList:[],cityIndex:-1,storeList:[],storeIndex:-1,toDay:"",toDayTime:"",showKey:"",showTime:!1,sexList:[{id:0,title:"男"},{id:1,title:"女"}],workList:[{id:1,title:"接单"},{id:0,title:"休息"}],fdd_agreement:{},form:(e={id:0,user_id:"",nickName:"",coach_name:"",mobile:"",sex:0,birthday:"",work_time:"",city_id:"",store_id:"",store_name:"",free_fare_distance:"",lng:"",lat:"",address:"",text:"",id_code:"",id_card:[],id_card_fan:[],id_card_people:[],license:[],work_img:[],self_img:[]},(0,c.default)(e,"city_id",""),(0,c.default)(e,"video",[]),(0,c.default)(e,"order_num",0),(0,c.default)(e,"is_work",1),(0,c.default)(e,"start_time","00:00"),(0,c.default)(e,"end_time","23:59"),e),rule:[{name:"coach_name",checkType:"isNotNull",errorMsg:"输入您的姓名",regType:2},{name:"birthday",checkType:"isNotNull",errorMsg:"请选择您的生日",regType:2},{name:"mobile",checkType:"isMobile",errorMsg:"输入手机号"},{name:"work_time",checkType:"isNumber",errorMsg:"请输入从业年份，例如：5",regType:2},{name:"city_id",checkType:"isNotNull",errorMsg:"请选择意向工作城市"},{name:"free_fare_distance",checkType:"isFloatNum",errorMsg:"请输入公里数",regType:2,maxNum:"",unit:"公里"},{name:"address",checkType:"isNotNull",errorMsg:"请选择所在地址"},{name:"text",checkType:"isNotNull",errorMsg:"请输入"+this.$t("action.attendantName")+"简介",regType:2},{name:"id_code",checkType:"isIdCard",errorMsg:"输入您的身份证号码"},{name:"id_card",checkType:"isNotNull",errorMsg:"请上传身份证人像面"},{name:"id_card_fan",checkType:"isNotNull",errorMsg:"请上传身份证国徽面"},{name:"id_card_people",checkType:"isNotNull",errorMsg:"请上传手持身份证照片"},{name:"license",checkType:"isNotNull",errorMsg:"请上传资格证书"},{name:"work_img",checkType:"isNotNull",errorMsg:"请上传工作形象照"},{name:"self_img",checkType:"isNotNull",errorMsg:"请上传个人生活照"},{name:"order_num",checkType:"isNumber",errorMsg:"请输入虚拟订单量"}],have_user_id:!1,lockTap:!1}},computed:(0,s.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},userInfo:function(e){return e.user.userInfo},location:function(e){return e.user.location},locaRefuse:function(e){return e.user.locaRefuse},useChooseLocation:function(e){return e.user.useChooseLocation},userCoachStatus:function(e){return e.user.userCoachStatus},changeOnAddr:function(e){return e.user.changeOnAddr},noChangeLoca:function(e){return e.user.noChangeLoca}}),onLoad:function(t){var n=this;return(0,o.default)(i.default.mark((function a(){var r,o,c,u,s;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.id,o=void 0===r?0:r,c=t.view,u=void 0===c?0:c,n.edit_base_info=1*u===1?0:1,n.options=t,n.$util.showLoading(),a.next=6,n.initIndex();case 6:n.coach_status,n.form.admin_id,s=n.$t("action.attendantName"),e.setNavigationBarTitle({title:"".concat(n.edit_base_info?o?"编辑":"新增":"查看").concat(s)});case 10:case"end":return a.stop()}}),a)})))()},onShow:function(){this.useChooseLocation&&this.updateUserItem({key:"useChooseLocation",val:!1}),!this.location.lat&&this.locaRefuse&&this.toResetUtilLoca()},watch:{locaRefuse:function(e,t){e||this.toResetUtilLoca()},changeOnAddr:function(e,t){var n=this.noChangeLoca.noloca;e&&n&&this.initUtilLocaData()},noChangeLoca:function(e,t){var n=this;setTimeout((function(){var e=n.changeOnAddr,t=e.lat,a=e.lng,i=e.unix,r=void 0===i?0:i,o=n.noChangeLoca.noloca,c=n.$util.DateToUnix(n.$util.formatTime(new Date,"YY-M-D h:m:s"));o&&(!t&&!a||!r||r&&c-r>=1)&&n.getUtilLocation()}),800)}},methods:l(l(l({},(0,s.mapActions)(["getConfigInfo","getUserInfo"])),(0,s.mapMutations)(["updateUserItem","updateMapItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,o.default)(i.default.mark((function n(){var a,r,o,c,u,s,d,l,f;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.length>0&&void 0!==e[0]&&e[0],t.configInfo.id&&t.configInfo.hasOwnProperty("free_fare_bear")&&!a){n.next=4;break}return n.next=4,t.getConfigInfo();case 4:if(t.$util.setNavigationBarColor({bg:t.primaryColor}),r=new Date(Math.ceil((new Date).getTime())),t.toDay=t.$util.formatTime(r,"YY-M-D"),t.toDayTime=t.$util.formatTime(r,"h:m"),o=t.$refs.user_privacy.check(),!o||t.location.lat){n.next=13;break}return t.$refs.user_privacy.open(),t.$util.hideAll(),n.abrupt("return");case 13:return n.next=15,Promise.all([t.getCityList(),t.getStoreList()]);case 15:if(c=t.options.id,u=void 0===c?0:c,u){n.next=20;break}return t.isLoad=!0,t.$util.hideAll(),n.abrupt("return");case 20:return n.next=22,t.$api.agent.coachInfo({id:u});case 22:for(f in s=n.sent,s.free_fare_distance=null==s.free_fare_distance?"":s.free_fare_distance,d=["id_card","license","self_img"],d.map((function(e){s[e]=s[e]&&s[e].length>0?s[e].map((function(e){return{path:e}})):[]})),s.id_card&&s.id_card.length>1&&(s.id_card_fan=[s.id_card[1]],s.id_card_people=[s.id_card[2]],s.id_card.splice(1,3)),l=["work_img","video"],l.map((function(e){s[e]=s[e]&&s[e].length>0?[{path:s[e]}]:[]})),t.cityIndex=t.cityList.findIndex((function(e){return e.id==s.city_id})),t.storeIndex=t.storeList.findIndex((function(e){return e.id==s.store_id})),s.birthday=s.birthday?t.$util.formatTime(1e3*s.birthday,"YY-M-D"):"",t.form)t.form[f]=s[f];t.have_user_id=s.id&&s.user_id,t.fdd_agreement=s.fdd_agreement,t.isLoad=!0,t.$util.hideAll();case 37:case"end":return n.stop()}}),n)})))()},initRefresh:function(){this.initIndex(!0)},toResetUtilLoca:function(){return(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},toOpenLocation:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$refs.user_privacy.check(),!n){t.next=4;break}return e.$refs.user_privacy.open(),t.abrupt("return");case 4:return t.next=6,e.$util.checkAuth({type:"userLocation",checkApp:!0});case 6:e.initRefresh();case 7:case"end":return t.stop()}}),t)})))()},getStoreList:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n,a,r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.configInfo.plugAuth.store,a=void 0!==n&&n,!a){t.next=7;break}return t.next=4,e.$api.agent.storeSelect();case 4:r=t.sent,r.unshift({id:0,title:"不挂靠门店"}),e.storeList=r;case 7:case"end":return t.stop()}}),t)})))()},getCityList:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n,a,r,o,c,u,s,d,l,f,h,p,m,g;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.location,a=e.userCoachStatus,r=a.status,o=a.coach_position,n.lat&&(!n.lat||"暂未获取到位置信息"!=n.address)){t.next=17;break}if(2!=r||!o){t.next=14;break}if(c=e.changeOnAddr,u=c.lat,s=void 0===u?0:u,d=c.lng,l=void 0===d?0:d,f=c.unix,h=void 0===f?0:f,p=e.$util.DateToUnix(e.$util.formatTime(new Date,"YY-M-D h:m:s")),m=!(s&&l&&h&&p-h<3),m||(g=Object.assign({},e.location,{lat:s,lng:l,is_util_loca:1}),e.updateUserItem({key:"location",val:g})),e.updateUserItem({key:"noChangeLoca",val:{noloca:m}}),!e.noChangeLoca.noloca){t.next=11;break}return t.abrupt("return");case 11:e.initUtilLocaData(),t.next=15;break;case 14:e.getUtilLocation();case 15:return e.updateMapItem({key:"pageActive",val:!1}),t.abrupt("return");case 17:e.initUtilLocaData();case 18:case"end":return t.stop()}}),t)})))()},getUtilLocation:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n,a,r,o,c,u;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$util.getLocation();case 2:n=t.sent,a=n.lat,r=void 0===a?0:a,o=n.lng,c=void 0===o?0:o,u=Object.assign({},e.location,{lat:r,lng:c,is_util_loca:1}),e.updateUserItem({key:"location",val:u}),e.initUtilLocaData();case 10:case"end":return t.stop()}}),t)})))()},initUtilLocaData:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n,a,r,o,c,u;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.updateUserItem({key:"noChangeLoca",val:{noloca:!1}}),n=e.location,a=n.lng,r=void 0===a?0:a,o=n.lat,c=void 0===o?0:o,t.next=4,e.$api.base.getCity({lng:r,lat:c});case 4:u=t.sent,e.$util.hideAll(),e.cityList=u,e.cityIndex=u.length>0?0:-1,e.form.city_id=u.length>0?u[0].id:"",c&&r&&e.$util.getMapInfo();case 10:case"end":return t.stop()}}),t)})))()},toFddSign:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n,a;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.updateUserItem({key:"fddExtsign",val:""}),n=e.fdd_agreement.viewpdf_url,a=void 0===n?"":n,e.updateUserItem({key:"fddExtsign",val:a}),e.$util.goUrl({url:"/user/pages/common/web?url=fddExtsign"});case 4:case"end":return t.stop()}}),t)})))()},pickerChange:function(e,t){var n=e.target.value;if("birthday"===t){var a=this.$util.DateToUnix(n);return a>new Date(Math.ceil((new Date).getTime()))/1e3?void this.$util.showToast({title:"不能选择未来时间哦"}):void(this.form[t]=n)}this["".concat(t,"Index")]=n,this.form["".concat(t,"_id")]=this["".concat(t,"List")][n].id},imgUpload:function(e){var t=e.imagelist,n=e.imgtype;this.form[n]=t},toSetItem:function(e,t,n){var a=this.toCheckEdit();if(a){var i=this[n][e].id;this.form[t]=i}},toShowTime:function(e){var t=this.toCheckEdit();t&&(this.showKey=e,this.showTime=!0)},toCheckEdit:function(){var e=!0,t=this.edit_base_info;return t||(e=!1),e},onConfirm:function(e){this.form[this.showKey]=e.result},toChooseLocation:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.toCheckEdit(),n){t.next=3;break}return t.abrupt("return");case 3:if(e.updateUserItem({key:"useChooseLocation",val:!0}),e.location.lat){t.next=9;break}e.updateUserItem({key:"useChooseLocation",val:!1}),e.toOpenLocation(),t.next=12;break;case 9:return t.next=11,e.$util.checkAuth({type:"userLocation"});case 11:e.initChooseLoca();case 12:case"end":return t.stop()}}),t)})))()},initChooseLoca:function(){var t=arguments,n=this;return(0,o.default)(i.default.mark((function a(){var o,c,u,s,d,l,f,h,p,m,g,_,v,k;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=t.length>0&&void 0!==t[0]?t[0]:{},a.next=3,e.chooseLocation(o);case 3:if(c=a.sent,u=(0,r.default)(c,2),s=u[0],d=u[1],l=s?{name:"",address:"",latitude:"",longitude:""}:d,f=l.name,h=void 0===f?"":f,p=l.address,m=void 0===p?"":p,g=l.latitude,_=void 0===g?"":g,v=l.longitude,k=void 0===v?"":v,m=m||h,n.updateUserItem({key:"useChooseLocation",val:!1}),m){a.next=12;break}return a.abrupt("return");case 12:n.form.lat=_,n.form.lng=k,n.form.address=m;case 15:case"end":return a.stop()}}),a)})))()},toChooseUser:function(){var e=this.toCheckEdit();if(e){var t=this.have_user_id;t||this.$util.goUrl({url:"/agent/pages/technician/user"})}},validate:function(e){var t=this.configInfo,n=t.free_fare_bear,a=t.free_fare_distance,i=new this.$util.Validate;this.rule.map((function(t){var r=t.name;"free_fare_distance"==r?e[r]&&(1==n&&(t.maxNum=a),i.add(e[r],t)):i.add(e[r],t)}));var r=i.start();return r},submit:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n,a,r,o,c,u,s,d,l;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$util.deepCopy(e.form),a=["id_card","id_card_fan","id_card_people","work_img","video"],a.map((function(e){n[e]=n[e].length>0?n[e][0].path:""})),n.license=n.license.map((function(e){return e.path})),n.self_img=n.self_img.map((function(e){return e.path})),r=e.validate(n),!r){t.next=9;break}return e.$util.showToast({title:r}),t.abrupt("return");case 9:if(o=n.is_work,c=void 0===o?0:o,u=n.start_time,s=n.end_time,!c||u&&s){t.next=13;break}return e.$util.showToast({title:u?"请选择结束时间":"请选择开始时间"}),t.abrupt("return");case 13:if(n.free_fare_distance=n.free_fare_distance||0,n.birthday=e.$util.DateToUnix(n.birthday),n.id_card=[n.id_card,n.id_card_fan,n.id_card_people],delete n.id_card_fan,delete n.id_card_people,delete n.nickName,delete n.store_name,n.id&&delete n.admin_id,!e.lockTap){t.next=23;break}return t.abrupt("return");case 23:return e.lockTap=!0,e.$util.showLoading(),t.prev=25,d=e.options.is_edit,void 0===d?0:d,l=n.id?"coachUpdateAdmin":"coachApply",t.next=30,e.$api.agent[l](n);case 30:e.$util.hideAll(),e.$util.showToast({title:"提交成功"}),setTimeout((function(){e.$util.back(),e.$util.goUrl({url:1,openType:"navigateBack"})}),2e3),t.next=38;break;case 35:t.prev=35,t.t0=t["catch"](25),setTimeout((function(){e.lockTap=!1,e.$util.hideAll()}),2e3);case 38:case"end":return t.stop()}}),t,null,[[25,35]])})))()}}),filters:{handleStartEndTime:function(e,t){var n="",a=e.start_time,i=e.end_time,r="".concat(t," ").concat(a),o="".concat(t," ").concat(i);return a&&i&&u.default.DateToUnix(r)>=u.default.DateToUnix(o)&&(n="次日"),n}}};t.default=f}).call(this,n("df3c")["default"])}},[["4c6c","common/runtime","common/vendor"]]]);