(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["dynamic/pages/technician/detail"],{"39c1":function(t,e,n){"use strict";var i=n("7768"),a=n.n(i);a.a},7768:function(t,e,n){},"82b4":function(t,e,n){"use strict";(function(t,e){var i=n("47a9");n("65e9");i(n("3240"));var a=i(n("e75e"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"95e8":function(t,e,n){"use strict";n.r(e);var i=n("e813"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},e75e:function(t,e,n){"use strict";n.r(e);var i=n("f441"),a=n("95e8");for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);n("39c1");var r=n("828b"),c=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);e["default"]=c.exports},e813:function(t,e,n){"use strict";(function(t){var i=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(n("7eb4")),o=i(n("ee10")),r=i(n("7ca3")),c=n("8f59");function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var l={components:{technicianListPopup:function(){n.e("components/technician-list-popup").then(function(){return resolve(n("ff93"))}.bind(null,n)).catch(n.oe)}},data:function(){return{iconType:{1:"icon-kefuwu",2:"iconjishifuwu",3:"iconkeyuyue"},textType:{1:"可服务",2:"服务中",3:"可预约",4:"不可预约"},options:{},detail:{},videoNavHeight:"15px",showText:!1,loading:!0,param:{page:1},list:{data:[]},videoContexts:null,isPlay:!1,scrollTop:0,pageScrollTop:0,showComment:!1,inputFocus:!1,subForm:{text:""},rule:[{name:"text",checkType:"isNotNull",errorMsg:"请输入评论内容",regType:2}],popupInfo:{},lockTap:!1}},computed:(0,c.mapState)({primaryColor:function(t){return t.config.configInfo.primaryColor},subColor:function(t){return t.config.configInfo.subColor},configInfo:function(t){return t.config.configInfo},userInfo:function(t){return t.user.userInfo},location:function(t){return t.user.location},isGzhLogin:function(t){return t.user.isGzhLogin},userCoachStatus:function(t){return t.user.userCoachStatus},changeOnAddr:function(t){return t.user.changeOnAddr},noChangeLoca:function(t){return t.user.noChangeLoca}}),onLoad:function(t){this.$util.showLoading(),this.options=t,this.param.dynamic_id=t.id,this.$util.showLoading(),this.initIndex()},onUnload:function(){this.isPlay&&this.videoContexts.pause()},onPageScroll:function(t){var e=t.scrollTop;this.pageScrollTop=e},onPullDownRefresh:function(){t.showNavigationBarLoading(),this.initRefresh(),t.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},watch:{changeOnAddr:function(t,e){var n=this.noChangeLoca.noloca;t&&n&&this.initUtilLocaData()},noChangeLoca:function(t,e){var n=this;setTimeout((function(){var t=n.changeOnAddr,e=t.lat,i=t.lng,a=t.unix,o=void 0===a?0:a,r=n.noChangeLoca.noloca,c=n.$util.DateToUnix(n.$util.formatTime(new Date,"YY-M-D h:m:s"));r&&(!e&&!i||!o||o&&c-o>=1)&&n.getUtilLocation()}),800)}},methods:u(u(u({},(0,c.mapActions)(["getConfigInfo","getUserInfo"])),(0,c.mapMutations)(["updateUserItem","updateMapItem"])),{},{initIndex:function(){var t=arguments,e=this;return(0,o.default)(a.default.mark((function n(){var i,o,r,c,s,u;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=t.length>0&&void 0!==t[0]&&t[0],o=e.options.pid,r=void 0===o?0:o,e.isGzhLogin,c=e.userInfo.id,s=void 0===c?0:c,!r||s){n.next=7;break}return n.next=7,e.getUserInfo();case 7:if(e.configInfo.id&&!i){n.next=10;break}return n.next=10,e.getConfigInfo();case 10:return n.next=12,e.getDetail();case 12:return n.next=14,e.getList();case 14:u=e.configInfo.navBarHeight,e.videoNavHeight=1*u+15+"px",e.$util.setNavigationBarColor({bg:e.primaryColor});case 17:case"end":return n.stop()}}),n)})))()},initRefresh:function(){this.param.page=1,this.initIndex(!0)},getDetail:function(){var t=this;return(0,o.default)(a.default.mark((function e(){var n,i,o,r,c,s,u,l,d,f,p,h,m,g;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.location,i=t.userCoachStatus,o=i.status,r=i.coach_position,n.lat&&(!n.lat||"暂未获取到位置信息"!=n.address)){e.next=17;break}if(2!=o||!r){e.next=14;break}if(c=t.changeOnAddr,s=c.lat,u=void 0===s?0:s,l=c.lng,d=void 0===l?0:l,f=c.unix,p=void 0===f?0:f,h=t.$util.DateToUnix(t.$util.formatTime(new Date,"YY-M-D h:m:s")),m=!(u&&d&&p&&h-p<3),m||(g=Object.assign({},t.location,{lat:u,lng:d,is_util_loca:1}),t.updateUserItem({key:"location",val:g})),t.updateUserItem({key:"noChangeLoca",val:{noloca:m}}),!t.noChangeLoca.noloca){e.next=11;break}return e.abrupt("return");case 11:t.initUtilLocaData(),e.next=15;break;case 14:t.getUtilLocation();case 15:return t.updateMapItem({key:"pageActive",val:!1}),e.abrupt("return");case 17:t.initUtilLocaData();case 18:case"end":return e.stop()}}),e)})))()},getUtilLocation:function(){var t=this;return(0,o.default)(a.default.mark((function e(){var n,i,o,r,c,s;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$util.getLocation();case 2:n=e.sent,i=n.lat,o=void 0===i?0:i,r=n.lng,c=void 0===r?0:r,s=Object.assign({},t.location,{lat:o,lng:c,is_util_loca:1}),t.updateUserItem({key:"location",val:s}),t.initUtilLocaData();case 10:case"end":return e.stop()}}),e)})))()},initUtilLocaData:function(){var t=this;return(0,o.default)(a.default.mark((function e(){var n,i,o,r,c,s,u,l,d,f;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.updateUserItem({key:"noChangeLoca",val:{noloca:!1}}),n=t.options.id,i=t.location,o=i.lat,r=void 0===o?0:o,c=i.lng,s=void 0===c?0:c,u=i.is_util_loca,l=void 0===u?0:u,e.next=5,t.$api.dynamic.coachDynamicInfo({id:n,lat:r,lng:s});case 5:d=e.sent,f=d.text.length>42,d.have_show_text=f,t.showText=!f,t.detail=d,r&&s&&l&&t.$util.getMapInfo(),t.$util.hideAll();case 12:case"end":return e.stop()}}),e)})))()},getList:function(){var t=this;return(0,o.default)(a.default.mark((function e(){var n,i,o;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.list,i=t.param,e.next=3,t.$api.dynamic.commentList(i);case 3:o=e.sent,1==t.param.page||(o.data=n.data.concat(o.data)),t.list=o,t.loading=!1,t.$util.hideAll();case 7:case"end":return e.stop()}}),e)})))()},goBanner:function(t){this.$util.previewImage({current:t,urls:this.detail.imgs})},scrolltolower:function(t){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},toShowHide:function(t){this[t]=!this[t]},inputBlur:function(){var t=this;this.showComment&&this.$refs.comment_item.close(),this.$nextTick((function(){t.showComment=!1,t.inputFocus=!1}),0)},toChangeItem:function(e){var n=this;return(0,o.default)(a.default.mark((function i(){var o,r,c,s,u,l,d,f,p,h,m,g,v,x,w,b,_,y,k,$;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:o=n.detail,r=o.id,c=o.coach_id,s=o.cover,u=o.type,l=o.follow_status,d=o.thumbs_status,f=o.thumbs_num,i.t0=e,i.next=1===i.t0||2===i.t0?4:3===i.t0?10:4===i.t0?17:5===i.t0||6===i.t0?20:25;break;case 4:return p={1:{methodKey:"dynamic",methodModel:"followAddOrCancek",param:{dynamic_id:r,coach_id:c}},2:{methodKey:"dynamic",methodModel:"thumbsAddOrCancek",param:{dynamic_id:r}}},h=p[e],m=h.methodKey,g=h.methodModel,v=h.param,i.next=8,n.$api[m][g](v);case 8:return 1==e?n.detail.follow_status=l?0:1:(x=d?-1:1,n.detail.thumbs_num=f+x,n.detail.thumbs_status=x>0?1:0),i.abrupt("break",25);case 10:return n.showText=!1,w=n.scrollTop,b=n.pageScrollTop,1==u&&(!w||w&&b<w)&&(w?t.pageScrollTo({scrollTop:w,duration:0}):(_=n.configInfo.navBarHeight,y=void 0===_?88:_,k=t.createSelectorQuery().in(n),k.select(".comment-list-info").boundingClientRect((function(e){n.scrollTop=e.top-y,t.pageScrollTo({scrollTop:e.top-y,duration:0})})).exec())),n.showComment=1==u,n.$refs.comment_item.open(),setTimeout((function(){n.$nextTick((function(){n.inputFocus=!0}),10)}),200),i.abrupt("break",25);case 17:return n.$refs.show_item.close(),n.$util.goUrl({url:"/dynamic/pages/technician/edit?id=".concat(r)}),i.abrupt("break",25);case 20:return n.$refs.show_item.close(),$=5==e?"del_dynamic_item":"check_text_item",5==e&&(n.popupInfo={id:r,name:"",image:s,index:-1}),n.$refs[$].open(),i.abrupt("break",25);case 25:case"end":return i.stop()}}),i)})))()},validate:function(t){var e=new this.$util.Validate;this.rule.map((function(n){var i=n.name;e.add(t[i],n)}));var n=e.start();return n},toComment:function(){var t=this;return(0,o.default)(a.default.mark((function e(){var n,i,o,r,c,s;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.$util.deepCopy(t.subForm),i=t.options.id,n.dynamic_id=i,o=t.validate(n),!o){e.next=6;break}return e.abrupt("return");case 6:if(n.text=n.text.substring(0,200),!t.lockTap){e.next=9;break}return e.abrupt("return");case 9:return t.lockTap=!0,t.$util.showLoading(),e.prev=11,e.next=14,t.$api.dynamic.commentAdd(n);case 14:r=e.sent,c=r.status,s=void 0===c?1:c,t.$util.hideAll(),t.$util.showToast({title:1==s?"正在审核中":"评论成功"}),t.lockTap=!1,t.subForm.text="",t.showComment&&t.$refs.comment_item.close(),t.$nextTick((function(){t.showComment=!1,t.inputFocus=!1}),0),setTimeout((function(){t.initRefresh()}),1e3),e.next=29;break;case 26:e.prev=26,e.t0=e["catch"](11),setTimeout((function(){t.lockTap=!1,t.$util.hideAll()}),2e3);case 29:case"end":return e.stop()}}),e,null,[[11,26]])})))()},toDel:function(t){var e=this.list.data[t],n=e.id,i=(e.cover,e.status);this.popupInfo={id:n,name:"",image:"",index:t,status:i},this.$refs.del_item.open()},confirmDel:function(){var t=this;return(0,o.default)(a.default.mark((function e(){var n,i,o,r,c,s,u;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.popupInfo,i=n.id,o=n.index,r=n.status,c=t.detail.comment_num,!t.lockTap){e.next=4;break}return e.abrupt("return");case 4:return t.lockTap=!0,t.$util.showLoading(),s=-1==o?"del_dynamic_item":"del_item",u=-1==o?"dynamicDel":"commentDel",e.prev=8,e.next=11,t.$api.dynamic[u]({id:i});case 11:t.$util.hideAll(),t.$util.showToast({title:"删除成功"}),t.$refs[s].close(),-1!=o?(t.list.data.splice(o,1),t.lockTap=!1,1!=r&&(t.detail.comment_num=c-1)):setTimeout((function(){t.lockTap=!1,t.$util.back(),t.$util.goUrl({url:1,openType:"navigateBack"})}),2e3),e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](8),setTimeout((function(){t.lockTap=!1,t.$util.hideAll()}),2e3);case 20:case"end":return e.stop()}}),e,null,[[8,17]])})))()},toShowPopup:function(t){var e=this;return(0,o.default)(a.default.mark((function n(){var i,o,r,c,s;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e.$util.deepCopy(e.detail),o=i.coach_info,r=i.coach_id,c=o.is_work,c){n.next=5;break}return e.$util.showToast({title:"该".concat(e.$t("action.attendantName"),"未上班")}),n.abrupt("return");case 5:s=Object.assign({},o,{id:r}),e.$refs.technician_list_popup.toShowPopup(s,t);case 7:case"end":return n.stop()}}),n)})))()},screenChange:function(t){var e=this,n=t.detail.fullScreen,i=void 0!==n&&n;i||this.$nextTick((function(){e.videoContexts.pause(),e.videoContexts=null,e.isPlay=!1}))},playAndPauseVideo:function(){var e=this,n=this.videoContexts,i=void 0===n?null:n,a=this.$util.deepCopy(this.isPlay);if(null==i){var o=this.detail.id;this.videoContexts=t.createVideoContext("video_".concat(o),this),this.isPlay=!0}var r=a?"pause":"play";this.$nextTick((function(){e.videoContexts[r]()}))},onPlay:function(t){this.isPlay=!0},onPause:function(t){this.isPlay=!1},onEnded:function(t){this.isPlay=!1},onError:function(t){},onTimeUpdate:function(t){},onWaiting:function(t){},onProgress:function(t){},onLoadedMetaData:function(t){}})};e.default=l}).call(this,n("df3c")["default"])},f441:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.detail.id&&1==t.detail.type?t.detail.imgs.length:null),i=t.detail.id&&1==t.detail.type&&!t.showText?t.detail.text.substring(0,42):null,a=t.detail.id&&1==t.detail.type?t.list.data.length:null,o=t.detail.id&&1==t.detail.type&&t.loading?t.list.current_page>=t.list.last_page&&t.list.data.length>0:null,r=t.detail.id&&(1==t.detail.type&&2==t.detail.status||2==t.detail.type)&&2==t.detail.type&&!t.showText?t.detail.text.substring(0,42):null,c=t.detail.id?3==t.detail.status&&t.detail.check_text&&t.detail.check_text.length>0:null,s=t.detail.id?t.list.data.length:null,u=t.detail.id&&t.loading?t.list.current_page>=t.list.last_page&&t.list.data.length>0:null;t._isMounted||(t.e0=function(e){return e.stopPropagation(),t.$refs.show_item.open()},t.e1=function(e){return e.stopPropagation(),t.$refs.show_item.open()},t.e2=function(e){return e.stopPropagation(),t.$refs.show_item.close()},t.e3=function(e){return e.stopPropagation(),t.$refs.check_text_item.close()},t.e4=function(e){return e.stopPropagation(),t.$refs.comment_item.close()}),t.$mp.data=Object.assign({},{$root:{g0:n,g1:i,g2:a,g3:o,g4:r,g5:c,g6:s,g7:u}})},a=[]}},[["82b4","common/runtime","common/vendor"]]]);