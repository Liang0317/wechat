(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["dynamic/pages/detail"],{"1fca":function(t,e,n){"use strict";n.r(e);var a=n("7c99"),i=n("992a");for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n("37ca");var r=n("828b"),s=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);e["default"]=s.exports},"37ca":function(t,e,n){"use strict";var a=n("f359"),i=n.n(a);i.a},"7c99":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,n=(t._self._c,t.detail.id&&2==t.detail.status&&2===t.detail.coach_info.status&&1==t.detail.type?t.detail.imgs.length:null),a=t.detail.id&&2==t.detail.status&&2===t.detail.coach_info.status&&1==t.detail.type&&!t.showText?t.detail.text.substring(0,42):null,i=t.detail.id&&2==t.detail.status&&2===t.detail.coach_info.status&&1==t.detail.type?t.list.data.length:null,o=t.detail.id&&2==t.detail.status&&2===t.detail.coach_info.status&&1==t.detail.type&&t.loading?t.list.current_page>=t.list.last_page&&t.list.data.length>0:null,r=t.detail.id&&2==t.detail.status&&2===t.detail.coach_info.status&&2==t.detail.type&&!t.showText?t.detail.text.substring(0,42):null,s=t.detail.id&&2==t.detail.type?t.list.data.length:null,u=t.detail.id&&2==t.detail.type&&t.loading?t.list.current_page>=t.list.last_page&&t.list.data.length>0:null;t._isMounted||(t.e0=function(e){return e.stopPropagation(),t.$refs.show_item.open()},t.e1=function(e){return e.stopPropagation(),t.$refs.show_item.open()},t.e2=function(e){return e.stopPropagation(),t.$refs.show_item.close()},t.e3=function(e){return e.stopPropagation(),t.$refs.comment_item.close()}),t.$mp.data=Object.assign({},{$root:{g0:n,g1:a,g2:i,g3:o,g4:r,g5:s,g6:u}})},i=[]},"992a":function(t,e,n){"use strict";n.r(e);var a=n("ac0f"),i=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);e["default"]=i.a},ac0f:function(t,e,n){"use strict";(function(t){var a=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("7eb4")),o=a(n("7ca3")),r=a(n("ee10")),s=n("8f59"),u=a(n("56ce"));function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,o.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={components:{technicianListPopup:function(){n.e("components/technician-list-popup").then(function(){return resolve(n("ff93"))}.bind(null,n)).catch(n.oe)}},data:function(){return{iconType:{1:"icon-kefuwu",2:"iconjishifuwu",3:"iconkeyuyue",4:"iconkeyuyue"},textType:{1:"可服务",2:"服务中",3:"可预约",4:"不可预约"},options:{},detail:{},videoNavHeight:"15px",showText:!1,loading:!0,param:{page:1},list:{data:[]},videoContexts:null,isPlay:!1,scrollTop:0,pageScrollTop:0,showComment:!1,inputFocus:!1,subForm:{text:""},rule:[{name:"text",checkType:"isNotNull",errorMsg:"请输入评论内容",regType:2}],popupInfo:{},lockTap:!1}},computed:(0,s.mapState)({primaryColor:function(t){return t.config.configInfo.primaryColor},subColor:function(t){return t.config.configInfo.subColor},configInfo:function(t){return t.config.configInfo},userInfo:function(t){return t.user.userInfo},location:function(t){return t.user.location},isGzhLogin:function(t){return t.user.isGzhLogin},userCoachStatus:function(t){return t.user.userCoachStatus},changeOnAddr:function(t){return t.user.changeOnAddr},noChangeLoca:function(t){return t.user.noChangeLoca}}),onLoad:function(t){var e=this;return(0,r.default)(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.$util.showLoading(),e.options=t,e.param.dynamic_id=t.id,e.$util.showLoading(),n.next=6,e.initIndex();case 6:case"end":return n.stop()}}),n)})))()},onUnload:function(){this.isPlay&&this.videoContexts.pause()},onPageScroll:function(t){var e=t.scrollTop;this.pageScrollTop=e},onPullDownRefresh:function(){t.showNavigationBarLoading(),this.initRefresh(),t.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},onShareAppMessage:function(t){var e=this.userInfo.id,n=void 0===e?0:e,a=this.detail,i=a.id,o=a.title,r=a.cover,s="/dynamic/pages/detail?pid=".concat(n,"&id=").concat(i);return this.$util.log(s),{title:o,imageUrl:r,path:s}},watch:{changeOnAddr:function(t,e){var n=this.noChangeLoca.noloca;t&&n&&this.initUtilLocaData()},noChangeLoca:function(t,e){var n=this;setTimeout((function(){var t=n.changeOnAddr,e=t.lat,a=t.lng,i=t.unix,o=void 0===i?0:i,r=n.noChangeLoca.noloca,s=n.$util.DateToUnix(n.$util.formatTime(new Date,"YY-M-D h:m:s"));r&&(!e&&!a||!o||o&&s-o>=1)&&n.getUtilLocation()}),800)}},methods:l(l(l({},(0,s.mapActions)(["getConfigInfo","getUserInfo"])),(0,s.mapMutations)(["updateUserItem","updateMapItem"])),{},{initIndex:function(){var t=arguments,e=this;return(0,r.default)(i.default.mark((function n(){var a,o,r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.length>0&&void 0!==t[0]&&t[0],e.configInfo.id&&!a){n.next=4;break}return n.next=4,e.getConfigInfo();case 4:return o=e.userInfo.id,void 0===o?0:o,e.isGzhLogin,n.next=8,e.getDetail(a);case 8:r=e.configInfo.navBarHeight,e.detail.type,e.videoNavHeight=1*r+15+"px",e.$util.setNavigationBarColor({bg:e.primaryColor});case 12:case"end":return n.stop()}}),n)})))()},initRefresh:function(){this.param.page=1,this.initIndex(!0)},toAppShare:function(){var t=this.userInfo.id,e=void 0===t?0:t,n=this.detail,a=n.id,i=(n.title,n.cover,u.default.siteroot),o=i.split("/index.php")[0];"".concat(o,"/h5/#/dynamic/pages/detail?id=").concat(a,"&pid=").concat(e)},getDetail:function(){var t=this;return(0,r.default)(i.default.mark((function e(){var n,a,o,r,s,u,c,l,d,f,p,h,m,g,v;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.location,a=void 0===n?{lat:0,lng:0}:n,o=t.userCoachStatus,r=o.status,s=o.coach_position,a.lat&&(!a.lat||"暂未获取到位置信息"!=a.address)){e.next=17;break}if(2!=r||!s){e.next=14;break}if(u=t.changeOnAddr,c=u.lat,l=void 0===c?0:c,d=u.lng,f=void 0===d?0:d,p=u.unix,h=void 0===p?0:p,m=t.$util.DateToUnix(t.$util.formatTime(new Date,"YY-M-D h:m:s")),g=!(l&&f&&h&&m-h<3),g||(v=Object.assign({},t.location,{lat:l,lng:f,is_util_loca:1}),t.updateUserItem({key:"location",val:v})),t.updateUserItem({key:"noChangeLoca",val:{noloca:g}}),!t.noChangeLoca.noloca){e.next=11;break}return e.abrupt("return");case 11:t.initUtilLocaData(),e.next=15;break;case 14:t.getUtilLocation();case 15:return t.updateMapItem({key:"pageActive",val:!1}),e.abrupt("return");case 17:t.initUtilLocaData();case 18:case"end":return e.stop()}}),e)})))()},getUtilLocation:function(){var t=this;return(0,r.default)(i.default.mark((function e(){var n,a,o,r,s,u;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$util.getLocation();case 2:n=e.sent,a=n.lat,o=void 0===a?0:a,r=n.lng,s=void 0===r?0:r,u=Object.assign({},t.location,{lat:o,lng:s,is_util_loca:1}),t.updateUserItem({key:"location",val:u}),t.initUtilLocaData();case 10:case"end":return e.stop()}}),e)})))()},initUtilLocaData:function(){var t=this;return(0,r.default)(i.default.mark((function e(){var n,a,o,r,s,u,c,l,d,f;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.updateUserItem({key:"noChangeLoca",val:{noloca:!1}}),n=t.options.id,a=t.location,o=a.lat,r=void 0===o?0:o,s=a.lng,u=void 0===s?0:s,c=a.is_util_loca,l=void 0===c?0:c,e.next=5,t.$api.dynamic.dynamicInfo({id:n,lat:r,lng:u});case 5:return d=e.sent,f=d.text.length>42,d.have_show_text=f,t.showText=!f,t.detail=d,t.$util.hideAll(),e.next=13,t.getList();case 13:r&&u&&l&&t.$util.getMapInfo();case 14:case"end":return e.stop()}}),e)})))()},getList:function(){var t=this;return(0,r.default)(i.default.mark((function e(){var n,a,o;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.list,a=t.param,e.next=3,t.$api.dynamic.commentList(a);case 3:o=e.sent,1==t.param.page||(o.data=n.data.concat(o.data)),t.list=o,t.loading=!1,t.$util.hideAll();case 7:case"end":return e.stop()}}),e)})))()},goBanner:function(t){this.$util.previewImage({current:t,urls:this.detail.imgs})},scrolltolower:function(t){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},toShowHide:function(t){this[t]=!this[t]},inputBlur:function(){var t=this;this.showComment&&this.$refs.comment_item.close(),this.$nextTick((function(){t.showComment=!1,t.inputFocus=!1}))},toChangeItem:function(e){var n=this;return(0,r.default)(i.default.mark((function a(){var o,r,s,u,c,l,d,f,p,h,m,g,v,w,x,b,y,_;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=n.detail,r=o.id,s=o.coach_id,u=o.type,c=o.follow_status,l=o.thumbs_status,d=o.thumbs_num,3!=e){a.next=9;break}return n.showText=!1,f=n.scrollTop,p=n.pageScrollTop,1==u&&(!f||f&&p<f)&&(f?t.pageScrollTo({scrollTop:f,duration:0}):(h=n.configInfo.navBarHeight,m=void 0===h?88:h,g=t.createSelectorQuery().in(n),g.select(".comment-list-info").boundingClientRect((function(e){n.scrollTop=e.top-m,t.pageScrollTo({scrollTop:e.top-m,duration:0})})).exec())),n.showComment=1==u,n.$refs.comment_item.open(),setTimeout((function(){n.$nextTick((function(){n.inputFocus=!0}),10)}),200),a.abrupt("return");case 9:return v={1:{methodKey:"dynamic",methodModel:"followAddOrCancek",param:{dynamic_id:r,coach_id:s}},2:{methodKey:"dynamic",methodModel:"thumbsAddOrCancek",param:{dynamic_id:r}},4:{methodKey:"mine",methodModel:"shieldCoachAdd",param:{type:1,coach_id:s}}},w=v[e],x=w.methodKey,b=w.methodModel,y=w.param,a.next=13,n.$api[x][b](y);case 13:a.t0=e,a.next=1===a.t0?16:2===a.t0?18:4===a.t0?22:25;break;case 16:return n.detail.follow_status=c?0:1,a.abrupt("break",25);case 18:return _=l?-1:1,n.detail.thumbs_num=d+_,n.detail.thumbs_status=_>0?1:0,a.abrupt("break",25);case 22:return n.$util.showToast({title:"操作成功"}),setTimeout((function(){n.$util.back(),n.$util.goUrl({url:1,openType:"navigateBack"})}),2e3),a.abrupt("break",25);case 25:case"end":return a.stop()}}),a)})))()},validate:function(t){var e=new this.$util.Validate;this.rule.map((function(n){var a=n.name;e.add(t[a],n)}));var n=e.start();return n},toComment:function(){var t=this;return(0,r.default)(i.default.mark((function e(){var n,a,o,r,s,u;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.$util.deepCopy(t.subForm),a=t.options.id,n.dynamic_id=a,o=t.validate(n),!o){e.next=6;break}return e.abrupt("return");case 6:if(n.text=n.text.substring(0,200),!t.lockTap){e.next=9;break}return e.abrupt("return");case 9:return t.lockTap=!0,t.$util.showLoading(),e.prev=11,e.next=14,t.$api.dynamic.commentAdd(n);case 14:r=e.sent,s=r.status,u=void 0===s?1:s,t.$util.hideAll(),t.$util.showToast({title:1==u?"正在审核中":"评论成功"}),t.subForm.text="",t.showComment&&t.$refs.comment_item.close(),t.$nextTick((function(){t.showComment=!1,t.inputFocus=!1})),setTimeout((function(){t.lockTap=!1,t.initRefresh()}),1e3),e.next=28;break;case 25:e.prev=25,e.t0=e["catch"](11),setTimeout((function(){t.lockTap=!1,t.$util.hideAll()}),2e3);case 28:case"end":return e.stop()}}),e,null,[[11,25]])})))()},toDel:function(t){var e=this.list.data[t],n=e.id,a=(e.cover,e.del_auth),i=e.status;a&&(this.popupInfo={id:n,name:"",image:"",index:t,status:i},this.$refs.del_item.open())},confirmDel:function(){var t=this;return(0,r.default)(i.default.mark((function e(){var n,a,o,r,s;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.popupInfo,a=n.id,o=n.index,r=n.status,s=t.detail.comment_num,!t.lockTap){e.next=4;break}return e.abrupt("return");case 4:return t.lockTap=!0,t.$util.showLoading(),e.prev=6,e.next=9,t.$api.dynamic.commentDel({id:a});case 9:t.$util.hideAll(),t.list.data.splice(o,1),t.lockTap=!1,1!=r&&(t.detail.comment_num=s-1),t.$util.showToast({title:"删除成功"}),t.$refs.del_item.close(),e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](6),setTimeout((function(){t.lockTap=!1,t.$util.hideAll()}),2e3);case 20:case"end":return e.stop()}}),e,null,[[6,17]])})))()},toShowPopup:function(t){var e=this;return(0,r.default)(i.default.mark((function n(){var a,o,r,s,u;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.$util.deepCopy(e.detail),o=a.coach_info,r=a.coach_id,s=o.is_work,s){n.next=5;break}return e.$util.showToast({title:"该".concat(e.$t("action.attendantName"),"未上班")}),n.abrupt("return");case 5:u=Object.assign({},o,{id:r}),e.$refs.technician_list_popup.toShowPopup(u,t);case 7:case"end":return n.stop()}}),n)})))()},screenChange:function(t){var e=this,n=t.detail.fullScreen,a=void 0!==n&&n;a||this.$nextTick((function(){e.videoContexts.pause(),e.videoContexts=null,e.isPlay=!1}))},playAndPauseVideo:function(){var e=this,n=this.videoContexts,a=void 0===n?null:n,i=this.$util.deepCopy(this.isPlay);if(null==a){var o=this.detail.id;this.videoContexts=t.createVideoContext("video_".concat(o),this),this.isPlay=!0}var r=i?"pause":"play";this.$nextTick((function(){e.videoContexts[r]()}))},onPlay:function(t){this.isPlay=!0},onPause:function(t){this.isPlay=!1},onEnded:function(t){this.isPlay=!1},onError:function(t){},onTimeUpdate:function(t){},onWaiting:function(t){},onProgress:function(t){},onLoadedMetaData:function(t){}})};e.default=d}).call(this,n("df3c")["default"])},b375:function(t,e,n){"use strict";(function(t,e){var a=n("47a9");n("65e9");a(n("3240"));var i=a(n("1fca"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},f359:function(t,e,n){}},[["b375","common/runtime","common/vendor"]]]);