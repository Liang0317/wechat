(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["technician/pages/edit"],{"000e":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("7eb4")),i=r(n("34cf")),o=r(n("ee10")),c=r(n("7ca3")),u=n("8f59");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={components:{wPicker:function(){n.e("components/w-picker/w-picker").then(function(){return resolve(n("ab68"))}.bind(null,n)).catch(n.oe)}},data:function(){var e;return{isLoad:!1,options:{},cityList:[],cityIndex:-1,storeList:[],storeIndex:0,old_phone:"",authTime:0,timer:null,coach_status:0,form:(e={id:0,admin_id:0,coach_name:"",mobile:"",short_code:"",sex:0,birthday:"",work_time:"",city_id:"",store_id:"",free_fare_distance:"",lng:"",lat:"",address:"",text:"",id_code:"",id_card:[],id_card_fan:[],id_card_people:[],license:[],work_img:[],self_img:[]},(0,c.default)(e,"city_id",""),(0,c.default)(e,"video",[]),e),rule:[{name:"coach_name",checkType:"isNotNull",errorMsg:"输入您的姓名",regType:2},{name:"birthday",checkType:"isNotNull",errorMsg:"请选择您的生日",regType:2},{name:"mobile",checkType:"isMobile",errorMsg:"输入手机号"},{name:"work_time",checkType:"isNumber",errorMsg:"请输入从业年份，例如：5",regType:2},{name:"city_id",checkType:"isNotNull",errorMsg:"请选择意向工作城市"},{name:"free_fare_distance",checkType:"isFloatNum",errorMsg:"请输入公里数",regType:2,maxNum:"",unit:"公里"},{name:"address",checkType:"isNotNull",errorMsg:"请选择所在地址"},{name:"text",checkType:"isNotNull",errorMsg:"请输入"+this.$t("action.attendantName")+"简介",regType:2},{name:"id_code",checkType:"isIdCard",errorMsg:"输入您的身份证号码"},{name:"id_card",checkType:"isNotNull",errorMsg:"请上传身份证人像面"},{name:"id_card_fan",checkType:"isNotNull",errorMsg:"请上传身份证国徽面"},{name:"id_card_people",checkType:"isNotNull",errorMsg:"请上传手持身份证照片"},{name:"license",checkType:"isNotNull",errorMsg:"请上传资格证书"},{name:"work_img",checkType:"isNotNull",errorMsg:"请上传工作形象照"},{name:"self_img",checkType:"isNotNull",errorMsg:"请上传个人生活照"}],lockTap:!1}},computed:(0,u.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},userInfo:function(e){return e.user.userInfo},location:function(e){return e.user.location},locaRefuse:function(e){return e.user.locaRefuse},useChooseLocation:function(e){return e.user.useChooseLocation},userCoachStatus:function(e){return e.user.userCoachStatus},changeOnAddr:function(e){return e.user.changeOnAddr},noChangeLoca:function(e){return e.user.noChangeLoca}}),onLoad:function(e){var t=this;return(0,o.default)(a.default.mark((function n(){var r,i,o,c,u;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e,i=r.admin_id,o=void 0===i?0:i,c=r.is_edit,u=void 0===c?0:c,e.is_edit=u,!o){n.next=8;break}return n.next=5,t.updateCommonOptions(e);case 5:n.t0=n.sent,n.next=9;break;case 8:n.t0=e;case 9:return e=n.t0,t.options=e,t.form.admin_id=o,t.$util.showLoading(),n.next=15,t.initIndex();case 15:case"end":return n.stop()}}),n)})))()},onShow:function(){var e=this;return(0,o.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.useChooseLocation&&e.updateUserItem({key:"useChooseLocation",val:!1}),!e.location.lat&&e.locaRefuse&&e.toResetUtilLoca();case 2:case"end":return t.stop()}}),t)})))()},onUnload:function(){this.timer&&clearInterval(this.timer)},watch:{locaRefuse:function(e,t){e||this.toResetUtilLoca()},changeOnAddr:function(e,t){var n=this.noChangeLoca.noloca;e&&n&&this.initUtilLocaData()},noChangeLoca:function(e,t){var n=this;setTimeout((function(){var e=n.changeOnAddr,t=e.lat,r=e.lng,a=e.unix,i=void 0===a?0:a,o=n.noChangeLoca.noloca,c=n.$util.DateToUnix(n.$util.formatTime(new Date,"YY-M-D h:m:s"));o&&(!t&&!r||!i||i&&c-i>=1)&&n.getUtilLocation()}),800)}},methods:l(l(l({},(0,u.mapActions)(["getConfigInfo","getUserInfo","updateCommonOptions"])),(0,u.mapMutations)(["updateUserItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,o.default)(a.default.mark((function n(){var r,i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.length>0&&void 0!==e[0]&&e[0],t.configInfo.id&&t.configInfo.hasOwnProperty("free_fare_bear")&&!r){n.next=4;break}return n.next=4,t.getConfigInfo();case 4:if(t.$util.setNavigationBarColor({bg:t.primaryColor}),i=t.$refs.user_privacy.check(),!i||t.location.lat){n.next=10;break}return t.$refs.user_privacy.open(),t.$util.hideAll(),n.abrupt("return");case 10:return n.next=12,t.getCityList();case 12:case"end":return n.stop()}}),n)})))()},initRefresh:function(){this.initIndex(!0)},toResetUtilLoca:function(){return(0,o.default)(a.default.mark((function e(){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},toOpenLocation:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$refs.user_privacy.check(),!n){t.next=4;break}return e.$refs.user_privacy.open(),t.abrupt("return");case 4:return t.next=6,e.$util.checkAuth({type:"userLocation",checkApp:!0});case 6:e.initRefresh();case 7:case"end":return t.stop()}}),t)})))()},getCityList:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,i,o,c,u,s,l,d,f,p,h,m,g;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.location,r=e.userCoachStatus,i=r.status,o=r.coach_position,n.lat&&(!n.lat||"暂未获取到位置信息"!=n.address)){t.next=16;break}if(2!=i||!o){t.next=14;break}if(c=e.changeOnAddr,u=c.lat,s=void 0===u?0:u,l=c.lng,d=void 0===l?0:l,f=c.unix,p=void 0===f?0:f,h=e.$util.DateToUnix(e.$util.formatTime(new Date,"YY-M-D h:m:s")),m=!(s&&d&&p&&h-p<3),m||(g=Object.assign({},e.location,{lat:s,lng:d,is_util_loca:1}),e.updateUserItem({key:"location",val:g})),e.updateUserItem({key:"noChangeLoca",val:{noloca:m}}),!e.noChangeLoca.noloca){t.next=11;break}return t.abrupt("return");case 11:e.initUtilLocaData(),t.next=15;break;case 14:e.getUtilLocation();case 15:return t.abrupt("return");case 16:e.initUtilLocaData();case 17:case"end":return t.stop()}}),t)})))()},getUtilLocation:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,i,o,c,u;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$util.getLocation();case 2:n=t.sent,r=n.lat,i=void 0===r?0:r,o=n.lng,c=void 0===o?0:o,u=Object.assign({},e.location,{lat:i,lng:c,is_util_loca:1}),e.updateUserItem({key:"location",val:u}),e.initUtilLocaData();case 10:case"end":return t.stop()}}),t)})))()},initUtilLocaData:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,o,c,u,s,l,d,f,p,h,m,g;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.updateUserItem({key:"noChangeLoca",val:{noloca:!1}}),n=e.location,r=n.lng,o=void 0===r?0:r,c=n.lat,u=void 0===c?0:c,t.next=4,Promise.all([e.$api.technician.coachInfo(),e.$api.base.getCity({lng:o,lat:u})]);case 4:return s=t.sent,l=(0,i.default)(s,2),d=l[0],f=l[1],e.$util.hideAll(),e.cityList=f,e.form.admin_id=d.id?d.admin_id:0,t.next=13,e.getStoreList();case 13:if(d&&(!d||d.id)){t.next=17;break}return f.length>0&&(e.form.city_id=f[0].id,e.cityIndex=0),e.isLoad=!0,t.abrupt("return");case 17:for(m in d.free_fare_distance=null==d.free_fare_distance?"":d.free_fare_distance,p=["id_card","license","self_img"],p.map((function(e){d[e]=d[e]&&d[e].length>0?d[e].map((function(e){return{path:e}})):[]})),d.id_card&&d.id_card.length>1&&(d.id_card_fan=[d.id_card[1]],d.id_card_people=[d.id_card[2]],d.id_card.splice(1,3)),h=["work_img","video"],h.map((function(e){d[e]=d[e]&&d[e].length>0?[{path:d[e]}]:[]})),d.birthday=d.birthday?e.$util.formatTime(1e3*d.birthday,"YY-M-D"):"",e.form)e.form[m]=d[m];g=["mobile","status"],g.map((function(t){e["mobile"==t?"old_phone":"coach_status"]=d[t]})),e.cityIndex=e.cityList.findIndex((function(e){return e.id==d.city_id})),e.storeIndex=e.storeList.findIndex((function(e){return e.id==d.store_id})),e.isLoad=!0,u&&o&&e.$util.getMapInfo();case 31:case"end":return t.stop()}}),t)})))()},getStoreList:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,i;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.form.admin_id,r=void 0===n?0:n,r){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.$api.mine.getStoreSelect({admin_id:r});case 5:i=t.sent,i.unshift({id:0,title:"不挂靠门店"}),e.storeList=i;case 8:case"end":return t.stop()}}),t)})))()},pickerChange:function(e,t){var n=e.target.value;if("birthday"===t){var r=this.$util.DateToUnix(n);return r>new Date(Math.ceil((new Date).getTime()))/1e3?void this.$util.showToast({title:"不能选择未来时间哦"}):void(this.form[t]=n)}this["".concat(t,"Index")]=n,this.form["".concat(t,"_id")]=this["".concat(t,"List")][n].id},toSend:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,i,o;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.authTime,!n){t.next=3;break}return t.abrupt("return");case 3:if(r=e.form.mobile,i=void 0===r?"":r,null!=i&&/^(1[0-9]{10})$/.test(i)){t.next=7;break}return e.$util.showToast({title:null==i?"请输入手机号":"".concat(i," 手机号无效")}),t.abrupt("return");case 7:if(!e.lockTap){t.next=9;break}return t.abrupt("return");case 9:return e.lockTap=!0,e.$util.showLoading(),t.prev=11,t.next=14,e.$api.user.sendShortMsg({phone:i});case 14:e.$util.hideAll(),e.lockTap=!1,o=60,e.timer=setInterval((function(){0!==o?(o--,e.authTime=o):clearInterval(e.timer)}),1e3),t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](11),setTimeout((function(){e.lockTap=!1,e.$util.hideAll()}),2e3);case 23:case"end":return t.stop()}}),t,null,[[11,20]])})))()},imgUpload:function(e){var t=e.imagelist,n=e.imgtype;this.form[n]=t},toChooseLocation:function(){var e=this;return(0,o.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.updateUserItem({key:"useChooseLocation",val:!0}),e.location.lat){t.next=6;break}e.updateUserItem({key:"useChooseLocation",val:!1}),e.toOpenLocation(),t.next=9;break;case 6:return t.next=8,e.$util.checkAuth({type:"userLocation"});case 8:e.initChooseLoca();case 9:case"end":return t.stop()}}),t)})))()},initChooseLoca:function(){var t=arguments,n=this;return(0,o.default)(a.default.mark((function r(){var o,c,u,s,l,d,f,p,h,m,g,_,v,b;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.length>0&&void 0!==t[0]?t[0]:{},r.next=3,e.chooseLocation(o);case 3:if(c=r.sent,u=(0,i.default)(c,2),s=u[0],l=u[1],d=s?{name:"",address:"",latitude:"",longitude:""}:l,f=d.name,p=void 0===f?"":f,h=d.address,m=void 0===h?"":h,g=d.latitude,_=void 0===g?"":g,v=d.longitude,b=void 0===v?"":v,m=m||p,n.updateUserItem({key:"useChooseLocation",val:!1}),m){r.next=12;break}return r.abrupt("return");case 12:n.form.lat=_,n.form.lng=b,n.form.address=m;case 15:case"end":return r.stop()}}),r)})))()},validate:function(e){var t=this.configInfo,n=t.free_fare_bear,r=t.free_fare_distance,a=new this.$util.Validate;this.rule.map((function(t){var i=t.name;"free_fare_distance"==i?e[i]&&(1==n&&(t.maxNum=r),a.add(e[i],t)):a.add(e[i],t)}));var i=a.start();return i},submit:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,i,o,c;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$util.deepCopy(e.form),r=["id_card","id_card_fan","id_card_people","work_img","video"],r.map((function(e){n[e]=n[e]&&n[e].length>0?n[e][0].path:""})),n.license=n.license.map((function(e){return e.path})),n.self_img=n.self_img.map((function(e){return e.path})),i=e.validate(n),!i){t.next=9;break}return e.$util.showToast({title:i}),t.abrupt("return");case 9:if(n.free_fare_distance=n.free_fare_distance||0,n.birthday=e.$util.DateToUnix(n.birthday),n.id_card=[n.id_card,n.id_card_fan,n.id_card_people],delete n.id_card_fan,delete n.id_card_people,delete n.admin_id,o=e.old_phone,c=e.configInfo.short_code_status,!c||o==n.mobile||null!=n.short_code&&6==n.short_code.length){t.next=20;break}return e.$util.showToast({title:"请输入6位数短信验证码"}),t.abrupt("return");case 20:if(c&&o!=n.mobile||delete n.short_code,!e.lockTap){t.next=23;break}return t.abrupt("return");case 23:return e.lockTap=!0,e.$util.showLoading(),t.prev=25,t.next=28,e.$api.technician.coachUpdateV2(n);case 28:e.$util.hideAll(),e.$util.showToast({title:"提交成功"}),e.timer&&clearInterval(e.timer),setTimeout((function(){getCurrentPages().length>1&&e.$util.back(),e.$util.goUrl({url:"/pages/mine",openType:"reLaunch"})}),2e3),t.next=37;break;case 34:t.prev=34,t.t0=t["catch"](25),setTimeout((function(){e.lockTap=!1,e.$util.hideAll()}),2e3);case 37:case"end":return t.stop()}}),t,null,[[25,34]])})))()}})};t.default=d}).call(this,n("df3c")["default"])},"347c":function(e,t,n){},"4d04":function(e,t,n){"use strict";(function(e,t){var r=n("47a9");n("65e9");r(n("3240"));var a=r(n("74d8"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"74d8":function(e,t,n){"use strict";n.r(t);var r=n("d67f"),a=n("d7e9");for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("7523");var o=n("828b"),c=Object(o["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=c.exports},7523:function(e,t,n){"use strict";var r=n("347c"),a=n.n(r);a.a},d67f:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.isLoad?e.configInfo.short_code_status&&11==e.form.mobile.length&&e.form.mobile!==e.old_phone:null),r=e.isLoad?e.$t("action.attendantName"):null,a=e.isLoad?e.form.text.length:null,i=!e.isLoad||a>300?null:e.form.text.length;e._isMounted||(e.e0=function(t,n){var r=arguments[arguments.length-1].currentTarget.dataset,a=r.eventParams||r["event-params"];n=a.index;t.stopPropagation(),e.form.sex=n}),e.$mp.data=Object.assign({},{$root:{g0:n,m0:r,g1:a,g2:i}})},a=[]},d7e9:function(e,t,n){"use strict";n.r(t);var r=n("000e"),a=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);t["default"]=a.a}},[["4d04","common/runtime","common/vendor"]]]);