(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["technician/pages/apply"],{"0658":function(e,t,n){},"08f4":function(e,t,n){"use strict";var r=n("0658"),a=n.n(r);a.a},"387b":function(e,t,n){"use strict";n.r(t);var r=n("92f2"),a=n("4201");for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("08f4");var o=n("828b"),c=Object(o["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=c.exports},4201:function(e,t,n){"use strict";n.r(t);var r=n("f595"),a=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);t["default"]=a.a},7672:function(e,t,n){"use strict";(function(e,t){var r=n("47a9");n("65e9");r(n("3240"));var a=r(n("387b"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"92f2":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.isLoad?(e.options.admin_id||e.options.type)&&-1!=e.coach_status||!e.options.admin_id&&!e.options.type&&[1,2,3].includes(e.coach_status):null),r=e.isLoad&&!n&&2==e.configInfo.coach_apply_type?e.$t("action.attendantName"):null,a=e.isLoad&&!n&&2==e.configInfo.coach_apply_type?e.form.text.length:null,i=!e.isLoad||n||2!=e.configInfo.coach_apply_type||a>300?null:e.form.text.length;e._isMounted||(e.e0=function(t){return e.$util.goUrl({url:"/pages/mine",openType:"reLaunch"})},e.e1=function(t,n){var r=arguments[arguments.length-1].currentTarget.dataset,a=r.eventParams||r["event-params"];n=a.index;t.stopPropagation(),e.form.sex=n}),e.$mp.data=Object.assign({},{$root:{g0:n,m0:r,g1:a,g2:i}})},a=[]},f595:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("7eb4")),i=r(n("34cf")),o=r(n("ee10")),c=r(n("7ca3")),u=n("8f59");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={components:{},data:function(){var e;return{isLoad:!1,options:{},cityList:[],cityIndex:-1,storeList:[],storeIndex:0,tipArr:{1:[{text:"审核成功后将直接入驻平台",color:0}],2:[{text:"恭喜您，审核通过！",color:0},{text:"快去管理订单吧",color:0}],3:[{text:"平台管理员已取消授权",color:0}],4:[{text:"请联系平台管理人员询问原因",color:0}]},buttonArr:{1:[{text:"个人中心",type:"cancel"}],2:[{text:"去管理",type:"confirm"}],3:[{text:"个人中心",type:"cancel"}],4:[{text:"再次申请",type:"confirm"},{text:"个人中心",type:"cancel"}]},title:{1:"等待审核",2:"您已经是"+this.$t("action.attendantName")+"了",3:"取消授权",4:"申请失败"},image:{1:"https://lbqny.migugu.com/admin/public/apply_wait.jpg",2:"https://lbqny.migugu.com/admin/public/apply_suc.jpg",3:"https://lbqny.migugu.com/admin/public/apply_fail.jpg",4:"https://lbqny.migugu.com/admin/public/apply_fail.jpg"},coach_status:-1,max_level:0,authTime:0,timer:null,is_send:!0,form:(e={id:0,admin_id:0,partner_id:0,coach_name:"",mobile:"",short_code:"",sex:0,birthday:"",work_time:"",city_id:"",store_id:"",free_fare_distance:"",lng:"",lat:"",address:"",text:"",id_code:"",id_card:[],id_card_fan:[],id_card_people:[],license:[],work_img:[],self_img:[]},(0,c.default)(e,"city_id",""),(0,c.default)(e,"video",[]),(0,c.default)(e,"is_work",1),e),rule:[{name:"coach_name",checkType:"isNotNull",errorMsg:"输入您的姓名",regType:2},{name:"birthday",checkType:"isNotNull",errorMsg:"请选择您的生日",regType:2},{name:"mobile",checkType:"isMobile",errorMsg:"输入手机号"},{name:"work_time",checkType:"isNumber",errorMsg:"请输入从业年份，例如：5",regType:2},{name:"city_id",checkType:"isNotNull",errorMsg:"请选择意向工作城市"},{name:"free_fare_distance",checkType:"isFloatNum",errorMsg:"请输入公里数",regType:2,maxNum:"",unit:"公里"},{name:"address",checkType:"isNotNull",errorMsg:"请选择所在地址"},{name:"text",checkType:"isNotNull",errorMsg:"请输入"+this.$t("action.attendantName")+"简介",regType:2},{name:"id_code",checkType:"isIdCard",errorMsg:"输入您的身份证号码"},{name:"id_card",checkType:"isNotNull",errorMsg:"请上传身份证人像面"},{name:"id_card_fan",checkType:"isNotNull",errorMsg:"请上传身份证国徽面"},{name:"id_card_people",checkType:"isNotNull",errorMsg:"请上传手持身份证照片"},{name:"license",checkType:"isNotNull",errorMsg:"请上传资格证书"},{name:"work_img",checkType:"isNotNull",errorMsg:"请上传工作形象照"},{name:"self_img",checkType:"isNotNull",errorMsg:"请上传个人生活照"}],lockTap:!1}},computed:(0,u.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},userInfo:function(e){return e.user.userInfo},location:function(e){return e.user.location},locaRefuse:function(e){return e.user.locaRefuse},useChooseLocation:function(e){return e.user.useChooseLocation},scanRecordId:function(e){return e.user.scanRecordId}}),onLoad:function(t){var n=this;return(0,o.default)(a.default.mark((function r(){var i,o,c,u,s,l;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(i=t,o=i.admin_id,c=void 0===o?0:o,u=i.partner_id,s=void 0===u?0:u,c&&n.addScanRecord({type:4,qr_id:c}),s&&n.addScanRecord({type:3,qr_id:s}),!c&&!s){r.next=9;break}return r.next=6,n.updateCommonOptions(t);case 6:r.t0=r.sent,r.next=10;break;case 9:r.t0=t;case 10:return t=r.t0,n.options=t,n.form.admin_id=c,n.form.partner_id=s,n.$util.showLoading(),r.next=17,n.initIndex();case 17:l=n.coach_status,e.setNavigationBarTitle({title:-1==l?"申请"+n.$t("action.attendantName"):""}),n.scanRecordId&&n.updateScanRecord();case 20:case"end":return r.stop()}}),r)})))()},onShow:function(){this.useChooseLocation&&this.updateUserItem({key:"useChooseLocation",val:!1}),!this.location.lat&&this.locaRefuse&&this.toResetUtilLoca()},onUnload:function(){this.timer&&clearInterval(this.timer)},watch:{locaRefuse:function(e,t){e||this.toResetUtilLoca()}},methods:l(l(l({},(0,u.mapActions)(["getConfigInfo","getUserInfo","updateCommonOptions","addScanRecord","updateScanRecord"])),(0,u.mapMutations)(["updateUserItem","updateMapItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,o.default)(a.default.mark((function n(){var r,o,c,u,s,l,d,f,p,h,m,_,g,v,y,b,x,k,w,T,I,$;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.length>0&&void 0!==e[0]&&e[0],t.configInfo.id&&t.configInfo.hasOwnProperty("free_fare_bear")&&!r){n.next=4;break}return n.next=4,t.getConfigInfo();case 4:return n.next=6,t.getUserInfo();case 6:if(t.$util.setNavigationBarColor({bg:t.primaryColor}),o=t.$refs.user_privacy.check(),!o||t.location.lat){n.next=12;break}return t.$refs.user_privacy.open(),t.$util.hideAll(),n.abrupt("return");case 12:return n.next=14,Promise.all([t.$api.technician.coachInfo(),t.getCityList()]);case 14:if(c=n.sent,u=(0,i.default)(c,1),s=u[0],t.max_level=s.max_level,s&&(!s||s.id)){n.next=27;break}return l=t.userInfo.phone,d=void 0===l?0:l,t.form.mobile=d,t.is_send=!d,n.next=24,t.getStoreList();case 24:return t.isLoad=!0,t.$util.hideAll(),n.abrupt("return");case 27:for(x in f=["id_card","license","self_img"],f.map((function(e){s[e]=s[e]&&s[e].length>0?s[e].map((function(e){return{path:e}})):[]})),s.id_card&&s.id_card.length>1&&(s.id_card_fan=[s.id_card[1]],s.id_card_people=[s.id_card[2]],s.id_card.splice(1,3)),p=["work_img","video"],p.map((function(e){s[e]=s[e]&&s[e].length>0?[{path:s[e]}]:[]})),s.birthday=s.birthday?t.$util.formatTime(1e3*s.birthday,"YY-M-D"):"",h=t.options,m=h.type,_=void 0===m?0:m,g=h.admin_id,v=void 0===g?0:g,y=h.partner_id,b=void 0===y?0:y,v&&(s.admin_id=v),b&&(s.partner_id=b),1*!s.admin_id&&(s.store_id=0),t.form)t.form[x]=s[x];return n.next=40,t.getStoreList();case 40:k=s.city_id,w=s.store_id,T=s.status,I=s.sh_text,t.cityIndex=t.cityList.findIndex((function(e){return e.id==k})),t.storeIndex=t.storeList.findIndex((function(e){return e.id==w})),$=1*!v&&!_&&4==T?-1:T,t.coach_status=$,4==$&&I&&(t.tipArr[4][0].text=I),t.isLoad=!0,t.$util.hideAll();case 48:case"end":return n.stop()}}),n)})))()},initRefresh:function(){this.initIndex(!0)},toResetUtilLoca:function(){return(0,o.default)(a.default.mark((function e(){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},toOpenLocation:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$refs.user_privacy.check(),!n){t.next=4;break}return e.$refs.user_privacy.open(),t.abrupt("return");case 4:return t.next=6,e.$util.checkAuth({type:"userLocation",checkApp:!0});case 6:e.initRefresh();case 7:case"end":return t.stop()}}),t)})))()},getCityList:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,i,o,c,u,s;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.location,n.lat){t.next=5;break}return t.next=4,e.$util.getUtilLocation();case 4:e.updateMapItem({key:"pageActive",val:!1});case 5:return r=e.location,i=r.lng,o=void 0===i?0:i,c=r.lat,u=void 0===c?0:c,t.next=8,e.$api.base.getCity({lng:o,lat:u});case 8:s=t.sent,e.$util.hideAll(),e.cityList=s,u&&o&&e.$util.getMapInfo();case 12:case"end":return t.stop()}}),t)})))()},getStoreList:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,i;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.form.admin_id,r=void 0===n?0:n,r*=1,r){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.$api.mine.getStoreSelect({admin_id:r});case 6:i=t.sent,i.unshift({id:0,title:"不挂靠门店"}),e.storeList=i;case 9:case"end":return t.stop()}}),t)})))()},pickerChange:function(e,t){var n=e.target.value;if("birthday"===t){var r=this.$util.DateToUnix(n);return r>new Date(Math.ceil((new Date).getTime()))/1e3?void this.$util.showToast({title:"不能选择未来时间哦"}):void(this.form[t]=n)}this["".concat(t,"Index")]=n,this.form["".concat(t,"_id")]=this["".concat(t,"List")][n].id},toResetPhone:function(){this.form.mobile="",this.is_send=!0},toSend:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,i,o;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.authTime,!n){t.next=3;break}return t.abrupt("return");case 3:if(r=e.form.mobile,i=void 0===r?"":r,null!=i&&/^(1[0-9]{10})$/.test(i)){t.next=7;break}return e.$util.showToast({title:null==i?"请输入手机号":"".concat(i," 手机号无效")}),t.abrupt("return");case 7:if(!e.lockTap){t.next=9;break}return t.abrupt("return");case 9:return e.lockTap=!0,e.$util.showLoading(),t.prev=11,t.next=14,e.$api.user.sendShortMsg({phone:i});case 14:e.$util.hideAll(),e.lockTap=!1,e.form.short_code="",o=60,e.timer=setInterval((function(){0!==o?(o--,e.authTime=o):clearInterval(e.timer)}),1e3),t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](11),setTimeout((function(){e.lockTap=!1,e.$util.hideAll()}),2e3);case 24:case"end":return t.stop()}}),t,null,[[11,21]])})))()},imgUpload:function(e){var t=e.imagelist,n=e.imgtype;this.form[n]=t},toChooseLocation:function(){var e=this;return(0,o.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.updateUserItem({key:"useChooseLocation",val:!0}),e.location.lat){t.next=6;break}e.updateUserItem({key:"useChooseLocation",val:!1}),e.toOpenLocation(),t.next=9;break;case 6:return t.next=8,e.$util.checkAuth({type:"userLocation"});case 8:e.initChooseLoca();case 9:case"end":return t.stop()}}),t)})))()},initChooseLoca:function(){var t=arguments,n=this;return(0,o.default)(a.default.mark((function r(){var o,c,u,s,l,d,f,p,h,m,_,g,v,y;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.length>0&&void 0!==t[0]?t[0]:{},r.next=3,e.chooseLocation(o);case 3:if(c=r.sent,u=(0,i.default)(c,2),s=u[0],l=u[1],d=s?{name:"",address:"",latitude:"",longitude:""}:l,f=d.name,p=void 0===f?"":f,h=d.address,m=void 0===h?"":h,_=d.latitude,g=void 0===_?"":_,v=d.longitude,y=void 0===v?"":v,m=m||p,n.updateUserItem({key:"useChooseLocation",val:!1}),m){r.next=12;break}return r.abrupt("return");case 12:n.form.lat=g,n.form.lng=y,n.form.address=m;case 15:case"end":return r.stop()}}),r)})))()},confirm:function(){var t=this;return(0,o.default)(a.default.mark((function n(){var r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=t.coach_status,4!=r){n.next=5;break}return t.coach_status=-1,e.setNavigationBarTitle({title:"申请"+t.$t("action.attendantName")}),n.abrupt("return");case 5:t.$util.goUrl({url:"/pages/mine?type=2",openType:"reLaunch"});case 6:case"end":return n.stop()}}),n)})))()},validate:function(e){var t=this.configInfo.coach_apply_type,n=["coach_name","birthday","mobile","city_id","work_img"],r=["coach_name","birthday","mobile","work_time","city_id","free_fare_distance","address","text","id_code","id_card","id_card_fan","id_card_people","license","work_img","self_img"],a=this.configInfo,i=a.free_fare_bear,o=a.free_fare_distance,c=new this.$util.Validate;this.rule.map((function(a){var u=a.name;(1==t&&n.includes(u)||2==t&&r.includes(u))&&("free_fare_distance"==u?e[u]&&(1==i&&(a.maxNum=o),c.add(e[u],a)):c.add(e[u],a))}));var u=c.start();return u},submit:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,r,i,o,c,u;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$util.deepCopy(e.form),r=["id_card","id_card_fan","id_card_people","work_img","video"],r.map((function(e){n[e]=n[e]&&n[e].length>0?n[e][0].path:""})),n.license=n.license.map((function(e){return e.path})),n.self_img=n.self_img.map((function(e){return e.path})),i=e.validate(n),!i){t.next=9;break}return e.$util.showToast({title:i}),t.abrupt("return");case 9:if(o=e.configInfo,c=o.short_code_status,o.coach_apply_type,u=e.is_send,!c||!u||null!=n.short_code&&6==n.short_code.length){t.next=14;break}return e.$util.showToast({title:"请输入6位数短信验证码"}),t.abrupt("return");case 14:if(c&&u||delete n.short_code,n.birthday=e.$util.DateToUnix(n.birthday),n.id_code=n.id_code,n.id_card=n.id_code?[n.id_card,n.id_card_fan,n.id_card_people]:[],delete n.id_card_fan,delete n.id_card_people,!e.lockTap){t.next=22;break}return t.abrupt("return");case 22:return e.lockTap=!0,e.$util.showLoading(),t.prev=24,t.next=27,e.$api.technician.coachApply(n);case 27:e.$util.hideAll(),e.$util.showToast({title:"提交成功，即将跳转个人中心"}),e.timer&&clearInterval(e.timer),setTimeout((function(){getCurrentPages().length>1&&e.$util.back(),e.$util.goUrl({url:"/pages/mine",openType:"reLaunch"})}),2e3),t.next=36;break;case 33:t.prev=33,t.t0=t["catch"](24),setTimeout((function(){e.lockTap=!1,e.$util.hideAll()}),2e3);case 36:case"end":return t.stop()}}),t,null,[[24,33]])})))()}})};t.default=d}).call(this,n("df3c")["default"])}},[["7672","common/runtime","common/vendor"]]]);