(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["technician/pages/order/list"],{5069:function(e,t,r){"use strict";(function(e,t){var n=r("47a9");r("65e9");n(r("3240"));var a=n(r("a353"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(a.default)}).call(this,r("3223")["default"],r("df3c")["createPage"])},a353:function(e,t,r){"use strict";r.r(t);var n=r("c028"),a=r("ab1d");for(var i in a)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(i);var o=r("828b"),u=Object(o["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=u.exports},ab1d:function(e,t,r){"use strict";r.r(t);var n=r("f68c"),a=r.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},c028:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,r=(e._self._c,e.tabList.length),n=e.__map(e.list.data,(function(t,r){var n=e.__get_orig(t),a=2!=t.pay_type?[3,4,5].includes(t.pay_type):null,i=[3,4,5].includes(t.pay_type);return{$orig:n,g1:a,g2:i}})),a=e.loading?e.list.current_page>=e.list.last_page&&e.list.data.length>0:null,i=!e.loading&&e.list.data.length<=0&&1==e.list.current_page,o=e.coach_refund_text.length,u=o>200?null:e.coach_refund_text.length,s=e.$t("action.attendantName");e._isMounted||(e.e0=function(t,r){var n=arguments[arguments.length-1].currentTarget.dataset,a=n.eventParams||n["event-params"];r=a.item;return t.stopPropagation(),e.$util.goUrl({url:"/technician/pages/order/label?id="+r.id+"&uid="+r.user_id})},e.e1=function(t){return t.stopPropagation(),e.$refs.refuse_item.close()},e.e2=function(t){return t.stopPropagation(),e.$refs.oper_item.close()},e.e3=function(t){return t.stopPropagation(),e.$refs.shield_item.close()}),e.$mp.data=Object.assign({},{$root:{g0:r,l0:n,g3:a,g4:i,g5:o,g6:u,m0:s}})},a=[]},f68c:function(e,t,r){"use strict";(function(e){var n=r("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r("7eb4")),i=n(r("34cf")),o=n(r("7ca3")),u=n(r("ee10")),s=r("8f59");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d=null,f={components:{},data:function(){return{options:{},activeIndex:0,tabList:[{title:"待接单",id:2,number:0},{title:"待服务",id:5,number:0},{title:"服务中",id:6,number:0},{title:"已完成",id:7,number:0}],statusType:{2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成",8:"待转单"},param:{page:1,pay_type:0},list:{data:[]},loading:!0,index:-1,coach_refund_text:"",lockTap:!1,popupInfo:{title:"",index:"",type:"",param:{},imgs:[],location:{lat:0,lng:0,address:""}},isReset:!1,duration_time:600}},computed:(0,s.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},isUserMedia:function(e){return e.order.isUserMedia},recorder:function(e){return e.order.recorder},recorder_status:function(e){return e.order.recorder_status},recorder_order_id:function(e){return e.order.recorder_order_id},order_unix_list:function(e){return e.order.order_unix_list},userCoachStatus:function(e){return e.user.userCoachStatus},changeOnAddr:function(e){return e.user.changeOnAddr},noChangeLoca:function(e){return e.user.noChangeLoca}}),onLoad:function(e){var t=this;return(0,u.default)(a.default.mark((function r(){var n,i;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.options=e,n=e.tab,i=void 0===n?0:n,t.activeIndex=i,t.initIndex();case 4:case"end":return r.stop()}}),r)})))()},onUnload:function(){this.toUnload()},onPullDownRefresh:function(){e.showNavigationBarLoading(),this.initRefresh(),e.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},methods:l(l(l({},(0,s.mapActions)(["getConfigInfo","getCoachInfo","toPlayAudio"])),(0,s.mapMutations)(["updateUserItem","updateOrderItem"])),{},{initIndex:function(){var t=arguments,r=this;return(0,u.default)(a.default.mark((function n(){var i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=t.length>0&&void 0!==t[0]&&t[0],r.configInfo.id&&r.configInfo.hasOwnProperty("free_fare_bear")){n.next=4;break}return n.next=4,r.getConfigInfo();case 4:return n.next=6,r.getList();case 6:if(r.$util.setNavigationBarColor({bg:r.primaryColor}),!i){n.next=9;break}return n.abrupt("return");case 9:d=e.getRecorderManager(),d.onStart((function(){r.$util.log("开始录音")})),d.onStop((function(e){r.$util.log("结束录音",e),r.handlerOnSave(e);var t=e.duration,n=parseInt(t/1e3),a=!(1*r.duration_time-n>1);r.isReset=a,a&&r.handlerOnChanger()})),d.onError((function(e){r.$util.log("录音异常",e)}));case 13:case"end":return n.stop()}}),n)})))()},initRefresh:function(){e.pageScrollTo({duration:0,scrollTop:0}),this.param.page=1,this.initIndex(!0)},getList:function(){var e=arguments,t=this;return(0,u.default)(a.default.mark((function r(){var n,i,o,u,s,c,l,d,f,p;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],i=t.list,o=t.param,u=t.tabList,s=t.activeIndex,o.pay_type=u[s].id,r.next=5,t.$api.technician.orderList(o);case 5:c=r.sent,l=c.data.filter((function(e){return e.pay_type>6})),l.length>0&&(d=l.map((function(e){return e.id})),f=t.order_unix_list,p=f.filter((function(e){return!d.includes(e.id)})),p.length!==f.length&&t.updateOrderItem({key:"order_unix_list",val:p})),n||(1==t.param.page||(c.data=i.data.concat(c.data)),t.list=c),t.tabList[0].number=c.agent_order_count,t.tabList[1].number=c.wait_order_count,t.tabList[2].number=c.service_order_count,t.loading=!1,t.$util.hideAll();case 14:case"end":return r.stop()}}),r)})))()},handerTabChange:function(e){this.activeIndex=e,this.$util.showLoading(),this.param.page=1,this.getList()},toUnload:function(){var e=this;return(0,u.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.updateUserItem({key:"useChooseLocation",val:!1}),e.updateOrderItem({key:"recorder_status",val:!1}),e.updateOrderItem({key:"recorder_order_id",val:0});case 3:case"end":return t.stop()}}),t)})))()},handlerOnChanger:function(){var e=this;return(0,u.default)(a.default.mark((function t(){var r,n,i;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.$refs.user_privacy.check(),!r){t.next=4;break}return e.$refs.user_privacy.open(),t.abrupt("return");case 4:return t.next=6,e.$util.checkAuth({type:"record"});case 6:n=e.recorder_status,i=e.duration_time,n?d.stop():d.start({format:"mp3",duration:1e3*i}),e.updateOrderItem({key:"recorder_status",val:!n});case 9:case"end":return t.stop()}}),t)})))()},handlerOnEnd:function(){var e=this;return(0,u.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:d.stop(),e.updateOrderItem({key:"recorder_status",val:!1});case 2:case"end":return t.stop()}}),t)})))()},handlerOnSave:function(){var e=arguments,t=this;return(0,u.default)(a.default.mark((function r(){var n,i,o,u,s,c;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:{},t.$util.showLoading({title:"录音上传中"}),"",o=n.tempFilePath,i=o,r.next=7,t.$api.base.uploadFile({filePath:i,formData:{type:"audio"}});case 7:return u=r.sent,s=u.attachment_path,c=t.recorder_order_id,r.next=12,t.$api.technician.recordingAdd({order_id:c,link:s});case 12:t.$util.hideAll();case 13:case"end":return r.stop()}}),r)})))()},toCountDownEnd:function(e){var t=this;return(0,u.default)(a.default.mark((function r(){var n,i,o,u,s,c,l;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t.recorder_status,i=t.recorder_order_id,i!=e||!n){r.next=10;break}return r.next=4,t.$api.technician.orderInfo({id:e});case 4:if(o=r.sent,u=o.total_time_long,s=o.start_service_time,c=void 0===s?"":s,l=Math.ceil((1e3*(t.$util.DateToUnix(c)+60*u)-(new Date).getTime())/1e3),!(l<1)){r.next=10;break}return r.next=10,t.handlerOnEnd();case 10:case"end":return r.stop()}}),r)})))()},toRefuse:function(e){var t=this;return(0,u.default)(a.default.mark((function r(){return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.index=e,t.coach_refund_text="",t.$refs.refuse_item.open();case 3:case"end":return r.stop()}}),r)})))()},confirmRefuse:function(){var e=this;return(0,u.default)(a.default.mark((function t(){var r,n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.coach_refund_text,r=r.length>0?r.replace(/(^\s*)|(\s*$)/g,""):"",0!=r.length){t.next=5;break}return e.$util.showToast({title:"请输入拒单原因"}),t.abrupt("return");case 5:e.coach_refund_text=e.coach_refund_text.substring(0,200),n=e.index,e.toConfirm(n,-1);case 8:case"end":return t.stop()}}),t)})))()},toGetLocation:function(){var e=this;return(0,u.default)(a.default.mark((function t(){var r,n,i,o,u,s,c;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.popupInfo.location,n=r.lat,i=void 0===n?"":n,o=r.lng,u=void 0===o?"":o,s=r.address,c=void 0===s?"":s,!(i&&u&&c)){t.next=3;break}return t.abrupt("return");case 3:e.getUtilLocation();case 4:case"end":return t.stop()}}),t)})))()},getUtilLocation:function(){var e=this;return(0,u.default)(a.default.mark((function t(){var r,n,i,o,u;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.updateUserItem({key:"useChooseLocation",val:!0}),t.next=3,e.$util.getLocation();case 3:r=t.sent,n=r.lat,i=void 0===n?0:n,o=r.lng,u=void 0===o?0:o,e.initUtilLocaData(i,u);case 9:case"end":return t.stop()}}),t)})))()},initUtilLocaData:function(e,t){var r=this;return(0,u.default)(a.default.mark((function n(){var i,o,u,s;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r.updateUserItem({key:"useChooseLocation",val:!1}),e||t){n.next=5;break}return r.$util.showToast({title:"获取位置信息失败，请稍后重试"}),r.$util.hideAll(),n.abrupt("return");case 5:return r.$util.showLoading(),n.next=8,r.$util.getMapAddr({lat:e,lng:t});case 8:i=n.sent,o=i.address,u={lat:e,lng:t,address:o},r.$util.updateCoachAddr(u),s=Object.assign({},r.popupInfo,{location:u}),r.$nextTick((function(){r.popupInfo=s})),r.$util.hideAll();case 15:case"end":return n.stop()}}),n)})))()},imgUpload:function(e){var t=e.imagelist,r=e.imgtype;this.popupInfo[r]=t},confirmOper:function(){var e=this.$util.deepCopy(this.popupInfo),t=e.index,r=e.type,n=e.param,a=e.imgs,i=e.location,o=i.lat,u=void 0===o?0:o,s=i.lng,c=void 0===s?0:s;i.address;if([5,7].includes(r)&&0===a.length)this.$util.showToast({title:"请先拍照"});else if(u||c){if([5,7].includes(r)){var l=a[0].path;i.path=l}this.toConfirmUpdate(t,r,n,i)}else this.$util.showToast({title:"请先获取当前位置信息"})},toConfirm:function(e,t){var r=this;return(0,u.default)(a.default.mark((function n(){var i,o,u,s;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!r.lockTap){n.next=2;break}return n.abrupt("return");case 2:i=r.list.data[e].id,i*=1,o={order_id:i,type:t},-1==t&&(o.coach_refund_text=r.coach_refund_text),[4,5,7].includes(t)?(u={4:"确认出发",5:"确认到达",7:"确认完成"},s=u[t],r.popupInfo=Object.assign({},r.popupInfo,{title:s,index:e,type:t,param:o,imgs:[],location:{lat:0,lng:0,address:""}}),r.$refs.oper_item.open()):r.toConfirmUpdate(e,t,o);case 7:case"end":return n.stop()}}),n)})))()},toConfirmUpdate:function(t,r,n){var o=arguments,s=this;return(0,u.default)(a.default.mark((function u(){var c,l,d,f,p,h,g,_,v,m,x,b,w,k,$,y,I,O,T,L,C,U,P,A,j,D,M,S;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(c=o.length>3&&void 0!==o[3]?o[3]:{},[4,5,7].includes(r)&&(l=c.lat,d=c.lng,f=c.address,p=c.path,4===r&&(n.serout_lat=l,n.serout_lng=d,n.serout_address=f),5==r&&(n.arrive_img=p,n.arr_lat=l,n.arr_lng=d,n.arr_address=f),7==r&&(n.end_img=p,n.end_lat=l,n.end_lng=d,n.end_address=f)),h={"-1":"已拒绝接单",3:"接单成功",4:"已成功出发",5:"已成功到达",6:"已开始服务",7:"服务已完成"},!s.lockTap){a.next=5;break}return a.abrupt("return");case 5:return s.lockTap=!0,g=s.configInfo,_=g.plugAuth,v=g.service_recording_show,m=_.recording,x=s.isUserMedia,b=s.recorder_order_id,w=s.recorder_status,k=!0,$=n.order_id,y={},a.prev=12,a.next=15,s.$api.technician.orderInfo({id:$});case 15:y=a.sent,a.next=27;break;case 18:return a.prev=18,a.t0=a["catch"](12),-1==r&&s.$refs.refuse_item.close(),[4,5,7].includes(r)&&s.$refs.oper_item.close(),s.param.page=1,s.getList(),s.lockTap=!1,s.$util.hideAll(),a.abrupt("return");case 27:if(I=y,O=I.pay_type,7!=O||b!=$||!w){a.next=31;break}return a.next=31,s.handlerOnEnd();case 31:if(!(O<r&&6===r&&b!=$&&w)){a.next=44;break}return a.next=34,e.showModal({title:"提示",content:"已有开始的服务还未结束录音，请确认是否完成录音并开始新的服务？"});case 34:if(T=a.sent,L=(0,i.default)(T,2),L[0],C=L[1].confirm,!C){a.next=43;break}return a.next=41,s.handlerOnEnd();case 41:a.next=44;break;case 43:k=!1;case 44:if(s.$util.showLoading(),k){a.next=49;break}return s.lockTap=!1,s.$util.hideAll(),a.abrupt("return");case 49:return a.prev=49,-1==r&&s.$refs.refuse_item.close(),[4,5,7].includes(r)&&s.$refs.oper_item.close(),a.next=54,s.$api.technician.updateOrder(n);case 54:if(4==r||5==r?(s.list.data[t].pay_type=r,s.updateOrderItem({key:4==r?"coach_travel_order_id":"coach_travel_arrive_id",val:$})):s.list.data.splice(t,1),6!=r){a.next=74;break}if(s.toPlayAudio({key:"service_start_recording"}),!(x&&m&&v)){a.next=63;break}return s.$util.hideAll(),a.next=61,e.showModal({title:"提示",content:"服务过程将自动录音，直至服务结束！若录音中退出页面将不会记录录音的音频！",showCancel:!1,confirmText:"知道了"});case 61:s.updateOrderItem({key:"recorder_order_id",val:$}),s.handlerOnChanger();case 63:return a.next=65,s.$api.technician.orderInfo({id:$});case 65:U=a.sent,P=U.total_time_long,A=U.start_service_time,j=s.$util.DateToUnix(A)+60*P,D={id:$,time_long:P,start_service_time:A,start_service_time_unix:j},M=s.order_unix_list,S=M.findIndex((function(e){return e.id===$})),-1!=S?M[S]=D:M.push(D),s.updateOrderItem({key:"order_unix_list",val:M});case 74:if(7!=r){a.next=78;break}if(b!=$||!w){a.next=78;break}return a.next=78,s.handlerOnEnd();case 78:return s.$util.hideAll(),s.$util.showToast({title:h[r]}),a.next=82,s.getList(!0);case 82:setTimeout((function(){s.lockTap=!1,7==r&&s.getCoachInfo()}),500),a.next=88;break;case 85:a.prev=85,a.t1=a["catch"](49),setTimeout((function(){s.param.page=1,s.getList(),s.lockTap=!1,s.$util.hideAll(),7==r&&s.getCoachInfo()}),2e3);case 88:case"end":return a.stop()}}),u,null,[[12,18],[49,85]])})))()},toShield:function(e){this.index=e;var t=this.configInfo.block_user_type,r=void 0===t?1:t;1!=r?this.$util.goUrl({url:"/user/pages/feedback/box?blockuser=1&index=".concat(e)}):this.$refs.shield_item.open()},confirmShield:function(){var e=this;return(0,u.default)(a.default.mark((function t(){var r,n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.index,!e.lockTap){t.next=3;break}return t.abrupt("return");case 3:return e.lockTap=!0,e.$util.showLoading(),n=e.list.data[r].user_id,t.prev=6,t.next=9,e.$api.technician.shieldUserAdd({user_id:n});case 9:e.$util.hideAll(),e.$refs.shield_item.close(),e.$util.showToast({title:"屏蔽成功"}),e.initRefresh(),setTimeout((function(){e.lockTap=!1}),1e3),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](6),setTimeout((function(){e.lockTap=!1,e.$util.hideAll()}),2e3);case 19:case"end":return t.stop()}}),t,null,[[6,16]])})))()},toTel:function(e){var t=this;return(0,u.default)(a.default.mark((function r(){var n,i;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.list.data[e].id,r.next=3,t.$api.technician.getVirtualPhone({order_id:n});case 3:if(i=r.sent,i){r.next=7;break}return t.$util.showToast({title:"稍后会有电话打入，请注意接听哦"}),r.abrupt("return");case 7:t.$util.goUrl({url:i,openType:"call"});case 8:case"end":return r.stop()}}),r)})))()},goDetail:function(e){var t=this.list.data[e].id,r="/technician/pages/order/detail?id=".concat(t);this.$util.goUrl({url:r})}})};t.default=f}).call(this,r("df3c")["default"])}},[["5069","common/runtime","common/vendor"]]]);