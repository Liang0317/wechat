(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{4300:function(e,t,n){},"683a":function(e,t,n){"use strict";n.r(t);var o=n("96da"),r=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=r.a},"69cc":function(e,t,n){"use strict";var o=n("4300"),r=n.n(o);r.a},"96da":function(e,t,n){"use strict";(function(e,o){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("7eb4")),i=r(n("7ca3")),c=r(n("ee10")),u=n("8f59"),l=(r(n("7563")),r(n("96c6")));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={data:function(){return{timer:null,travelTimer:null,orderTimer:null,lockTap:!1,resolvePrivacyAuthorization:""}},mounted:function(){return(0,c.default)(a.default.mark((function e(){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},onLaunch:function(){var t=this;return(0,c.default)(a.default.mark((function n(){var o,r,i,c,u,l,s;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:o=t,e.onLocationChange((function(e){var t=e.latitude,n=e.longitude;o.toChangeLocation({lat:t,lng:n})})),r=e.getStorageSync("configInfo")||"",r&&t.updateConfigItem({key:"configInfo",val:r}),i=e.getStorageSync("isGzhLogin")||!1,t.updateUserItem({key:"isGzhLogin",val:i}),t.updateUserItem({key:"changeAddr",val:!1}),c=["userInfo","autograph","location","locaRefuse","appLogin","loginType","loginPage"],c.map((function(n){var o=e.getStorageSync(n)||"";t.updateUserItem({key:n,val:o})})),u=t.commonOptions,l=u.coach_id,s=void 0===l?0:l,s&&(u.coach_id=0,t.updateUserItem({key:"commonOptions",val:u})),t.getConfigInfo(),t.getPrivacySetting();case 14:case"end":return n.stop()}}),n)})))()},onShow:function(){var t=this;return(0,c.default)(a.default.mark((function n(){var r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:o.onNeedPrivacyAuthorization((function(e,n){t.resolvePrivacyAuthorization=e})),o.requirePrivacyAuthorize({success:function(e){},fail:function(e){}}),t.getUserCoachStatus(),t.timerInit(),r=t.coach_travel_order_id,t.updateOrderItem({key:"coach_travel_order_id",val:r}),e.onNetworkStatusChange((function(e){var t=e.isConnected;if(!t){["updateServiceItem","updateTechnicianItem","updateMapItem","updateDynamicItem","updateShopstoreItem","updateOrderItem"].map((function(e){l.default.commit(e,{key:"pageActive",val:!1})}))}}));case 7:case"end":return n.stop()}}),n)})))()},onHide:function(){var e=this;return(0,c.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.coach_travel_order_id&&e.toAddCoachTravel();case 1:case"end":return t.stop()}}),t)})))()},onUnload:function(){this.timer&&clearInterval(this.timer),this.travelTimer&&clearInterval(this.travelTimer),this.orderTimer&&clearInterval(this.orderTimer)},watch:{resolvePrivacy:function(e,t){e&&this.resolvePrivacyAuthorization(e)},"configInfo.attendant_name":function(e,t){e&&this.mergeLocaleMessage()},useChooseLocation:function(e,t){var n=this.userCoachStatus,o=n.status,r=void 0===o?0:o,a=(n.coach_position,n.auto_coach_position),i=void 0===a?0:a;if(2==r&&i){var c=e?0:1,u=Object.assign({},this.$util.deepCopy(this.userCoachStatus),{coach_position:c});e||this.timerInit(),this.updateUserItem({key:"userCoachStatus",val:u})}},userCoachStatus:function(e,t){var n=this,o=e.status,r=void 0===o?0:o,a=e.coach_position,i=void 0===a?0:a;if(2==r){this.timer||this.timerInit();var c=!!i;this.updateUserItem({key:"locationChange",val:c}),i?(this.timerInit(),this.updateUserItem({key:"locationChange",val:!1}),setTimeout((function(){n.updateUserItem({key:"locationChange",val:!0})}),150)):setTimeout((function(){n.updateUserItem({key:"locationChange",val:c})}),150)}else this.timer&&clearInterval(this.timer)},locationChange:function(t,n){t?e.startLocationUpdate({complete:function(e){return console.log("startLocationUpdate API complete",e)}}):e.stopLocationUpdate({complete:function(e){return console.log("stopLocationUpdate API complete",e)}})},coach_travel_order_id:function(e,t){e&&this.toAddCoachTravel()},coach_travel_arrive_id:function(e,t){this.travelTimer&&clearInterval(this.travelTimer),e&&(this.updateOrderItem({key:"coach_travel_order_id",val:0}),this.toConfirmAddCoachTravel(e))},order_unix_list:function(e,t){this.orderTimer&&clearInterval(this.orderTimer),e&&e.length>0&&this.toOrderUnix(e)}},computed:(0,u.mapState)({configInfo:function(e){return e.config.configInfo},old_attendant_name:function(e){return e.config.old_attendant_name},old_channel_menu_name:function(e){return e.config.old_channel_menu_name},commonOptions:function(e){return e.user.commonOptions},locationChange:function(e){return e.user.locationChange},userInfo:function(e){return e.user.userInfo},location:function(e){return e.user.location},userCoachStatus:function(e){return e.user.userCoachStatus},useChooseLocation:function(e){return e.user.useChooseLocation},changeOnAddr:function(e){return e.user.changeOnAddr},coach_travel_order_id:function(e){return e.order.coach_travel_order_id},order_unix_list:function(e){return e.order.order_unix_list},resolvePrivacy:function(e){return e.user.resolvePrivacy}}),methods:f(f(f({},(0,u.mapActions)(["getConfigInfo","getUserInfo","getUserCoachStatus","getPrivacySetting","toPlayAudio"])),(0,u.mapMutations)(["updateUserItem","updateOrderItem","updateConfigItem"])),{},{timerInit:function(){var e=this;this.timer&&clearInterval(this.timer),this.timer=setInterval((function(){var t=e.changeOnAddr.unix,n=void 0===t?0:t,o=e.$util.DateToUnix(e.$util.formatTime(new Date,"YY-M-D h:m:s"));if(!n||n&&o-n>=3){var r=e.$util.deepCopy(e.userCoachStatus);r.unix=o,e.updateUserItem({key:"userCoachStatus",val:r})}}),3e4)},toHidePage:function(){var e=arguments,t=this;return(0,c.default)(a.default.mark((function n(){var o,r,i,c;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.length>0&&void 0!==e[0]?e[0]:1,n.next=3,t.$util.getUtilLocation(!1);case 3:r=n.sent,i=r.lat,c=r.lng,i&&c&&t.toChangeLocation({lat:i,lng:c},o);case 7:case"end":return n.stop()}}),n)})))()},toChangeLocation:function(e){var t=arguments,n=this;return(0,c.default)(a.default.mark((function o(){var r,i,c,u,l,s,f,d,p,h,m,v;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(r=t.length>1&&void 0!==t[1]?t[1]:0,i=e.lat,c=e.lng,u=n.userCoachStatus,l=u.status,s=void 0===l?0:l,f=u.coach_position,d=void 0===f?0:f,p=u.lat,h=u.lng,2!=s){o.next=13;break}if(m=n.$util.getDistance(i,c,p,h),v=Object.assign({},e,{unix:n.$util.DateToUnix(n.$util.formatTime(new Date,"YY-M-D h:m:s")),initDistance:r,distance:m}),n.updateUserItem({key:"changeOnAddr",val:v}),100,!d||!(1==r||1*m>=100)){o.next=13;break}if(!n.lockTap){o.next=11;break}return o.abrupt("return");case 11:n.lockTap=!0;try{n.$util.updateCoachAddr({lat:i,lng:c,address:""}),n.lockTap=!1}catch(a){n.lockTap=!1}case 13:case"end":return o.stop()}}),o)})))()},toAddCoachTravel:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var n,o,r,i,c;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.coach_travel_order_id,o=e.configInfo.plugAuth.coachtravel,r=e.userInfo.id,i=e.userCoachStatus.status,c=void 0===i?0:i,e.travelTimer&&clearInterval(e.travelTimer),o&&n&&r&&2==c&&(e.toConfirmAddCoachTravel(n),e.travelTimer=setInterval((function(){e.toConfirmAddCoachTravel(n)}),5e3));case 6:case"end":return t.stop()}}),t)})))()},toConfirmAddCoachTravel:function(e){var t=this;return(0,c.default)(a.default.mark((function n(){var o,r,i,c,u,l,s;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=t.changeOnAddr,r=o.unix,i=void 0===r?0:r,c=o.lat,u=o.lng,l=t.$util.DateToUnix(t.$util.formatTime(new Date,"YY-M-D h:m:s")),i&&!(i&&l-i>2)){n.next=8;break}return n.next=5,t.$util.getUtilLocation(!1);case 5:s=n.sent,c=s.lat,u=s.lng;case 8:if(!c||!u){n.next=11;break}return n.next=11,t.$api.technician.coachTrajectoryAdd({order_id:e,text:{lat:c,lng:u,address:""}});case 11:case"end":return n.stop()}}),n)})))()},toOrderUnix:function(e){var t=this;return(0,c.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.orderTimer=setInterval((function(){var n=e.filter((function(e){var t=Math.ceil((1e3*e.start_service_time_unix-(new Date).getTime())/1e3);return 300==t})),o=e.filter((function(e){var t=Math.ceil((1e3*e.start_service_time_unix-(new Date).getTime())/1e3);return 0==t})),r=e.filter((function(e){var t=Math.ceil((1e3*e.start_service_time_unix-(new Date).getTime())/1e3);return t>0}));n.length>0&&t.toPlayAudio({key:"countdown_voice"}),o.length>0&&t.toPlayAudio({key:"service_end_recording"}),r.length!==e.length&&t.updateOrderItem({key:"order_unix_list",val:r}),0===r.length&&clearInterval(t.orderTimer)}),1e3);case 1:case"end":return n.stop()}}),n)})))()},mergeLocaleMessage:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var n,o,r,i,c,u,l,s,f;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(f in n=JSON.parse(JSON.stringify(e.$i18n.messages.zh)),o=e.configInfo,r=o.attendant_name,i=o.channel_menu_name,c=e.old_attendant_name,u=e.old_channel_menu_name,l=new RegExp(c,"g"),s=new RegExp(u,"g"),n.action)n.action[f].includes(c)&&(n.action[f]=n.action[f].replace(l,r)),n.action[f].includes(u)&&(n.action[f]=n.action[f].replace(s,i));e.$i18n.mergeLocaleMessage("zh",n),e.updateConfigItem({key:"old_attendant_name",val:r}),e.updateConfigItem({key:"old_channel_menu_name",val:i});case 9:case"end":return t.stop()}}),t)})))()}})};t.default=d}).call(this,n("df3c")["default"],n("3223")["default"])},b46e:function(e,t,n){"use strict";n.r(t);var o=n("683a");for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);n("69cc");var a=n("828b"),i=Object(a["a"])(o["default"],void 0,void 0,!1,null,null,null,!1,void 0,void 0);t["default"]=i.exports},d5fc:function(e,t,n){"use strict";(function(e,t){var o=n("47a9"),r=o(n("7ca3")),a=o(n("af34"));n("65e9");var i=o(n("3240")),c=o(n("b46e")),u=o(n("7563")),l=o(n("7942")),s=o(n("e40a")),f=o(n("96c6"));function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}e.__webpack_require_UNI_MP_PLUGIN__=n;i.default.component("banner",(function(){n.e("components/banner").then(function(){return resolve(n("cc5a"))}.bind(null,n)).catch(n.oe)})),i.default.component("column",(function(){n.e("components/column").then(function(){return resolve(n("91ac"))}.bind(null,n)).catch(n.oe)})),i.default.component("fixed",(function(){n.e("components/fixed").then(function(){return resolve(n("026f"))}.bind(null,n)).catch(n.oe)})),i.default.component("search",(function(){n.e("components/search").then(function(){return resolve(n("db5d"))}.bind(null,n)).catch(n.oe)})),i.default.component("auth",(function(){n.e("components/auth").then(function(){return resolve(n("3498"))}.bind(null,n)).catch(n.oe)})),i.default.component("tab",(function(){n.e("components/tab").then(function(){return resolve(n("a497"))}.bind(null,n)).catch(n.oe)})),i.default.component("abnor",(function(){n.e("components/abnor").then(function(){return resolve(n("e069"))}.bind(null,n)).catch(n.oe)})),i.default.component("loadMore",(function(){n.e("components/load-more").then(function(){return resolve(n("59d8"))}.bind(null,n)).catch(n.oe)})),i.default.component("upload",(function(){n.e("components/upload").then(function(){return resolve(n("2659"))}.bind(null,n)).catch(n.oe)})),i.default.component("minCountdown",(function(){n.e("components/min-countdown").then(function(){return resolve(n("17e5"))}.bind(null,n)).catch(n.oe)})),i.default.component("uniNavBar",(function(){n.e("components/uni-nav-bar").then(function(){return resolve(n("207f"))}.bind(null,n)).catch(n.oe)})),i.default.component("uniPopup",(function(){n.e("components/uni-popup").then(function(){return resolve(n("5199"))}.bind(null,n)).catch(n.oe)})),i.default.component("commonPopup",(function(){n.e("components/common-popup").then(function(){return resolve(n("9f82"))}.bind(null,n)).catch(n.oe)})),i.default.component("loginInfo",(function(){n.e("components/login-info").then(function(){return resolve(n("46c6"))}.bind(null,n)).catch(n.oe)})),i.default.component("changeUserType",(function(){n.e("components/change-user-type").then(function(){return resolve(n("6848"))}.bind(null,n)).catch(n.oe)})),i.default.component("OpenLocationInfo",(function(){n.e("components/open-location-info").then(function(){return resolve(n("41b3"))}.bind(null,n)).catch(n.oe)})),i.default.component("fixBottomButton",(function(){n.e("components/fix-bottom-button").then(function(){return resolve(n("0c00"))}.bind(null,n)).catch(n.oe)})),i.default.component("uniSegmentedControl",(function(){n.e("components/uni-segmented-control").then(function(){return resolve(n("7014"))}.bind(null,n)).catch(n.oe)})),i.default.component("userPrivacy",(function(){n.e("components/user-privacy-setting").then(function(){return resolve(n("5cee"))}.bind(null,n)).catch(n.oe)})),i.default.prototype.$api=u.default,i.default.prototype.$util=l.default,i.default.prototype._i18n=s.default,i.default.config.productionTip=!1,i.default.config.ignoredElements=[].concat((0,a.default)(i.default.config.ignoredElements),["wx-open-launch-weapp"]),c.default.mpType="app";var h=new i.default(p(p({},c.default),{},{store:f.default,i18n:s.default}));t(h).$mount()}).call(this,n("3223")["default"],n("df3c")["createApp"])}},[["d5fc","common/runtime","common/vendor"]]]);