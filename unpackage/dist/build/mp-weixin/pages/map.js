(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/map"],{4879:function(e,t,n){"use strict";n.r(t);var a=n("b483"),i=n("80fc");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("c8e5");var r=n("828b"),c=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=c.exports},5074:function(e,t,n){"use strict";(function(e,t){var a=n("47a9");n("65e9");a(n("3240"));var i=a(n("4879"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},8034:function(e,t,n){},"80fc":function(e,t,n){"use strict";n.r(t);var a=n("b5cb"),i=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a},b483:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var a={wPicker:function(){return n.e("components/w-picker/w-picker").then(n.bind(null,"ab68"))}},i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.isLoad&&e.configInfo.plugAuth.map&&"list"==e.mapType?e.list.data&&e.list.data.length>0:null),a=e.isLoad&&e.configInfo.plugAuth.map&&"list"==e.mapType&&n?[2,3].includes(e.configInfo.coach_list_format):null,i=e.isLoad&&e.configInfo.plugAuth.map&&"list"==e.mapType&&n?e.__map(e.list.data,(function(t,n){var a=e.__get_orig(t),i=1===e.configInfo.coach_list_format&&0!=n||[2,3].includes(e.configInfo.coach_list_format),o=[2,3].includes(e.configInfo.coach_list_format)&&n%2==0;return{$orig:a,g2:i,g3:o}})):null,o=e.isLoad&&e.configInfo.plugAuth.map&&"list"==e.mapType&&e.loading?e.list.current_page>=e.list.last_page&&e.list.data.length>0:null,r=e.isLoad&&e.configInfo.plugAuth.map&&"list"==e.mapType?!e.loading&&e.list.data.length<=0&&1==e.list.current_page&&e.location.lng:null,c=e.isLoad&&e.configInfo.plugAuth.map?!e.location.lat&&!e.location.lng&&("map"==e.mapType||"list"==e.mapType&&!e.loading&&e.list.data.length<=0&&1==e.list.current_page):null,u=e.isLoad?e.$t("action.attendantName"):null,s=e.isLoad?e.$t("action.attendantName"):null;e.$mp.data=Object.assign({},{$root:{g0:n,g1:a,l0:i,g4:o,g5:r,g6:c,m0:u,m1:s}})},o=[]},b5cb:function(e,t,n){"use strict";(function(e){var a=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n("7eb4")),o=a(n("34cf")),r=a(n("7ca3")),c=a(n("ee10")),u=n("8f59"),s=a(n("56ce"));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={components:{aMap:function(){n.e("components/amap").then(function(){return resolve(n("55ab"))}.bind(null,n)).catch(n.oe)},tabbar:function(){n.e("components/tabbar").then(function(){return resolve(n("a1b6"))}.bind(null,n)).catch(n.oe)},technicianListItem:function(){n.e("components/technician-list-item").then(function(){return resolve(n("7d48"))}.bind(null,n)).catch(n.oe)},technicianListPopup:function(){n.e("components/technician-list-popup").then(function(){return resolve(n("ff93"))}.bind(null,n)).catch(n.oe)},wPicker:function(){n.e("components/w-picker/w-picker").then(function(){return resolve(n("ab68"))}.bind(null,n)).catch(n.oe)}},data:function(){return{isLoad:!1,options:{},navTitle:"",textType:{1:"可服务",2:"服务中",3:"可预约",4:"不可预约"},popupHeight:"",startYear:"",toDay:"",showDate:!1,detail:{},mapSrc:"",loading:!0,lockTap:!1,popupTap:!1}},computed:(0,u.mapState)({pageActive:function(e){return e.map.pageActive},sexList:function(e){return e.map.sexList},yearList:function(e){return e.map.yearList},check:function(e){return e.map.check},param:function(e){return e.map.param},service_cate:function(e){return e.map.service_cate},mapList:function(e){return e.map.mapList},list:function(e){return e.map.list},mapType:function(e){return e.map.mapType},map:function(e){return e.map.map},covers:function(e){return e.map.covers},primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},autograph:function(e){return e.user.autograph},userInfo:function(e){return e.user.userInfo},location:function(e){return e.user.location},locaRefuse:function(e){return e.user.locaRefuse},changeAddr:function(e){return e.user.changeAddr},isGzhLogin:function(e){return e.user.isGzhLogin},loginType:function(e){return e.user.loginType},useChooseLocation:function(e){return e.user.useChooseLocation},userCoachStatus:function(e){return e.user.userCoachStatus},changeOnAddr:function(e){return e.user.changeOnAddr},noChangeLoca:function(e){return e.user.noChangeLoca}}),onLoad:function(t){var n=this;return(0,c.default)(i.default.mark((function a(){var o,r,c,u,s,l,p;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(console.log("====onLoad map"),n.options=t,o=n.configInfo.realtime_location,r=void 0===o?0:o,c=n.pageActive,u=n.changeAddr,c||n.$util.showLoading(),s=n.configInfo.tabBar,l=s.findIndex((function(e){return 7==e.id})),p=-1==l?"地图找人":s[l].name,n.navTitle=p,e.setNavigationBarTitle({title:p}),!c||r||u){a.next=16;break}return n.$util.setNavigationBarColor({bg:n.primaryColor}),n.isLoad=!0,n.loading=!1,n.$util.hideAll(),a.abrupt("return");case 16:return a.next=18,n.initIndex();case 18:case"end":return a.stop()}}),a)})))()},onShow:function(){var e=this;return(0,c.default)(i.default.mark((function t(){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("====onShow map"),e.useChooseLocation&&e.updateUserItem({key:"useChooseLocation",val:!1}),!e.location.lat&&e.locaRefuse&&e.toResetUtilLoca();case 3:case"end":return t.stop()}}),t)})))()},onPullDownRefresh:function(){e.showNavigationBarLoading(),this.updateUserItem({key:"changeAddr",val:!1}),this.initRefresh(),e.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.loading=!0,this.getList(this.param.page+1))},onShareAppMessage:function(e){var t=this.userInfo.id,n=void 0===t?0:t,a="/pages/map?pid=".concat(n);return this.$util.log(a),{title:"",imageUrl:"",path:a}},watch:{locaRefuse:function(e,t){e||this.toResetUtilLoca()},changeOnAddr:function(e,t){var n=this.noChangeLoca.noloca;e&&n&&this.initUtilLocaData()},noChangeLoca:function(e,t){var n=this;setTimeout((function(){var e=n.changeOnAddr,t=e.lat,a=e.lng,i=e.unix,o=void 0===i?0:i,r=n.noChangeLoca.noloca,c=n.$util.DateToUnix(n.$util.formatTime(new Date,"YY-M-D h:m:s"));r&&(!t&&!a||!o||o&&c-o>=1)&&n.getUtilLocation()}),800)}},methods:p(p(p({},(0,u.mapActions)(["getConfigInfo","getUserInfo","getMapIndex","getMapList","getMapCoachList"])),(0,u.mapMutations)(["updateUserItem","updateServiceItem","updateTechnicianItem","updateMapItem","updateDynamicItem","updateShopstoreItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,c.default)(i.default.mark((function n(){var a,o,r,c,u,s,l,p,f,d,h,g,m,v;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.length>0&&void 0!==e[0]&&e[0],o=t.options.pid,r=void 0===o?0:o,c=t.configInfo.realtime_location,u=void 0===c?0:c,console.log(u,t.changeAddr),a||!t.pageActive||u||t.changeAddr||r){n.next=11;break}return console.log("======="),t.$util.setNavigationBarColor({bg:t.primaryColor}),t.isLoad=!0,t.loading=!1,t.$util.hideAll(),n.abrupt("return");case 11:if(t.isGzhLogin,s=t.userInfo.id,l=void 0===s?0:s,!r||l){n.next=16;break}return n.next=16,t.getUserInfo();case 16:if(t.configInfo.id&&!a&&(!t.configInfo.id||t.configInfo.plugAuth.hasOwnProperty("map"))){n.next=19;break}return n.next=19,t.getConfigInfo();case 19:if(t.$util.setNavigationBarColor({bg:t.primaryColor}),p=new Date(Math.ceil((new Date).getTime())),t.startYear=t.$util.formatTime(p,"YY"),t.toDay=t.$util.formatTime(p,"YY-M-D"),f=t.configInfo,d=f.plugAuth,h=void 0===d?{}:d,g=f.realtime_location,void 0===g?0:g,m=h.map,v=void 0!==m&&m,v){n.next=30;break}return t.isLoad=!0,t.loading=!1,t.$util.hideAll(),n.abrupt("return");case 30:return n.next=32,t.getMapIndex();case 32:return n.next=34,t.getList(1,!0);case 34:t.updateMapItem({key:"pageActive",val:!0}),t.updateTechnicianItem({key:"pageActive",val:!1}),t.isLoad=!0;case 37:case"end":return n.stop()}}),n)})))()},initRefresh:function(){var t=this;return(0,c.default)(i.default.mark((function n(){var a,o,r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.initIndex(!0);case 2:a=t.configInfo.tabBar,o=a.findIndex((function(e){return 7==e.id})),r=-1==o?"地图找人":a[o].name,t.navTitle=r,e.setNavigationBarTitle({title:r});case 7:case"end":return n.stop()}}),n)})))()},toResetUtilLoca:function(){return(0,c.default)(i.default.mark((function e(){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},toOpenLocation:function(){var e=this;return(0,c.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$refs.user_privacy.check(),!n){t.next=4;break}return e.$refs.user_privacy.open(),t.abrupt("return");case 4:return t.next=6,e.$util.checkAuth({type:"userLocation",checkApp:!0});case 6:e.initRefresh();case 7:case"end":return t.stop()}}),t)})))()},handerTabChange:function(e){var t=this.service_cate[e].id,n=Object.assign({},this.param,{cate_id:t,page:1,activeIndex:e});this.updateMapItem({key:"param",val:n}),this.getList()},getList:function(){var e=arguments,t=this;return(0,c.default)(i.default.mark((function n(){var a,o,r,c,u,s,l,p,f,d,h,g,m,v,_,w,k,b,y,I,x,L;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.length>0&&void 0!==e[0]?e[0]:0,o=e.length>1&&void 0!==e[1]&&e[1],a&&(r=t.$util.deepCopy(t.param),r.page=a,t.updateMapItem({key:"param",val:r})),c=t.location,t.locaRefuse,u=t.changeAddr,s=t.configInfo.realtime_location,l=void 0===s?0:s,p=t.userCoachStatus,f=p.status,d=p.coach_position,h=t.mapType,"map"!=h&&("map"==h||1!=t.param.page)){n.next=32;break}if(!(!c.lat||c.lat&&"暂未获取到位置信息"==c.address||o&&l&&!u)){n.next=30;break}if(g=t.$refs.user_privacy.check(),!g){n.next=16;break}return t.$refs.user_privacy.open(),t.isLoad=!0,t.loading=!1,t.$util.hideAll(),n.abrupt("return");case 16:if(2!=f||!d){n.next=27;break}if(m=t.changeOnAddr,v=m.lat,_=void 0===v?0:v,w=m.lng,k=void 0===w?0:w,b=m.unix,y=void 0===b?0:b,I=t.$util.DateToUnix(t.$util.formatTime(new Date,"YY-M-D h:m:s")),x=!(_&&k&&y&&I-y<3),x||(L=Object.assign({},t.location,{lat:_,lng:k,is_util_loca:1}),t.updateUserItem({key:"location",val:L})),t.updateUserItem({key:"noChangeLoca",val:{noloca:x}}),!t.noChangeLoca.noloca){n.next=24;break}return n.abrupt("return");case 24:t.initUtilLocaData(),n.next=28;break;case 27:t.getUtilLocation();case 28:n.next=31;break;case 30:t.initUtilLocaData();case 31:return n.abrupt("return");case 32:t.initUtilLocaData();case 33:case"end":return n.stop()}}),n)})))()},getUtilLocation:function(){var e=this;return(0,c.default)(i.default.mark((function t(){var n,a,o,r,c,u;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$util.getLocation();case 2:n=t.sent,a=n.lat,o=void 0===a?0:a,r=n.lng,c=void 0===r?0:r,u=Object.assign({},e.location,{lat:o,lng:c,is_util_loca:1}),e.updateUserItem({key:"location",val:u}),e.initUtilLocaData();case 10:case"end":return t.stop()}}),t)})))()},initUtilLocaData:function(){var e=this;return(0,c.default)(i.default.mark((function t(){var n,a,o,r,c,u,s,l,p,f,d,h,g,m,v,_,w,k;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.updateUserItem({key:"noChangeLoca",val:{noloca:!1}}),n=e.changeAddr,a=e.configInfo.realtime_location,o=void 0===a?0:a,r=e.location,c=r.lng,u=void 0===c?0:c,s=r.lat,l=void 0===s?0:s,p=r.is_util_loca,f=void 0===p?0:p,e.loading=!0,d=Object.assign({},e.param,{lat:l,lng:u}),h=d.cate_id,g=void 0===h?0:h,m=e.service_cate.findIndex((function(e){return e.id==g})),m=-1==m?0:m,g=e.service_cate[m].id,d.cate_id=g,v=Object.assign({},e.param,{cate_id:g,activeIndex:m}),_=e.mapType,"map"===_&&(v.sex=-1,v.year=0,v.coach_name="",v.service_time=""),e.updateMapItem({key:"param",val:v}),w=e.yearList.filter((function(e){return e.id==d.year}))[0].year,d.work_time_start=w[0],d.work_time_end=w[1],d.service_time=d.service_time?e.$util.DateToUnix(d.service_time):"",-1==d.sex&&delete d.sex,"map"==_&&(delete d.page,d.work_time_start&&(delete d.work_time_start,delete d.work_time_end),e.updateMapItem({key:"check",val:{sex:-1,year:0,coach_name:"",service_time:""}}),e.updateMapItem({key:"covers",val:[]})),delete d.activeIndex,delete d.year,k="map"==_?"getMapList":"getMapCoachList",t.next=26,e[k](d);case 26:e.$util.hideAll(),e.loading=!1,l&&u&&("map"==_||"map"!=_&&1==d.page)&&(f||o&&!n)&&e.$util.getMapInfo(!0,{},n,!0);case 29:case"end":return t.stop()}}),t)})))()},toAppShare:function(){var e=this,t=this.userInfo.id,n=void 0===t?0:t,a=s.default.siteroot,i=a.split("/index.php")[0],o="".concat(i,"/h5/#/pages/map?pid=").concat(n);this.$jweixin.wxReady((function(){e.$jweixin.showOptionMenu(),e.$jweixin.shareAppMessage("地图找人","",o,""),e.$jweixin.shareTimelineMessage("地图找人",o,"")}))},initFixHeight:function(e){this.popupHeight=e},toChooseLocation:function(){var e=this;return(0,c.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$refs.user_privacy.check(),!n){t.next=4;break}return e.$refs.user_privacy.open(),t.abrupt("return");case 4:return e.updateUserItem({key:"useChooseLocation",val:!0}),t.next=7,e.$util.checkAuth({type:"userLocation"});case 7:e.initChooseLoca();case 8:case"end":return t.stop()}}),t)})))()},initChooseLoca:function(){var t=arguments,n=this;return(0,c.default)(i.default.mark((function a(){var r,c,u,s,l,p,f,d,h,g,m,v,_,w,k;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:{},a.next=3,e.chooseLocation(r);case 3:if(c=a.sent,u=(0,o.default)(c,2),s=u[0],l=u[1],p=s?{name:"",address:"",latitude:"",longitude:""}:l,f=p.name,d=void 0===f?"":f,h=p.address,g=void 0===h?"":h,m=p.latitude,v=void 0===m?"":m,_=p.longitude,w=void 0===_?"":_,g=g||d,k={lat:v,lng:w,address:g,province:"",city:"",district:""},n.updateUserItem({key:"useChooseLocation",val:!1}),v){a.next=13;break}return a.abrupt("return");case 13:return n.updateUserItem({key:"location",val:k}),n.updateUserItem({key:"changeAddr",val:!0}),a.next=17,n.getList(1);case 17:case"end":return a.stop()}}),a)})))()},toChangeItem:function(e,t){if(["sex","year"].includes(e)){var n=Object.assign({},this.check,(0,r.default)({},e,t));this.updateMapItem({key:"check",val:n})}else this.updateMapItem({key:"mapType",val:e}),this.getList(1)},toPopup:function(e,t){this.$refs[e][t](),this.popupTap="open"===t},toChangePopupShow:function(e){var t=e.show;t||this.updateMapItem({key:"check",val:this.$util.pick(this.param,["sex","year","coach_name","service_time"])})},toClearServiceTime:function(){this.check.service_time=""},toShowDate:function(){this.showDate=!0},onConfirm:function(e){var t=this;return(0,c.default)(i.default.mark((function n(){var a,o,r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.result,o=t.$util.formatTime((new Date).getTime(),"YY-M-D h:m"),!(t.$util.DateToUnix(a)<=t.$util.DateToUnix(o))){n.next=5;break}return t.$util.showToast({title:"只能选择未来时间哦"}),n.abrupt("return");case 5:r=Object.assign({},t.check,{service_time:a}),t.updateMapItem({key:"check",val:r});case 7:case"end":return n.stop()}}),n)})))()},toReset:function(){this.updateMapItem({key:"check",val:{sex:-1,year:0,coach_name:"",service_time:""}}),this.toConfirm()},toConfirm:function(){var e=Object.assign({},this.param,this.check);this.updateMapItem({key:"param",val:e}),this.updateMapItem({key:"mapType",val:"list"}),this.getList(1),this.$refs.search_item.close(),this.popupTap=!1},toShowPopup:function(e,t){var n=this;return(0,c.default)(i.default.mark((function a(){return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n.$refs.technician_list_popup.toShowPopup(n.list.data[e],t);case 1:case"end":return a.stop()}}),a)})))()},toCollect:function(e){var t=this;return(0,c.default)(i.default.mark((function n(){var a,o,r,c,u;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.list.data[e],o=a.id,r=a.is_collect,c=a.collect_num,u=r?"delCollect":"addCollect",n.next=4,t.$api.mine[u]({coach_id:o});case 4:t.$util.showToast({title:r?"取消成功":"收藏成功"}),t.list.data[e].is_collect=1==r?0:1,t.list.data[e].collect_num=1==r?c-1:c+1;case 7:case"end":return n.stop()}}),n)})))()},goDetail:function(e){var t=this;return(0,c.default)(i.default.mark((function n(){var a,o,r,c,u;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.detail.markerId,o=t.mapList[a],r=o.id,c=o.distance,n.next=4,t.$api.service.coachInfo({id:r});case 4:u=n.sent,u.distance=c,t.detail=u,t.$refs.technician_info_item.open(),t.popupTap=!0;case 9:case"end":return n.stop()}}),n)})))()},goInfo:function(){var e=this.userInfo,t=e.id,n=void 0===t?0:t,a=e.phone,i=void 0===a?"":a,o=this.configInfo,r=o.short_code_status,c=void 0===r?0:r,u=o.bind_phone_type,s=void 0===u?0:u;if(!n||c&&s&&!i)return this.updateUserItem({key:"loginPage",val:"/pages/map"}),void this.$util.goUrl({url:n?"/user/pages/phone":"/pages/login"});var l=this.detail.id;this.$refs.technician_info_item.close(),this.popupTap=!1,this.$util.goUrl({url:"/user/pages/technician-info?id=".concat(l)})}})};t.default=f}).call(this,n("df3c")["default"])},c8e5:function(e,t,n){"use strict";var a=n("8034"),i=n.n(a);i.a}},[["5074","common/runtime","common/vendor"]]]);