(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["user/pages/order/detail"],{"2ffe":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,i=(e._self._c,e.detail.id&&(-1==e.detail.pay_type||8==e.detail.pay_type)&&e.detail.coach_refund_time?e.$t("action.attendantName"):null),n=e.detail.id?e.__map(e.detail.order_goods,(function(t,i){var n=e.__get_orig(t),r=e.detail.order_goods.length;return{$orig:n,g0:r}})):null,r=e.detail.id?e.detail.add_order_id&&e.detail.add_order_id.length>0:null,a=e.detail.id&&r?e.__map(e.detail.add_order_id,(function(t,i){var n=e.__get_orig(t),r=t.order_goods.length;return{$orig:n,g2:r}})):null,o=e.detail.id?e.detail.add_order_id&&e.detail.add_order_id.length>0:null;e._isMounted||(e.e0=function(t){return t.stopPropagation(),e.$refs.refuse_item.open()},e.e1=function(t,i){var n=arguments[arguments.length-1].currentTarget.dataset,r=n.eventParams||n["event-params"];i=r.item;return t.stopPropagation(),e.$util.goUrl({url:"/user/pages/order/detail?id="+i.id})},e.e2=function(t,i){var n=arguments[arguments.length-1].currentTarget.dataset,r=n.eventParams||n["event-params"];i=r.item;return t.stopPropagation(),e.$util.goUrl({url:"/user/pages/bell/list?id="+i.id+"&coach_id="+i.coach_id})},e.e3=function(t){return t.stopPropagation(),e.$util.goUrl({url:e.detail.store_info.phone,openType:"call"})},e.e4=function(t){return t.stopPropagation(),e.$util.goUrl({url:"/user/pages/bell/list?id="+e.detail.id+"&coach_id="+e.detail.coach_id})},e.e5=function(t){return t.stopPropagation(),e.$refs.refuse_item.close()},e.e6=function(t){return t.stopPropagation(),e.$refs.show_phone_item.close()}),e.$mp.data=Object.assign({},{$root:{m0:i,l0:n,g1:r,l1:a,g3:o}})},r=[]},6605:function(e,t,i){"use strict";i.r(t);var n=i("2ffe"),r=i("932a");for(var a in r)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(a);i("8499");var o=i("828b"),c=Object(o["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=c.exports},8499:function(e,t,i){"use strict";var n=i("be77"),r=i.n(n);r.a},"932a":function(e,t,i){"use strict";i.r(t);var n=i("a547"),r=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=r.a},a547:function(e,t,i){"use strict";(function(e,n){var r=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(i("7eb4")),o=r(i("ee10")),c=r(i("7ca3")),u=i("8f59");function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){(0,c.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var d={components:{timeline:function(){i.e("components/timeline").then(function(){return resolve(i("bcf9"))}.bind(null,i)).catch(i.oe)}},data:function(){return{options:{},statusPayType:[1],statusType:{"-1":"已取消",1:"待支付",2:"待接单",3:"待服务",4:this.$t("action.attendantName")+"出发",5:this.$t("action.attendantName")+"到达",6:"服务中",7:"已完成",8:"待转单"},carType:{0:"公交/地铁",1:"出租车"},payType:{1:"微信支付",2:"余额支付",3:"支付宝支付"},lineList:[],base_service:[{pay_type:3,title:this.$t("action.attendantName")+"接单",time:"receiving_time",icon:"iconjishijiedan"},{pay_type:4,title:this.$t("action.attendantName")+"出发",time:"serout_time",addr:"serout_address",icon:"iconjishichufa"},{pay_type:5,title:this.$t("action.attendantName")+"到达",time:"arrive_time",img:"arrive_img",addr:"arr_address",icon:"iconjishidaoda"},{pay_type:6,title:"开始服务",time:"start_service_time",icon:"iconjishifuwu"},{pay_type:7,title:"服务完成",time:"order_end_time",img:"end_img",addr:"end_address",icon:"iconjishiwancheng"},{pay_type:7,title:"签字确认",time:"sign_time",img:"sign_img",icon:""}],base_bell:[{pay_type:3,title:this.$t("action.attendantName")+"接单",time:"receiving_time",icon:"iconjishijiedan"},{pay_type:6,title:"开始服务",time:"start_service_time",icon:"iconjishifuwu"},{pay_type:7,title:"服务完成",time:"order_end_time",img:"end_img",addr:"end_address",icon:"iconjishiwancheng"}],detail:{pay_type:0},popupInfo:{},lockTap:!1}},computed:(0,u.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},userInfo:function(e){return e.user.userInfo},wecom_staff:function(e){return e.user.wecom_staff},over_time_text:function(){return(new Date).getTime()+1e3*this.detail.over_time}}),onLoad:function(e){this.options=e,this.initIndex()},methods:l(l(l({},(0,u.mapActions)(["getConfigInfo","getWecomStaff"])),(0,u.mapMutations)(["updateUserItem","updateOrderItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,o.default)(a.default.mark((function i(){var n,r,o,c,u,s,l,d,f,p,_,h,m,g,v,y,b;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.length>0&&void 0!==e[0]&&e[0],n){i.next=4;break}return i.next=4,Promise.all([t.getConfigInfo(),t.getWecomStaff()]);case 4:return r=t.options.id,i.next=7,t.$api.order.orderInfo({id:r});case 7:o=i.sent,o.is_balance=1*o.balance>0?1:0,c=o.pay_type,u=o.total_time_long,s=o.receiving_time,l=void 0===s?"":s,d=o.start_service_time,f=void 0===d?"":d,p=o.is_add,_=void 0===p?0:p,h=o.store_id,m=void 0===h?0:h,g=o.add_flow_path,void 0===g?1:g,_&&(!l&&c>3&&(o.receiving_time=f),!f&&c>5&&(o.start_service_time=l)),6==c&&(v=t.$util.DateToUnix(f)+60*u,o.start_service_time_unix=v),y=t.$util.deepCopy(_||m?t.base_bell:t.base_service),b=y.findIndex((function(e){return"签字确认"==e.title})),m&&-1==b&&y.push({pay_type:7,title:"签字确认",time:"sign_time",icon:""}),t.lineList=y,t.detail=o,t.$util.setNavigationBarColor({bg:t.primaryColor});case 18:case"end":return i.stop()}}),i)})))()},initRefresh:function(){this.initIndex(!0)},countEnd:function(){var e=this;this.$util.log("倒计时完了"),setTimeout((function(){e.initRefresh(),e.$util.back()}),1e3)},toChangeItem:function(e){var t=this;return(0,o.default)(a.default.mark((function i(){var n,r,o,c;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!t.lockTap){i.next=2;break}return i.abrupt("return");case 2:n=t.detail,r=n.order_code,o=n.order_goods,n.pay_type,c=o[0].goods_cover,t.popupInfo={name:"系统单号：".concat(r),image:c,refs_key:e},t.$refs[e].open();case 6:case"end":return i.stop()}}),i)})))()},confirmOperItem:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var i,n,r,o,c;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=e.detail.id,n=e.popupInfo.refs_key,r={cancel_item:["cancelOrder","取消成功"],end_item:["endOrder","完成成功"]},o=r[n][0],c=r[n][1],!e.lockTap){t.next=7;break}return t.abrupt("return");case 7:return e.lockTap=!0,t.prev=8,e.$refs[n].close(),t.next=12,e.$api.order[o]({id:i});case 12:e.$util.showToast({title:c}),setTimeout((function(){e.initRefresh(),e.$util.back(),e.lockTap=!1}),1e3),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](8),setTimeout((function(){e.initRefresh(),e.$util.back(),e.lockTap=!1}),2e3);case 19:case"end":return t.stop()}}),t,null,[[8,16]])})))()},toPay:function(e){var t=this;return(0,o.default)(a.default.mark((function e(){var i,n,r,o,c;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.lockTap){e.next=2;break}return e.abrupt("return");case 2:return t.lockTap=!0,t.$util.showLoading(),i=t.detail,n=i.id,r=i.pay_model,e.prev=5,e.next=8,t.$api.order.rePayOrder({id:n});case 8:if(o=e.sent,c=o.pay_list,t.$util.hideAll(),!c){e.next=27;break}return 3==r&&(c={orderInfo:c,provider:"alipay"}),e.prev=13,e.next=16,t.$util.pay(c);case 16:t.$util.showToast({title:"支付成功"}),t.initRefresh(),t.lockTap=!1,t.$util.back(),e.next=27;break;case 22:return e.prev=22,e.t0=e["catch"](13),t.$util.showToast({title:"支付失败"}),t.lockTap=!1,e.abrupt("return");case 27:e.next=32;break;case 29:e.prev=29,e.t1=e["catch"](5),setTimeout((function(){t.lockTap=!1,t.$util.hideAll()}),2e3);case 32:case"end":return e.stop()}}),e,null,[[5,29],[13,22]])})))()},goDetail:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t||(t=this.options.id);var i="/user/pages/order/".concat(e,"?id=").concat(t);this.$util.goUrl({url:i})},toAgain:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var i,n,r;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=e.detail,n=i.id,r=i.coach_id,t.next=3,e.$api.order.onceMoreOrder({order_id:n});case 3:e.$util.goUrl({url:"/user/pages/order?id=".concat(r)});case 4:case"end":return t.stop()}}),t)})))()},toTel:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var i,n,r,o,c;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=e.detail,n=i.id,r=i.pay_type,![2,3,4,5,6].includes(r)){t.next=11;break}return t.next=4,e.$api.order.getVirtualPhone({order_id:n});case 4:if(o=t.sent,o){t.next=8;break}return e.$util.showToast({title:"稍后会有电话打入，请注意接听哦"}),t.abrupt("return");case 8:e.$util.goUrl({url:o,openType:"call"}),t.next=13;break;case 11:c=7==r?"服务结束":"服务取消",e.$util.showToast({title:"".concat(c,"不能联系").concat(e.$t("action.attendantName"),"哦")});case 13:case"end":return t.stop()}}),t)})))()},toContact:function(){var t=this.configInfo,i=t.hide_admin_mobile,r=t.mobile,a=t.im_type,o=t.wecom_appid,c=this.wecom_staff,u=this.detail.admin_phone;if(i||!u||3==a)if(3!=a){var s=i&&u?u:r;this.$util.goUrl({url:s,openType:"call"})}else try{e.openCustomerServiceChat({extInfo:{url:c},corpId:o,fail:function(e){n.showToast({title:e.errorMsg,icon:"none"})}})}catch(l){this.$util.showToast({title:"请更新微信版本"})}else this.$refs.show_phone_item.open()},toCallPhone:function(e){this.$refs.show_phone_item.close(),this.$util.goUrl({url:e,openType:"call"})},toMap:function(e){var t=this;return(0,o.default)(a.default.mark((function i(){var r,o,c,u,s,l,d;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(r=t.$refs.user_privacy.check(),!r){i.next=4;break}return t.$refs.user_privacy.open(),i.abrupt("return");case 4:return o=t.detail[e],c=o.address,u=o.address_info,s=void 0===u?"":u,l=o.lat,d=o.lng,i.next=7,t.$util.checkAuth({type:"userLocation"});case 7:return i.next=9,n.getLocation({type:"gcj02"});case 9:return i.next=11,n.openLocation({latitude:1*l,longitude:1*d,name:s?"".concat(c," ").concat(s):c,scale:28});case 11:case"end":return i.stop()}}),i)})))()},toCopy:function(e){var t=this.$refs.user_privacy.check();t?this.$refs.user_privacy.open():this.$util.goUrl({url:e,openType:"copy"})}})};t.default=d}).call(this,i("3223")["default"],i("df3c")["default"])},af5a:function(e,t,i){"use strict";(function(e,t){var n=i("47a9");i("65e9");n(i("3240"));var r=n(i("6605"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(r.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},be77:function(e,t,i){}},[["af5a","common/runtime","common/vendor"]]]);