(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["user/pages/choose-technician"],{5838:function(t,e,n){"use strict";(function(t,e){var a=n("47a9");n("65e9");a(n("3240"));var i=a(n("eb11"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"5b93":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,n=(t._self._c,t.cityList&&t.cityList.length>0),a=n&&-1!==t.cityIndex?t.cityList[t.cityIndex].title.length:null,i=n&&-1!==t.cityIndex&&a>3?t.cityList[t.cityIndex].title.substring(0,3):null,r=t.$t("action.attendantName"),o=t.list.data&&t.list.data.length>0,c=o?[2,3].includes(t.configInfo.coach_list_format):null,u=o?t.__map(t.list.data,(function(e,n){var a=t.__get_orig(e),i=1===t.configInfo.coach_list_format||[2,3].includes(t.configInfo.coach_list_format),r=[2,3].includes(t.configInfo.coach_list_format)&&n%2==0;return{$orig:a,g5:i,g6:r}})):null,s=t.loading?t.list.current_page>=t.list.last_page&&t.list.data.length>0&&t.location.lng:null,l=!t.loading&&t.list.data.length<=0&&1==t.list.current_page,d=!l||t.location.lat||t.location.lng?null:t.$t("action.attendantName");t._isMounted||(t.e0=function(e){return e.stopPropagation(),t.$refs.choose_city_item.close()}),t.$mp.data=Object.assign({},{$root:{g0:n,g1:a,g2:i,m0:r,g3:o,g4:c,l0:u,g7:s,g8:l,m1:d}})},i=[]},b661:function(t,e,n){"use strict";n.r(e);var a=n("fc64"),i=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(r);e["default"]=i.a},eb11:function(t,e,n){"use strict";n.r(e);var a=n("5b93"),i=n("b661");for(var r in i)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r);var o=n("828b"),c=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);e["default"]=c.exports},fc64:function(t,e,n){"use strict";(function(t){var a=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("7eb4")),r=a(n("34cf")),o=a(n("7ca3")),c=a(n("ee10")),u=n("8f59");function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){(0,o.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={components:{technicianListItem:function(){n.e("components/technician-list-item").then(function(){return resolve(n("7d48"))}.bind(null,n)).catch(n.oe)},technicianListPopup:function(){n.e("components/technician-list-popup").then(function(){return resolve(n("ff93"))}.bind(null,n)).catch(n.oe)}},data:function(){return{isLoad:!1,options:{},navTitle:"",param:{page:1,ser_id:0,coach_name:""},list:{data:[]},loading:!0,lockTap:!1,pageLen:1}},computed:(0,u.mapState)({primaryColor:function(t){return t.config.configInfo.primaryColor},subColor:function(t){return t.config.configInfo.subColor},configInfo:function(t){return t.config.configInfo},cityId:function(t){return t.technician.cityId},cityIndex:function(t){return t.technician.cityIndex},cityList:function(t){return t.technician.cityList},loginType:function(t){return t.user.loginType},userInfo:function(t){return t.user.userInfo},location:function(t){return t.user.location},changeAddr:function(t){return t.user.changeAddr},locaRefuse:function(t){return t.user.locaRefuse},useChooseLocation:function(t){return t.user.useChooseLocation},userCoachStatus:function(t){return t.user.userCoachStatus},changeOnAddr:function(t){return t.user.changeOnAddr},noChangeLoca:function(t){return t.user.noChangeLoca}}),onLoad:function(e){var n=this;return(0,c.default)(i.default.mark((function a(){var r;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log("====onLoad choose-technician"),n.options=e,n.$util.showLoading(),a.next=5,n.initIndex();case 5:r="选择".concat(n.$t("action.attendantName")),n.navTitle=r,t.setNavigationBarTitle({title:r}),n.isLoad=!0;case 9:case"end":return a.stop()}}),a)})))()},onShow:function(){var t=this;return(0,c.default)(i.default.mark((function e(){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.useChooseLocation&&t.updateUserItem({key:"useChooseLocation",val:!1}),!t.location.lat&&t.locaRefuse&&t.toResetUtilLoca();case 2:case"end":return e.stop()}}),e)})))()},onPullDownRefresh:function(){t.showNavigationBarLoading(),this.updateUserItem({key:"changeAddr",val:!1}),this.initRefresh(),t.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},watch:{locaRefuse:function(t,e){t||this.toResetUtilLoca()},changeOnAddr:function(t,e){var n=this.noChangeLoca,a=n.noloca,i=n.refresh;t&&a&&this.initUtilLocaData(i)},noChangeLoca:function(t,e){var n=this;setTimeout((function(){var t=n.changeOnAddr,e=t.lat,a=t.lng,i=t.unix,r=void 0===i?0:i,o=n.noChangeLoca,c=o.noloca,u=o.refresh,s=n.$util.DateToUnix(n.$util.formatTime(new Date,"YY-M-D h:m:s"));c&&(!e&&!a||!r||r&&s-r>=1)&&n.getUtilLocation(u)}),800)}},methods:l(l(l({},(0,u.mapActions)(["getConfigInfo","getCityList"])),(0,u.mapMutations)(["updateUserItem","updateServiceItem","updateTechnicianItem","updateMapItem"])),{},{initIndex:function(){var t=arguments,e=this;return(0,c.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.length>0&&void 0!==t[0]&&t[0],e.configInfo.id&&!a){n.next=4;break}return n.next=4,e.getConfigInfo();case 4:e.pageLen=getCurrentPages().length,e.getList(!1!==a||0==e.cityList.length);case 6:case"end":return n.stop()}}),n)})))()},initRefresh:function(){this.param.page=1,this.initIndex(!0)},toResetUtilLoca:function(){return(0,c.default)(i.default.mark((function t(){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},toOpenLocation:function(){var t=this;return(0,c.default)(i.default.mark((function e(){var n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.$refs.user_privacy.check(),!n){e.next=4;break}return t.$refs.user_privacy.open(),e.abrupt("return");case 4:return e.next=6,t.$util.checkAuth({type:"userLocation",checkApp:!0});case 6:t.initRefresh();case 7:case"end":return e.stop()}}),e)})))()},pickerChange:function(t,e){var n=t.target.value;this.updateTechnicianItem({key:"cityIndex",val:n}),this.updateTechnicianItem({key:"cityId",val:this.cityList[n].id}),this.param.page=1,this.getList()},toSearch:function(t){this.param.page=1,this.param.coach_name=t,this.getList()},toChooseLocation:function(){var t=this;return(0,c.default)(i.default.mark((function e(){var n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.$refs.user_privacy.check(),!n){e.next=4;break}return t.$refs.user_privacy.open(),e.abrupt("return");case 4:return t.updateUserItem({key:"useChooseLocation",val:!0}),e.next=7,t.$util.checkAuth({type:"userLocation"});case 7:t.initChooseLoca();case 8:case"end":return e.stop()}}),e)})))()},initChooseLoca:function(){var e=arguments,n=this;return(0,c.default)(i.default.mark((function a(){var o,c,u,s,l,d,f,p,h,g,v,m,_,y,L;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=e.length>0&&void 0!==e[0]?e[0]:{},a.next=3,t.chooseLocation(o);case 3:if(c=a.sent,u=(0,r.default)(c,2),s=u[0],l=u[1],d=s?{name:"",address:"",latitude:"",longitude:""}:l,f=d.name,p=void 0===f?"":f,h=d.address,g=void 0===h?"":h,v=d.latitude,m=void 0===v?"":v,_=d.longitude,y=void 0===_?"":_,g=g||p,L={lat:m,lng:y,address:g,province:"",city:"",district:""},n.updateUserItem({key:"useChooseLocation",val:!1}),m){a.next=13;break}return a.abrupt("return");case 13:return n.realtimeTimer&&clearInterval(n.realtimeTimer),n.updateUserItem({key:"location",val:L}),n.updateUserItem({key:"changeAddr",val:!0}),n.param.page=1,a.next=19,n.getCityList({lng:y,lat:m,change:1});case 19:return a.next=21,n.getList();case 21:case"end":return a.stop()}}),a)})))()},getList:function(){var t=arguments,e=this;return(0,c.default)(i.default.mark((function n(){var a,r,o,c,u,s,l,d,f,p,h,g,v,m,_,y,L,b;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.length>0&&void 0!==t[0]&&t[0],r=e.location,o=e.changeAddr,c=e.configInfo.realtime_location,u=void 0===c?0:c,s=e.userCoachStatus,l=s.status,d=s.coach_position,1!=e.param.page||!(!r.lat||r.lat&&"暂未获取到位置信息"==r.address||a&&u&&!o)){n.next=20;break}if(2!=l||!d){n.next=16;break}if(f=e.changeOnAddr,p=f.lat,h=void 0===p?0:p,g=f.lng,v=void 0===g?0:g,m=f.unix,_=void 0===m?0:m,y=e.$util.DateToUnix(e.$util.formatTime(new Date,"YY-M-D h:m:s")),L=!(h&&v&&_&&y-_<3),L||(b=Object.assign({},e.location,{lat:h,lng:v,is_util_loca:1}),e.updateUserItem({key:"location",val:b})),e.updateUserItem({key:"noChangeLoca",val:{noloca:L,refresh:a}}),!e.noChangeLoca.noloca){n.next=13;break}return n.abrupt("return");case 13:e.initUtilLocaData(a),n.next=17;break;case 16:e.getUtilLocation(a);case 17:return e.updateServiceItem({key:"pageActive",val:!1}),e.updateMapItem({key:"pageActive",val:!1}),n.abrupt("return");case 20:e.initUtilLocaData(a);case 21:case"end":return n.stop()}}),n)})))()},getUtilLocation:function(t){var e=this;return(0,c.default)(i.default.mark((function n(){var a,r,o,c,u,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$util.getLocation();case 2:a=n.sent,r=a.lat,o=void 0===r?0:r,c=a.lng,u=void 0===c?0:c,s=Object.assign({},e.location,{lat:o,lng:u,is_util_loca:1}),e.updateUserItem({key:"location",val:s}),e.initUtilLocaData(t);case 10:case"end":return n.stop()}}),n)})))()},initUtilLocaData:function(t){var e=this;return(0,c.default)(i.default.mark((function n(){var a,r,o,c,u,s,l,d,f,p,h,g,v,m,_,y,L,b,k,w,I,x,C,O;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.updateUserItem({key:"noChangeLoca",val:{noloca:!1}}),a=e.changeAddr,r=e.configInfo.realtime_location,o=void 0===r?0:r,c=e.location,u=c.lng,s=void 0===u?0:u,l=c.lat,d=void 0===l?0:l,f=c.is_util_loca,p=void 0===f?0:f,!t){n.next=7;break}return n.next=7,e.getCityList({lng:s,lat:d,change:1});case 7:if(h=e.options,g=h.id,v=h.store_id,m=void 0===v?0:v,_=e.list,y=e.param,L=e.cityList,b=e.cityIndex,k=e.cityId,w=L.findIndex((function(t){return t.id==k})),-1!=w){n.next=16;break}return e.$refs.choose_city_item.open(),e.loading=!1,e.$util.hideAll(),e.list={data:[],last_page:1,current_page:1},n.abrupt("return");case 16:return k=-1==w?0:k,b=-1==w?0:w,e.updateTechnicianItem({key:"cityIndex",val:b}),e.updateTechnicianItem({key:"cityId",val:k}),y=Object.assign({},y,{ser_id:g,city_id:k,lat:d,lng:s,store_id:m}),I=e.configInfo.coach_format,x=void 0===I?1:I,C=1==x?"serviceCoachList":"typeServiceCoachList",n.next=25,e.$api.service[C](y);case 25:O=n.sent,1==e.param.page||(O.data=_.data.concat(O.data)),e.list=O,e.loading=!1,e.$util.hideAll(),1==y.page&&(p||o&&!a)&&e.$util.getMapInfo(!0,{},a);case 30:case"end":return n.stop()}}),n)})))()},toShowPopup:function(t,e){var n=this;return(0,c.default)(i.default.mark((function a(){return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n.$refs.technician_list_popup.toShowPopup(n.list.data[t],e);case 1:case"end":return a.stop()}}),a)})))()},toCollect:function(t){var e=this;return(0,c.default)(i.default.mark((function n(){var a,r,o,c,u;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.list.data[t],r=a.id,o=a.is_collect,c=a.collect_num,u=o?"delCollect":"addCollect",n.next=4,e.$api.mine[u]({coach_id:r});case 4:e.$util.showToast({title:o?"取消成功":"收藏成功"}),e.list.data[t].is_collect=1==o?0:1,e.list.data[t].collect_num=1==o?c-1:c+1;case 7:case"end":return n.stop()}}),n)})))()},toOrder:function(t){var e=this;return(0,c.default)(i.default.mark((function n(){var a,r,o,c,u,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.list.data[t],r=a.id,o=a.is_work,c=void 0===o?0:o,c){n.next=3;break}return n.abrupt("return");case 3:if(u=e.options.id,!e.lockTap){n.next=6;break}return n.abrupt("return");case 6:return e.lockTap=!0,n.prev=7,n.next=10,e.$api.order.addCar({service_id:u,coach_id:r,num:1,is_top:1,coach_service:1});case 10:e.lockTap=!1,s="/user/pages/order?id=".concat(r,"&ser_id=").concat(u),e.$util.goUrl({url:s}),n.next=18;break;case 15:n.prev=15,n.t0=n["catch"](7),e.lockTap=!1;case 18:case"end":return n.stop()}}),n,null,[[7,15]])})))()},toBack:function(){var t=this.pageLen,e=t>1?1:"/pages/service",n=t>1?"navigateBack":"reLaunch";this.$util.goUrl({url:e,openType:n})}})};e.default=d}).call(this,n("df3c")["default"])}},[["5838","common/runtime","common/vendor"]]]);