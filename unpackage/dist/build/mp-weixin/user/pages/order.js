(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["user/pages/order"],{"394d":function(e,t,r){"use strict";(function(e){var n=r("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r("7eb4")),a=n(r("7ca3")),o=n(r("ee10")),s=r("8f59");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d={components:{parser:function(){Promise.all([r.e("common/vendor"),r.e("components/jyf-Parser/index")]).then(function(){return resolve(r("8f47"))}.bind(null,r)).catch(r.oe)}},data:function(){return{options:{},isLoad:!1,serviceTypeList:[],serviceTypeInd:0,carTypeList:[{id:1,title:"出租车"},{id:0,title:"公交/地铁"}],carTypeInd:0,payList:[{id:1,icon:"iconweixinzhifu1",title:"微信支付"},{id:2,icon:"iconqianbao c-balance",title:"账户余额",is_disabled:!1}],payInd:0,balanceInd:1,balance:0,tabList:[],activeIndex:0,timeList:[],send_info:{},orderInfo:{coupon_id:0,address_info:{id:0}},form:{user_name:"",user_phone:"",text:""},rule:[{name:"user_name",checkType:"isNotNull",errorMsg:"请输入您的姓名",regType:2},{name:"user_phone",checkType:"isMobile",errorMsg:"请输入手机号"}],lockTap:!1,isBus:0,isAgree:!1}},computed:(0,s.mapState)({primaryColor:function(e){return e.config.configInfo.primaryColor},subColor:function(e){return e.config.configInfo.subColor},configInfo:function(e){return e.config.configInfo},userInfo:function(e){return e.user.userInfo},mineInfo:function(e){return e.user.mineInfo}}),watch:{"send_info.time":function(e){var t=this.send_info.time_str;this.getIsBusCall(t)}},onLoad:function(e){var t=this;return(0,o.default)(i.default.mark((function r(){var n,a;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.options=e,t.$util.showLoading(),r.next=4,t.initIndex();case 4:n=t.send_info.time,a=void 0===n?0:n,a||t.getIsBusCall("");case 6:case"end":return r.stop()}}),r)})))()},methods:c(c(c({},(0,s.mapActions)(["getConfigInfo","getMineInfo"])),(0,s.mapMutations)(["updateUserItem","updateOrderItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,o.default)(i.default.mark((function r(){var n,a,o,s,u,c,d,l,f,p,h,v,_,m,b,g,y,x,T,I,k,w,$,L,O,P,j,C;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.length>0&&void 0!==e[0]&&e[0],n=t.options,a=n.id,o=n.ser_id,s=void 0===o?0:o,u=t.orderInfo,c=u.coupon_id,d=u.address_info,l=d.id,r.next=6,t.$api.order.getServiceType({coach_id:a});case 6:if(f=r.sent,p=f.is_door,h=f.is_store,v=[],p&&v.push({id:0,title:"上门服务"}),h&&v.push({id:1,title:"到店服务"}),t.serviceTypeList=v,t.$util.setNavigationBarColor({bg:t.primaryColor}),0!=v.length){r.next=19;break}return t.$util.hideAll(),t.isLoad=!0,t.orderInfo.order_goods=[],r.abrupt("return");case 19:return _=t.carTypeList[t.carTypeInd].id,m=t.serviceTypeList[t.serviceTypeInd].id,b=void 0===m?0:m,r.next=23,t.$api.order.payOrderInfo({is_store:b,service_id:s,coach_id:a,car_type:_,coupon_id:c,address_id:l});case 23:g=r.sent,t.$util.hideAll(),g.address_info=g.address_info.id?g.address_info:{},t.orderInfo=g,y=g.alipay_status,void 0===y?0:y,x=g.near_time,T=void 0===x?{str:"",text:""}:x,I=g.user_cash,k=T.text,w=void 0===k?"":k,$=T.str,L=void 0===$?"":$,O=t.send_info.time,P=void 0===O?0:O,!P&&w&&L&&(j=t.$util.formatTime(1e3*L,"M-D"),t.send_info={time:w,time_str:L,dat_text:j}),C=t.balanceInd,t.payList[C].is_disabled=1*I<1*g.pay_price,t.balance=I,t.isLoad=!0;case 36:case"end":return r.stop()}}),r)})))()},initRefresh:function(){this.initIndex(!0)},linkpress:function(e){},getIsBusCall:function(e){var t=this;return(0,o.default)(i.default.mark((function r(){var n,a,o,s,u;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t.serviceTypeList,a=t.serviceTypeInd,0!=n.length){r.next=3;break}return r.abrupt("return");case 3:if(o=n[a].id,s=void 0===o?0:o,!s){r.next=8;break}r.t0=1,r.next=11;break;case 8:return r.next=10,t.$api.order.getIsBus({start_time:e});case 10:r.t0=r.sent;case 11:if(u=r.t0,t.isBus=u,0!=u){r.next=17;break}return t.carTypeInd=0,r.next=17,t.initRefresh();case 17:case"end":return r.stop()}}),r)})))()},toChangeItem:function(e){var t=arguments,r=this;return(0,o.default)(i.default.mark((function n(){var a,o,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=t.length>1&&void 0!==t[1]?t[1]:1,o=r.orderInfo.address_info,n.t0=a,n.next=1===n.t0?5:2===n.t0?12:3===n.t0?17:22;break;case 5:if(1!=e||o.id&&r.send_info.time){n.next=8;break}return r.$util.showToast({title:o.id?"请选择预约时间":"请选择地址"}),n.abrupt("return");case 8:return r.carTypeInd=e,n.next=11,r.initRefresh();case 11:return n.abrupt("break",22);case 12:if(s=r.balanceInd,e!=s||!r.payList[s].is_disabled){n.next=15;break}return n.abrupt("return");case 15:return r.payInd=e,n.abrupt("break",22);case 17:return r.serviceTypeInd=e,r.carTypeInd=1==e?1:0,n.next=21,r.initRefresh();case 21:return n.abrupt("break",22);case 22:case"end":return n.stop()}}),n)})))()},changeNum:function(e,t){var r=this;return(0,o.default)(i.default.mark((function n(){var a,o,s,u,c,d,l,f,p,h,v;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=r.orderInfo.order_goods[t],o=a.id,s=a.service_id,u=a.member_info,c=u.can_buy,d=u.title,c||!(e>0)){n.next=6;break}return l=d?d.includes("会员")?d:"".concat(d,"会员"):"会员",r.$util.showToast({title:"您还不是".concat(l)}),n.abrupt("return");case 6:if(f=0,r.orderInfo.order_goods.map((function(e){f+=e.num})),!(1===f&&e<0)){n.next=11;break}return r.$util.showToast({title:"至少保留一个服务哦"}),n.abrupt("return");case 11:if(p=r.options.id,!r.lockTap){n.next=14;break}return n.abrupt("return");case 14:return r.lockTap=!0,h=e>0?"addCar":"delCar",v=e>0?{service_id:s,coach_id:p,num:1}:{id:o,num:1},n.prev=17,n.next=20,r.$api.order[h](v);case 20:return n.sent,n.next=23,r.initRefresh();case 23:r.lockTap=!1,n.next=29;break;case 26:n.prev=26,n.t0=n["catch"](17),r.lockTap=!1;case 29:case"end":return n.stop()}}),n,null,[[17,26]])})))()},toShowTime:function(){var e=this;return(0,o.default)(i.default.mark((function t(){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getStoreDay();case 2:e.$refs.show_time_item.open();case 3:case"end":return t.stop()}}),t)})))()},getStoreDay:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var r,n,a;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.order.dayText();case 2:return r=t.sent,r.map((function(e){e.title="".concat(e.dat_text," ").concat(e.week)})),e.tabList=r,n=e.send_info.dat_text,a=void 0===n?"":n,a&&(e.activeIndex=e.tabList.findIndex((function(e){return e.dat_text==a}))),t.next=9,e.getStoreTime();case 9:e.loading=!1,e.$util.hideAll();case 11:case"end":return t.stop()}}),t)})))()},getStoreTime:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var r,n,a,o,s,u;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.options.id,n=e.activeIndex,!(n<0)){t.next=4;break}return t.abrupt("return");case 4:return a=e.tabList[n].dat_str,o=e.serviceTypeList[e.serviceTypeInd].id,s=void 0===o?0:o,u=e.orderInfo.time_long,t.next=9,e.$api.order.timeText({is_store:s,coach_id:r,time_long:u,day:a});case 9:e.timeList=t.sent,e.loading=!1,e.$util.hideAll();case 12:case"end":return t.stop()}}),t)})))()},handerTabChange:function(e){this.activeIndex=e,this.getStoreTime()},toChooseTime:function(e){var t=this.tabList,r=this.activeIndex,n=this.timeList[e];1==n.status&&(n.time="".concat(t[r].dat_text," ").concat(t[r].week," ").concat(n.time_text),this.send_info=n,this.$refs.show_time_item.close())},checkInput:function(e,t){var r=this,n=this.$util.formatMoney(e.detail.value);this.$nextTick((function(){r.form[t]=n}))},toMap:function(){var t=this;return(0,o.default)(i.default.mark((function r(){var n,a,o,s,u;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t.orderInfo.store_info,a=n.address,o=n.lat,s=n.lng,a){r.next=3;break}return r.abrupt("return");case 3:if(u=t.$refs.user_privacy.check(),!u){r.next=7;break}return t.$refs.user_privacy.open(),r.abrupt("return");case 7:return r.next=9,t.$util.checkAuth({type:"userLocation"});case 9:return r.next=11,e.getLocation({type:"gcj02"});case 11:return r.next=13,e.openLocation({latitude:1*o,longitude:1*s,name:a,scale:28});case 13:case"end":return r.stop()}}),r)})))()},validate:function(e){var t=new this.$util.Validate;this.rule.map((function(r){var n=r.name;t.add(e[n],r)}));var r=t.start();return r},toPay:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var r,n,a,o,s,u,c,d,l,f,p,h,v,_,m,b,g,y,x,T,I,k,w;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.$util.deepCopy(e.form),n=e.serviceTypeList[e.serviceTypeInd].id,a=void 0===n?0:n,!a){t.next=9;break}if(o=e.validate(r),!o){t.next=7;break}return e.$util.showToast({title:o}),t.abrupt("return");case 7:t.next=11;break;case 9:delete r.user_name,delete r.user_phone;case 11:if(s=e.orderInfo,u=s.coupon_id,c=void 0===u?0:u,d=s.address_info,l=void 0===d?{}:d,f=l.id,a||f){t.next=16;break}return e.$util.showToast({title:"请选择地址"}),t.abrupt("return");case 16:if(p=e.carTypeList,h=e.carTypeInd,v=e.payList,_=e.payInd,m=e.send_info,m.time){t.next=20;break}return e.$util.showToast({title:"请选择预约时间"}),t.abrupt("return");case 20:if(b=e.orderInfo.trading_rules,!(b&&b.length>0)||e.isAgree){t.next=24;break}return e.$util.showToast({title:"请先阅读并同意《平台交易规则》"}),t.abrupt("return");case 24:if(g=p[h].id,y=v[_].id,x=e.options.id,T=m.time_str,r=Object.assign({},r,{coach_id:x,coupon_id:c,address_id:f,is_store:a,car_type:g,pay_model:y,start_time:T}),!e.lockTap){t.next=31;break}return t.abrupt("return");case 31:return e.lockTap=!0,e.$util.showLoading(),t.prev=33,t.next=36,e.$api.order.payOrder(r);case 36:if(I=t.sent,k=I.pay_list,w=I.order_id,void 0===w?0:w,e.$util.hideAll(),!k){t.next=55;break}return 3==y&&(k={orderInfo:k,provider:"alipay"}),t.prev=43,t.next=46,e.$util.pay(k);case 46:e.$util.showToast({title:"支付成功"}),setTimeout((function(){e.lockTap=!1,e.$util.goUrl({url:"/pages/order?tab=2",openType:"reLaunch"})}),1e3),t.next=54;break;case 50:t.prev=50,t.t0=t["catch"](43),e.$util.showToast({title:"支付失败"}),setTimeout((function(){e.lockTap=!1,e.$util.goUrl({url:"/pages/order?tab=1",openType:"reLaunch"})}),1e3);case 54:return t.abrupt("return");case 55:e.$util.showToast({title:"支付成功"}),setTimeout((function(){e.lockTap=!1,e.$util.goUrl({url:"/pages/order?tab=2",openType:"reLaunch"})}),1e3),t.next=62;break;case 59:t.prev=59,t.t1=t["catch"](33),setTimeout((function(){e.lockTap=!1,e.$util.hideAll()}),2e3);case 62:case"end":return t.stop()}}),t,null,[[33,59],[43,50]])})))()},toCopy:function(e){var t=this.$refs.user_privacy.check();t?this.$refs.user_privacy.open():this.$util.goUrl({url:e,openType:"copy"})}})};t.default=d}).call(this,r("df3c")["default"])},"63af":function(e,t,r){"use strict";var n=r("fb7f"),i=r.n(n);i.a},"683e":function(e,t,r){"use strict";r.r(t);var n=r("c7e0"),i=r("9ced");for(var a in i)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return i[e]}))}(a);r("63af");var o=r("828b"),s=Object(o["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=s.exports},"9ced":function(e,t,r){"use strict";r.r(t);var n=r("394d"),i=r.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=i.a},c7e0:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,r=(e._self._c,e.isLoad?e.serviceTypeList&&e.serviceTypeList.length>0:null),n=e.isLoad?e.orderInfo.order_goods&&e.orderInfo.order_goods.length>0:null,i=e.isLoad&&n?e.__map(e.orderInfo.order_goods,(function(t,r){var n=e.__get_orig(t),i=e.$t("action.attendantName");return{$orig:n,m0:i}})):null,a=e.isLoad&&n&&0===e.serviceTypeList[e.serviceTypeInd].id&&1===e.carTypeList[e.carTypeInd].id&&e.orderInfo.free_fare?e.$t("action.attendantName"):null,o=e.isLoad&&n?e.form.text.length:null,s=!e.isLoad||!n||o>100?null:e.form.text.length,u=e.isLoad&&n?e.orderInfo.trading_rules&&e.orderInfo.trading_rules.length>0:null,c=e.isLoad&&!n?e.$t("action.attendantName"):null;e._isMounted||(e.e0=function(t){return t.stopPropagation(),e.$util.goUrl({url:e.orderInfo.store_info.phone,openType:"call"})},e.e1=function(t){return t.stopPropagation(),e.$util.goUrl({url:"/user/pages/address/list?check=1"})},e.e2=function(t){return t.stopPropagation(),e.$util.goUrl({url:"/user/pages/coupon/use"})},e.e3=function(t){t.stopPropagation(),e.isAgree=!e.isAgree},e.e4=function(t){return t.stopPropagation(),e.$refs.show_rule_item.open()},e.e5=function(t){return e.$util.goUrl({url:"/pages/service",openType:"reLaunch"})},e.e6=function(t){return e.$refs.show_rule_item.close()}),e.$mp.data=Object.assign({},{$root:{g0:r,g1:n,l0:i,m1:a,g2:o,g3:s,g4:u,m2:c}})},i=[]},f43f:function(e,t,r){"use strict";(function(e,t){var n=r("47a9");r("65e9");n(r("3240"));var i=n(r("683e"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(i.default)}).call(this,r("3223")["default"],r("df3c")["createPage"])},fb7f:function(e,t,r){}},[["f43f","common/runtime","common/vendor"]]]);